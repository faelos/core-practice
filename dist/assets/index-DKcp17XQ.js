function Es(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const S=document.createElement("link").relList;if(S&&S.supports&&S.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))E(P);new MutationObserver(P=>{for(const g of P)if(g.type==="childList")for(const l of g.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&E(l)}).observe(document,{childList:!0,subtree:!0});function O(P){const g={};return P.integrity&&(g.integrity=P.integrity),P.referrerPolicy&&(g.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?g.credentials="include":P.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function E(P){if(P.ep)return;P.ep=!0;const g=O(P);fetch(P.href,g)}})();var Mt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Fe={exports:{}},Qn=Fe.exports,_i;function Jn(){return _i||(_i=1,function(i,S){(function(O,E){var P={};O.PubSub?(P=O.PubSub,console.warn("PubSub already loaded, using existing version")):(O.PubSub=P,E(P)),i!==void 0&&i.exports&&(S=i.exports=P),S.PubSub=P,i.exports=S=P})(typeof window=="object"&&window||Qn||Mt,function(O){var E={},P=-1,g="*";function l(a){var d;for(d in a)if(Object.prototype.hasOwnProperty.call(a,d))return!0;return!1}function r(a){return function(){throw a}}function c(a,d,v){try{a(d,v)}catch(e){setTimeout(r(e),0)}}function h(a,d,v){a(d,v)}function f(a,d,v,e){var t=E[d],u=e?h:c,_;if(Object.prototype.hasOwnProperty.call(E,d))for(_ in t)Object.prototype.hasOwnProperty.call(t,_)&&u(t[_],a,v)}function y(a,d,v){return function(){var t=String(a),u=t.lastIndexOf(".");for(f(a,a,d,v);u!==-1;)t=t.substr(0,u),u=t.lastIndexOf("."),f(a,t,d,v);f(a,g,d,v)}}function m(a){var d=String(a),v=!!(Object.prototype.hasOwnProperty.call(E,d)&&l(E[d]));return v}function o(a){for(var d=String(a),v=m(d)||m(g),e=d.lastIndexOf(".");!v&&e!==-1;)d=d.substr(0,e),e=d.lastIndexOf("."),v=m(d);return v}function s(a,d,v,e){a=typeof a=="symbol"?a.toString():a;var t=y(a,d,e),u=o(a);return u?(v===!0?t():setTimeout(t,0),!0):!1}O.publish=function(a,d){return s(a,d,!1,O.immediateExceptions)},O.publishSync=function(a,d){return s(a,d,!0,O.immediateExceptions)},O.subscribe=function(a,d){if(typeof d!="function")return!1;a=typeof a=="symbol"?a.toString():a,Object.prototype.hasOwnProperty.call(E,a)||(E[a]={});var v="uid_"+String(++P);return E[a][v]=d,v},O.subscribeAll=function(a){return O.subscribe(g,a)},O.subscribeOnce=function(a,d){var v=O.subscribe(a,function(){O.unsubscribe(v),d.apply(this,arguments)});return O},O.clearAllSubscriptions=function(){E={}},O.clearSubscriptions=function(d){var v;for(v in E)Object.prototype.hasOwnProperty.call(E,v)&&v.indexOf(d)===0&&delete E[v]},O.countSubscriptions=function(d){var v,e,t=0;for(v in E)if(Object.prototype.hasOwnProperty.call(E,v)&&v.indexOf(d)===0){for(e in E[v])t++;break}return t},O.getSubscriptions=function(d){var v,e=[];for(v in E)Object.prototype.hasOwnProperty.call(E,v)&&v.indexOf(d)===0&&e.push(v);return e},O.unsubscribe=function(a){var d=function(T){var x;for(x in E)if(Object.prototype.hasOwnProperty.call(E,x)&&x.indexOf(T)===0)return!0;return!1},v=typeof a=="string"&&(Object.prototype.hasOwnProperty.call(E,a)||d(a)),e=!v&&typeof a=="string",t=typeof a=="function",u=!1,_,w,L;if(v){O.clearSubscriptions(a);return}for(_ in E)if(Object.prototype.hasOwnProperty.call(E,_)){if(w=E[_],e&&w[a]){delete w[a],u=a;break}if(t)for(L in w)Object.prototype.hasOwnProperty.call(w,L)&&w[L]===a&&(delete w[L],u=!0)}return u}})}(Fe,Fe.exports)),Fe.exports}Jn();function tr(i,S=2){if(!+i)return"0 Bytes";const O=1e3,E=S<0?0:S,P=["Bytes","KB","MB","GB","TB"],g=Math.floor(Math.log(i)/Math.log(O));return"".concat(parseFloat((i/Math.pow(O,g)).toFixed(E))," ").concat(P[g])}const it={IMAGE_UPLOAD_NEW_IMAGE:"image-upload-new-image",TOOLBAR_ANNOTATIONS_TOGGLED:"toolbar-annotations-toggled",TOOLBAR_FONT_SIZE_CHANGED:"toolbar-font-size-changed",TOOLBAR_ZOOM_CHANGED:"toolbar-zoom-changed",TOOLBAR_STROKE_WIDTH_SELECTED:"toolbar-stroke-width-selected",TOOLBAR_STROKE_COLOR_CHANGED:"toolbar-stroke-color-changed",TOOLBAR_FONT_COLOR_CHANGED:"toolbar-font-color-changed",TOOLBAR_STROKE_CLICKED:"toolbar-stroke-clicked",TOOLBAR_FONT_CLICKED:"toolbar-font-clicked",TOOLBAR_ERASER_CLICKED:"toolbar-eraser-clicked"},Et=document.querySelector(".c-image-upload__dropzone"),Nt=document.querySelector(".c-image-upload__file"),Ze=document.querySelector(".c-image-upload__error"),er=Et.textContent,ir=["image/jpeg","image/png","image/web","image/gif"];function Tn(i){if(!ir.includes(i.type))throw new Error("Invalid file type. Accepted types: JPEG, PNG, WEBP or GIF.")}function Pn(i){Ze.textContent=i,Ze.classList.remove("d-none")}function En(){Ze.classList.add("d-none")}Et.addEventListener("click",()=>Nt.click());Et.addEventListener("dragover",i=>{i.preventDefault(),Et.classList.add("is-dragging")});Et.addEventListener("dragleave",()=>{Et.classList.remove("is-dragging")});Et.addEventListener("drop",i=>{i.preventDefault(),Et.classList.remove("is-dragging"),En();try{const S=i.dataTransfer.files[0];Tn(S),Nt.files=i.dataTransfer.files,An()}catch(S){Pn(S.message)}});Nt.addEventListener("change",()=>{En();try{Nt.files.length>0&&(Tn(Nt.files[0]),An())}catch(i){Pn(i.message),Nt.value=""}});function An(){var O;const i=(O=Nt.files)==null?void 0:O[0],S=i?i.name:er;Et.textContent="".concat(S," (").concat(tr(i.size),")"),PubSub.publish(it.IMAGE_UPLOAD_NEW_IMAGE,i)}const Rn=document.querySelector(".c-toolbar__font-range"),Gt=document.querySelector(".c-toolbar__font-size"),nr=document.querySelector(".c-toolbar__font-color"),ai=document.querySelector(".c-toolbar__font"),Qe=14,Je=72;ai.addEventListener("click",rr);function rr(){ai.classList.add("active"),PubSub.publish(it.TOOLBAR_FONT_CLICKED)}nr.addEventListener("input",sr);function sr(i){PubSub.publish(it.TOOLBAR_FONT_COLOR_CHANGED,i.target.value)}Rn.addEventListener("input",ar);function ar(i){PubSub.publish(it.TOOLBAR_FONT_SIZE_CHANGED,parseInt(i.target.value,10)),Gt.value=i.target.value}Gt.addEventListener("input",or);Gt.addEventListener("blur",hr);Gt.addEventListener("keydown",lr);function or(i){const S=parseInt(i.target.value,10);isNaN(S)||S>=Qe&&S<=Je&&(PubSub.publish(it.TOOLBAR_FONT_SIZE_CHANGED,S),Rn.value=S)}function hr(i){const S=parseInt(i.target.value,10);isNaN(S)||(S>Je&&(Gt.value=Je),S<Qe&&(Gt.value=Qe),Gt.dispatchEvent(new Event("input")))}function lr(i){i.key==="Enter"&&(i.preventDefault(),this.blur())}PubSub.subscribe(it.TOOLBAR_STROKE_CLICKED,On);PubSub.subscribe(it.TOOLBAR_ERASER_CLICKED,On);function On(){ai.classList.remove("active")}const cr=document.querySelectorAll('input[name="stroke-radio"]'),dr=document.querySelector(".c-toolbar__stroke-color"),oi=document.querySelector(".c-toolbar__stroke");cr.forEach(i=>{i.addEventListener("change",S=>{PubSub.publish(it.TOOLBAR_STROKE_WIDTH_SELECTED,S.target.value.toUpperCase()),hi()})});dr.addEventListener("input",ur);oi.addEventListener("click",hi);function ur(i){PubSub.publish(it.TOOLBAR_STROKE_COLOR_CHANGED,i.target.value),hi()}function hi(){oi.classList.add("active"),PubSub.publish(it.TOOLBAR_STROKE_CLICKED)}PubSub.subscribe(it.TOOLBAR_FONT_CLICKED,kn);PubSub.subscribe(it.TOOLBAR_ERASER_CLICKED,kn);function kn(){oi.classList.remove("active")}const li=document.querySelector(".c-toolbar__eraser");li.addEventListener("click",fr);function fr(){li.classList.add("active"),PubSub.publish(it.TOOLBAR_ERASER_CLICKED)}PubSub.subscribe(it.TOOLBAR_FONT_CLICKED,Fn);PubSub.subscribe(it.TOOLBAR_STROKE_CLICKED,Fn);function Fn(){li.classList.remove("active")}const gr=document.querySelectorAll('input[name="annotations-radio"]');gr.forEach(i=>{i.addEventListener("change",S=>{const O=S.target.value==="off";PubSub.publish(it.TOOLBAR_ANNOTATIONS_TOGGLED,O)})});const Ln=document.querySelector(".c-toolbar__zoom-out"),Mn=document.querySelector(".c-toolbar__zoom-in"),ti=1,ei=4;let St=1;const Nn={1:1,2:1.5,3:2.5,4:4};Ln.addEventListener("click",_r);Mn.addEventListener("click",pr);function pr(i){St++,St>ei&&(St=ei),Gn(),PubSub.publish(it.TOOLBAR_ZOOM_CHANGED,Nn[St])}function _r(i){St--,St<ti&&(St=ti),Gn(),PubSub.publish(it.TOOLBAR_ZOOM_CHANGED,Nn[St])}function Gn(){Mn.disabled=St===ei,Ln.disabled=St===ti}var Ne={exports:{}},Wt={},Ve={},He={},mi;function Z(){return mi||(mi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i._registerNode=i.Konva=i.glob=void 0;const S=Math.PI/180;function O(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}i.glob=typeof Mt<"u"?Mt:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},i.Konva={_global:i.glob,version:"9.3.20",isBrowser:O(),isUnminified:/param/.test((function(P){}).toString()),dblClickWindow:400,getAngle(P){return i.Konva.angleDeg?P*S:P},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return i.Konva.DD.isDragging},isTransforming(){var P;return(P=i.Konva.Transformer)===null||P===void 0?void 0:P.isTransforming()},isDragReady(){return!!i.Konva.DD.node},releaseCanvasOnDestroy:!0,document:i.glob.document,_injectGlobal(P){i.glob.Konva=P}};const E=P=>{i.Konva[P.prototype.getClassName()]=P};i._registerNode=E,i.Konva._injectGlobal(i.Konva)}(He)),He}var qe={},yi;function st(){return yi||(yi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Util=i.Transform=void 0;const S=Z();class O{constructor(u=[1,0,0,1,0,0]){this.dirty=!1,this.m=u&&u.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new O(this.m)}copyInto(u){u.m[0]=this.m[0],u.m[1]=this.m[1],u.m[2]=this.m[2],u.m[3]=this.m[3],u.m[4]=this.m[4],u.m[5]=this.m[5]}point(u){const _=this.m;return{x:_[0]*u.x+_[2]*u.y+_[4],y:_[1]*u.x+_[3]*u.y+_[5]}}translate(u,_){return this.m[4]+=this.m[0]*u+this.m[2]*_,this.m[5]+=this.m[1]*u+this.m[3]*_,this}scale(u,_){return this.m[0]*=u,this.m[1]*=u,this.m[2]*=_,this.m[3]*=_,this}rotate(u){const _=Math.cos(u),w=Math.sin(u),L=this.m[0]*_+this.m[2]*w,T=this.m[1]*_+this.m[3]*w,x=this.m[0]*-w+this.m[2]*_,C=this.m[1]*-w+this.m[3]*_;return this.m[0]=L,this.m[1]=T,this.m[2]=x,this.m[3]=C,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(u,_){const w=this.m[0]+this.m[2]*_,L=this.m[1]+this.m[3]*_,T=this.m[2]+this.m[0]*u,x=this.m[3]+this.m[1]*u;return this.m[0]=w,this.m[1]=L,this.m[2]=T,this.m[3]=x,this}multiply(u){const _=this.m[0]*u.m[0]+this.m[2]*u.m[1],w=this.m[1]*u.m[0]+this.m[3]*u.m[1],L=this.m[0]*u.m[2]+this.m[2]*u.m[3],T=this.m[1]*u.m[2]+this.m[3]*u.m[3],x=this.m[0]*u.m[4]+this.m[2]*u.m[5]+this.m[4],C=this.m[1]*u.m[4]+this.m[3]*u.m[5]+this.m[5];return this.m[0]=_,this.m[1]=w,this.m[2]=L,this.m[3]=T,this.m[4]=x,this.m[5]=C,this}invert(){const u=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),_=this.m[3]*u,w=-this.m[1]*u,L=-this.m[2]*u,T=this.m[0]*u,x=u*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),C=u*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=_,this.m[1]=w,this.m[2]=L,this.m[3]=T,this.m[4]=x,this.m[5]=C,this}getMatrix(){return this.m}decompose(){const u=this.m[0],_=this.m[1],w=this.m[2],L=this.m[3],T=this.m[4],x=this.m[5],C=u*L-_*w,A={x:T,y:x,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(u!=0||_!=0){const M=Math.sqrt(u*u+_*_);A.rotation=_>0?Math.acos(u/M):-Math.acos(u/M),A.scaleX=M,A.scaleY=C/M,A.skewX=(u*w+_*L)/C,A.skewY=0}else if(w!=0||L!=0){const M=Math.sqrt(w*w+L*L);A.rotation=Math.PI/2-(L>0?Math.acos(-w/M):-Math.acos(w/M)),A.scaleX=C/M,A.scaleY=M,A.skewX=0,A.skewY=(u*w+_*L)/C}return A.rotation=i.Util._getRotation(A.rotation),A}}i.Transform=O;const E="[object Array]",P="[object Number]",g="[object String]",l="[object Boolean]",r=Math.PI/180,c=180/Math.PI,h="#",f="",y="0",m="Konva warning: ",o="Konva error: ",s="rgb(",a={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let v=[];const e=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(t){setTimeout(t,60)};i.Util={_isElement(t){return!!(t&&t.nodeType==1)},_isFunction(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isPlainObject(t){return!!t&&t.constructor===Object},_isArray(t){return Object.prototype.toString.call(t)===E},_isNumber(t){return Object.prototype.toString.call(t)===P&&!isNaN(t)&&isFinite(t)},_isString(t){return Object.prototype.toString.call(t)===g},_isBoolean(t){return Object.prototype.toString.call(t)===l},isObject(t){return t instanceof Object},isValidSelector(t){if(typeof t!="string")return!1;const u=t[0];return u==="#"||u==="."||u===u.toUpperCase()},_sign(t){return t===0||t>0?1:-1},requestAnimFrame(t){v.push(t),v.length===1&&e(function(){const u=v;v=[],u.forEach(function(_){_()})})},createCanvasElement(){const t=document.createElement("canvas");try{t.style=t.style||{}}catch(u){}return t},createImageElement(){return document.createElement("img")},_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,u){const _=i.Util.createImageElement();_.onload=function(){u(_)},_.src=t},_rgbToHex(t,u,_){return((1<<24)+(t<<16)+(u<<8)+_).toString(16).slice(1)},_hexToRgb(t){t=t.replace(h,f);const u=parseInt(t,16);return{r:u>>16&255,g:u>>8&255,b:u&255}},getRandomColor(){let t=(Math.random()*16777215<<0).toString(16);for(;t.length<6;)t=y+t;return h+t},getRGB(t){let u;return t in a?(u=a[t],{r:u[0],g:u[1],b:u[2]}):t[0]===h?this._hexToRgb(t.substring(1)):t.substr(0,4)===s?(u=d.exec(t.replace(/ /g,"")),{r:parseInt(u[1],10),g:parseInt(u[2],10),b:parseInt(u[3],10)}):{r:0,g:0,b:0}},colorToRGBA(t){return t=t||"black",i.Util._namedColorToRBA(t)||i.Util._hex3ColorToRGBA(t)||i.Util._hex4ColorToRGBA(t)||i.Util._hex6ColorToRGBA(t)||i.Util._hex8ColorToRGBA(t)||i.Util._rgbColorToRGBA(t)||i.Util._rgbaColorToRGBA(t)||i.Util._hslColorToRGBA(t)},_namedColorToRBA(t){const u=a[t.toLowerCase()];return u?{r:u[0],g:u[1],b:u[2],a:1}:null},_rgbColorToRGBA(t){if(t.indexOf("rgb(")===0){t=t.match(/rgb\(([^)]+)\)/)[1];const u=t.split(/ *, */).map(Number);return{r:u[0],g:u[1],b:u[2],a:1}}},_rgbaColorToRGBA(t){if(t.indexOf("rgba(")===0){t=t.match(/rgba\(([^)]+)\)/)[1];const u=t.split(/ *, */).map((_,w)=>_.slice(-1)==="%"?w===3?parseInt(_)/100:parseInt(_)/100*255:Number(_));return{r:u[0],g:u[1],b:u[2],a:u[3]}}},_hex8ColorToRGBA(t){if(t[0]==="#"&&t.length===9)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if(t[0]==="#"&&t.length===7)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if(t[0]==="#"&&t.length===5)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if(t[0]==="#"&&t.length===4)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[u,..._]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),w=Number(_[0])/360,L=Number(_[1])/100,T=Number(_[2])/100;let x,C,A;if(L===0)return A=T*255,{r:Math.round(A),g:Math.round(A),b:Math.round(A),a:1};T<.5?x=T*(1+L):x=T+L-T*L;const M=2*T-x,n=[0,0,0];for(let b=0;b<3;b++)C=w+1/3*-(b-1),C<0&&C++,C>1&&C--,6*C<1?A=M+(x-M)*6*C:2*C<1?A=x:3*C<2?A=M+(x-M)*(2/3-C)*6:A=M,n[b]=A*255;return{r:Math.round(n[0]),g:Math.round(n[1]),b:Math.round(n[2]),a:1}}},haveIntersection(t,u){return!(u.x>t.x+t.width||u.x+u.width<t.x||u.y>t.y+t.height||u.y+u.height<t.y)},cloneObject(t){const u={};for(const _ in t)this._isPlainObject(t[_])?u[_]=this.cloneObject(t[_]):this._isArray(t[_])?u[_]=this.cloneArray(t[_]):u[_]=t[_];return u},cloneArray(t){return t.slice(0)},degToRad(t){return t*r},radToDeg(t){return t*c},_degToRad(t){return i.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),i.Util.degToRad(t)},_radToDeg(t){return i.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),i.Util.radToDeg(t)},_getRotation(t){return S.Konva.angleDeg?i.Util.radToDeg(t):t},_capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)},throw(t){throw new Error(o+t)},error(t){console.error(o+t)},warn(t){S.Konva.showWarnings&&console.warn(m+t)},each(t,u){for(const _ in t)u(_,t[_])},_inRange(t,u,_){return u<=t&&t<_},_getProjectionToSegment(t,u,_,w,L,T){let x,C,A;const M=(t-_)*(t-_)+(u-w)*(u-w);if(M==0)x=t,C=u,A=(L-_)*(L-_)+(T-w)*(T-w);else{const n=((L-t)*(_-t)+(T-u)*(w-u))/M;n<0?(x=t,C=u,A=(t-L)*(t-L)+(u-T)*(u-T)):n>1?(x=_,C=w,A=(_-L)*(_-L)+(w-T)*(w-T)):(x=t+n*(_-t),C=u+n*(w-u),A=(x-L)*(x-L)+(C-T)*(C-T))}return[x,C,A]},_getProjectionToLine(t,u,_){const w=i.Util.cloneObject(t);let L=Number.MAX_VALUE;return u.forEach(function(T,x){if(!_&&x===u.length-1)return;const C=u[(x+1)%u.length],A=i.Util._getProjectionToSegment(T.x,T.y,C.x,C.y,t.x,t.y),M=A[0],n=A[1],b=A[2];b<L&&(w.x=M,w.y=n,L=b)}),w},_prepareArrayForTween(t,u,_){const w=[],L=[];if(t.length>u.length){const x=u;u=t,t=x}for(let x=0;x<t.length;x+=2)w.push({x:t[x],y:t[x+1]});for(let x=0;x<u.length;x+=2)L.push({x:u[x],y:u[x+1]});const T=[];return L.forEach(function(x){const C=i.Util._getProjectionToLine(x,w,_);T.push(C.x),T.push(C.y)}),T},_prepareToStringify(t){let u;t.visitedByCircularReferenceRemoval=!0;for(const _ in t)if(t.hasOwnProperty(_)&&t[_]&&typeof t[_]=="object"){if(u=Object.getOwnPropertyDescriptor(t,_),t[_].visitedByCircularReferenceRemoval||i.Util._isElement(t[_]))if(u.configurable)delete t[_];else return null;else if(i.Util._prepareToStringify(t[_])===null)if(u.configurable)delete t[_];else return null}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,u){for(const _ in u)t[_]=u[_];return t},_getFirstPointerId(t){return t.touches?t.changedTouches[0].identifier:t.pointerId||999},releaseCanvas(...t){S.Konva.releaseCanvasOnDestroy&&t.forEach(u=>{u.width=0,u.height=0})},drawRoundedRectPath(t,u,_,w){let L=0,T=0,x=0,C=0;typeof w=="number"?L=T=x=C=Math.min(w,u/2,_/2):(L=Math.min(w[0]||0,u/2,_/2),T=Math.min(w[1]||0,u/2,_/2),C=Math.min(w[2]||0,u/2,_/2),x=Math.min(w[3]||0,u/2,_/2)),t.moveTo(L,0),t.lineTo(u-T,0),t.arc(u-T,T,T,Math.PI*3/2,0,!1),t.lineTo(u,_-C),t.arc(u-C,_-C,C,0,Math.PI/2,!1),t.lineTo(x,_),t.arc(x,_-x,x,Math.PI/2,Math.PI,!1),t.lineTo(0,L),t.arc(L,L,L,Math.PI,Math.PI*3/2,!1)}}}(qe)),qe}var Kt={},ze={},dt={},bi;function J(){if(bi)return dt;bi=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.RGBComponent=E,dt.alphaComponent=P,dt.getNumberValidator=g,dt.getNumberOrArrayOfNumbersValidator=l,dt.getNumberOrAutoValidator=r,dt.getStringValidator=c,dt.getStringOrGradientValidator=h,dt.getFunctionValidator=f,dt.getNumberArrayValidator=y,dt.getBooleanValidator=m,dt.getComponentValidator=o;const i=Z(),S=st();function O(s){return S.Util._isString(s)?'"'+s+'"':Object.prototype.toString.call(s)==="[object Number]"||S.Util._isBoolean(s)?s:Object.prototype.toString.call(s)}function E(s){return s>255?255:s<0?0:Math.round(s)}function P(s){return s>1?1:s<1e-4?1e-4:s}function g(){if(i.Konva.isUnminified)return function(s,a){return S.Util._isNumber(s)||S.Util.warn(O(s)+' is a not valid value for "'+a+'" attribute. The value should be a number.'),s}}function l(s){if(i.Konva.isUnminified)return function(a,d){let v=S.Util._isNumber(a),e=S.Util._isArray(a)&&a.length==s;return!v&&!e&&S.Util.warn(O(a)+' is a not valid value for "'+d+'" attribute. The value should be a number or Array<number>('+s+")"),a}}function r(){if(i.Konva.isUnminified)return function(s,a){var d=S.Util._isNumber(s),v=s==="auto";return d||v||S.Util.warn(O(s)+' is a not valid value for "'+a+'" attribute. The value should be a number or "auto".'),s}}function c(){if(i.Konva.isUnminified)return function(s,a){return S.Util._isString(s)||S.Util.warn(O(s)+' is a not valid value for "'+a+'" attribute. The value should be a string.'),s}}function h(){if(i.Konva.isUnminified)return function(s,a){const d=S.Util._isString(s),v=Object.prototype.toString.call(s)==="[object CanvasGradient]"||s&&s.addColorStop;return d||v||S.Util.warn(O(s)+' is a not valid value for "'+a+'" attribute. The value should be a string or a native gradient.'),s}}function f(){if(i.Konva.isUnminified)return function(s,a){return S.Util._isFunction(s)||S.Util.warn(O(s)+' is a not valid value for "'+a+'" attribute. The value should be a function.'),s}}function y(){if(i.Konva.isUnminified)return function(s,a){const d=Int8Array?Object.getPrototypeOf(Int8Array):null;return d&&s instanceof d||(S.Util._isArray(s)?s.forEach(function(v){S.Util._isNumber(v)||S.Util.warn('"'+a+'" attribute has non numeric element '+v+". Make sure that all elements are numbers.")}):S.Util.warn(O(s)+' is a not valid value for "'+a+'" attribute. The value should be a array of numbers.')),s}}function m(){if(i.Konva.isUnminified)return function(s,a){var d=s===!0||s===!1;return d||S.Util.warn(O(s)+' is a not valid value for "'+a+'" attribute. The value should be a boolean.'),s}}function o(s){if(i.Konva.isUnminified)return function(a,d){return a==null||S.Util.isObject(a)||S.Util.warn(O(a)+' is a not valid value for "'+d+'" attribute. The value should be an object with properties '+s),a}}return dt}var vi;function Q(){return vi||(vi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Factory=void 0;const S=st(),O=J(),E="get",P="set";i.Factory={addGetterSetter(g,l,r,c,h){i.Factory.addGetter(g,l,r),i.Factory.addSetter(g,l,c,h),i.Factory.addOverloadedGetterSetter(g,l)},addGetter(g,l,r){var c=E+S.Util._capitalize(l);g.prototype[c]=g.prototype[c]||function(){const h=this.attrs[l];return h===void 0?r:h}},addSetter(g,l,r,c){var h=P+S.Util._capitalize(l);g.prototype[h]||i.Factory.overWriteSetter(g,l,r,c)},overWriteSetter(g,l,r,c){var h=P+S.Util._capitalize(l);g.prototype[h]=function(f){return r&&f!==void 0&&f!==null&&(f=r.call(this,f,l)),this._setAttr(l,f),c&&c.call(this),this}},addComponentsGetterSetter(g,l,r,c,h){const f=r.length,y=S.Util._capitalize,m=E+y(l),o=P+y(l);g.prototype[m]=function(){const a={};for(let d=0;d<f;d++){const v=r[d];a[v]=this.getAttr(l+y(v))}return a};const s=(0,O.getComponentValidator)(r);g.prototype[o]=function(a){const d=this.attrs[l];c&&(a=c.call(this,a,l)),s&&s.call(this,a,l);for(const v in a)a.hasOwnProperty(v)&&this._setAttr(l+y(v),a[v]);return a||r.forEach(v=>{this._setAttr(l+y(v),void 0)}),this._fireChangeEvent(l,d,a),h&&h.call(this),this},i.Factory.addOverloadedGetterSetter(g,l)},addOverloadedGetterSetter(g,l){var r=S.Util._capitalize(l),c=P+r,h=E+r;g.prototype[l]=function(){return arguments.length?(this[c](arguments[0]),this):this[h]()}},addDeprecatedGetterSetter(g,l,r,c){S.Util.error("Adding deprecated "+l);const h=E+S.Util._capitalize(l),f=l+" property is deprecated and will be removed soon. Look at Konva change log for more information.";g.prototype[h]=function(){S.Util.error(f);const y=this.attrs[l];return y===void 0?r:y},i.Factory.addSetter(g,l,c,function(){S.Util.error(f)}),i.Factory.addOverloadedGetterSetter(g,l)},backCompat(g,l){S.Util.each(l,function(r,c){const h=g.prototype[c],f=E+S.Util._capitalize(r),y=P+S.Util._capitalize(r);function m(){h.apply(this,arguments),S.Util.error('"'+r+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}g.prototype[r]=m,g.prototype[f]=m,g.prototype[y]=m})},afterSetFilter(){this._filterUpToDate=!1}}}(ze)),ze}var Tt={},Pt={},Si;function Dn(){if(Si)return Pt;Si=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.HitContext=Pt.SceneContext=Pt.Context=void 0;const i=st(),S=Z();function O(v){const e=[],t=v.length,u=i.Util;for(let _=0;_<t;_++){let w=v[_];u._isNumber(w)?w=Math.round(w*1e3)/1e3:u._isString(w)||(w=w+""),e.push(w)}return e}const E=",",P="(",g=")",l="([",r="])",c=";",h="()",f="=",y=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],m=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],o=100;let s=class{constructor(e){this.canvas=e,S.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){let u=this.traceArr,_=u.length,w="",L,T,x,C;for(L=0;L<_;L++)T=u[L],x=T.method,x?(C=T.args,w+=x,e?w+=h:i.Util._isArray(C[0])?w+=l+C.join(E)+r:(t&&(C=C.map(A=>typeof A=="number"?Math.floor(A):A)),w+=P+C.join(E)+g)):(w+=T.property,e||(w+=f+T.val)),w+=c;return w}clearTrace(){this.traceArr=[]}_trace(e){let t=this.traceArr,u;t.push(e),u=t.length,u>=o&&t.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){const t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){const t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){const t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}setAttr(e,t){this._context[e]=t}arc(e,t,u,_,w,L){this._context.arc(e,t,u,_,w,L)}arcTo(e,t,u,_,w){this._context.arcTo(e,t,u,_,w)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,u,_,w,L){this._context.bezierCurveTo(e,t,u,_,w,L)}clearRect(e,t,u,_){this._context.clearRect(e,t,u,_)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){const u=arguments;if(u.length===2)return this._context.createImageData(e,t);if(u.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,u,_){return this._context.createLinearGradient(e,t,u,_)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,u,_,w,L){return this._context.createRadialGradient(e,t,u,_,w,L)}drawImage(e,t,u,_,w,L,T,x,C){const A=arguments,M=this._context;A.length===3?M.drawImage(e,t,u):A.length===5?M.drawImage(e,t,u,_,w):A.length===9&&M.drawImage(e,t,u,_,w,L,T,x,C)}ellipse(e,t,u,_,w,L,T,x){this._context.ellipse(e,t,u,_,w,L,T,x)}isPointInPath(e,t,u,_){return u?this._context.isPointInPath(u,e,t,_):this._context.isPointInPath(e,t,_)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,u,_){this._context.fillRect(e,t,u,_)}strokeRect(e,t,u,_){this._context.strokeRect(e,t,u,_)}fillText(e,t,u,_){_?this._context.fillText(e,t,u,_):this._context.fillText(e,t,u)}measureText(e){return this._context.measureText(e)}getImageData(e,t,u,_){return this._context.getImageData(e,t,u,_)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,u,_){this._context.rect(e,t,u,_)}roundRect(e,t,u,_,w){this._context.roundRect(e,t,u,_,w)}putImageData(e,t,u){this._context.putImageData(e,t,u)}quadraticCurveTo(e,t,u,_){this._context.quadraticCurveTo(e,t,u,_)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,u,_,w,L){this._context.setTransform(e,t,u,_,w,L)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,u,_){this._context.strokeText(e,t,u,_)}transform(e,t,u,_,w,L){this._context.transform(e,t,u,_,w,L)}translate(e,t){this._context.translate(e,t)}_enableTrace(){let e=this,t=y.length,u=this.setAttr,_,w;const L=function(T){let x=e[T],C;e[T]=function(){return w=O(Array.prototype.slice.call(arguments,0)),C=x.apply(e,arguments),e._trace({method:T,args:w}),C}};for(_=0;_<t;_++)L(y[_]);e.setAttr=function(){u.apply(e,arguments);const T=arguments[0];let x=arguments[1];(T==="shadowOffsetX"||T==="shadowOffsetY"||T==="shadowBlur")&&(x=x/this.canvas.getPixelRatio()),e._trace({property:T,val:x})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;!t||t==="source-over"||this.setAttr("globalCompositeOperation",t)}};Pt.Context=s,m.forEach(function(v){Object.defineProperty(s.prototype,v,{get(){return this._context[v]},set(e){this._context[v]=e}})});class a extends s{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){const t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){const t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){const t=e.fill(),u=e.getFillPriority();if(t&&u==="color"){this._fillColor(e);return}const _=e.getFillPatternImage();if(_&&u==="pattern"){this._fillPattern(e);return}const w=e.getFillLinearGradientColorStops();if(w&&u==="linear-gradient"){this._fillLinearGradient(e);return}const L=e.getFillRadialGradientColorStops();if(L&&u==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):_?this._fillPattern(e):w?this._fillLinearGradient(e):L&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const t=e.getStrokeLinearGradientStartPoint(),u=e.getStrokeLinearGradientEndPoint(),_=e.getStrokeLinearGradientColorStops(),w=this.createLinearGradient(t.x,t.y,u.x,u.y);if(_){for(let L=0;L<_.length;L+=2)w.addColorStop(_[L],_[L+1]);this.setAttr("strokeStyle",w)}}_stroke(e){const t=e.dash(),u=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!u){this.save();const w=this.getCanvas().getPixelRatio();this.setTransform(w,0,0,w,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),u||this.restore()}}_applyShadow(e){var t,u,_;const w=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",L=(u=e.getShadowBlur())!==null&&u!==void 0?u:5,T=(_=e.getShadowOffset())!==null&&_!==void 0?_:{x:0,y:0},x=e.getAbsoluteScale(),C=this.canvas.getPixelRatio(),A=x.x*C,M=x.y*C;this.setAttr("shadowColor",w),this.setAttr("shadowBlur",L*Math.min(Math.abs(A),Math.abs(M))),this.setAttr("shadowOffsetX",T.x*A),this.setAttr("shadowOffsetY",T.y*M)}}Pt.SceneContext=a;class d extends s{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const t=e.getStrokeScaleEnabled();if(!t){this.save();const w=this.getCanvas().getPixelRatio();this.setTransform(w,0,0,w,0,0)}this._applyLineCap(e);const u=e.hitStrokeWidth(),_=u==="auto"?e.strokeWidth():u;this.setAttr("lineWidth",_),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}return Pt.HitContext=d,Pt}var Ci;function De(){if(Ci)return Tt;Ci=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.HitCanvas=Tt.SceneCanvas=Tt.Canvas=void 0;const i=st(),S=Dn(),O=Z();let E;function P(){if(E)return E;const c=i.Util.createCanvasElement(),h=c.getContext("2d");return E=function(){const f=O.Konva._global.devicePixelRatio||1,y=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1;return f/y}(),i.Util.releaseCanvas(c),E}let g=class{constructor(h){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const y=(h||{}).pixelRatio||O.Konva.pixelRatio||P();this.pixelRatio=y,this._canvas=i.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(h){const f=this.pixelRatio;this.pixelRatio=h,this.setSize(this.getWidth()/f,this.getHeight()/f)}setWidth(h){this.width=this._canvas.width=h*this.pixelRatio,this._canvas.style.width=h+"px";const f=this.pixelRatio;this.getContext()._context.scale(f,f)}setHeight(h){this.height=this._canvas.height=h*this.pixelRatio,this._canvas.style.height=h+"px";const f=this.pixelRatio;this.getContext()._context.scale(f,f)}getWidth(){return this.width}getHeight(){return this.height}setSize(h,f){this.setWidth(h||0),this.setHeight(f||0)}toDataURL(h,f){try{return this._canvas.toDataURL(h,f)}catch(y){try{return this._canvas.toDataURL()}catch(m){return i.Util.error("Unable to get data URL. "+m.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};Tt.Canvas=g;class l extends g{constructor(h={width:0,height:0,willReadFrequently:!1}){super(h),this.context=new S.SceneContext(this,{willReadFrequently:h.willReadFrequently}),this.setSize(h.width,h.height)}}Tt.SceneCanvas=l;class r extends g{constructor(h={width:0,height:0}){super(h),this.hitCanvas=!0,this.context=new S.HitContext(this),this.setSize(h.width,h.height)}}return Tt.HitCanvas=r,Tt}var We={},wi;function ci(){return wi||(wi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.DD=void 0;const S=Z(),O=st();i.DD={get isDragging(){let E=!1;return i.DD._dragElements.forEach(P=>{P.dragStatus==="dragging"&&(E=!0)}),E},justDragged:!1,get node(){let E;return i.DD._dragElements.forEach(P=>{E=P.node}),E},_dragElements:new Map,_drag(E){const P=[];i.DD._dragElements.forEach((g,l)=>{const{node:r}=g,c=r.getStage();c.setPointersPositions(E),g.pointerId===void 0&&(g.pointerId=O.Util._getFirstPointerId(E));const h=c._changedPointerPositions.find(f=>f.id===g.pointerId);if(h){if(g.dragStatus!=="dragging"){const f=r.dragDistance();if(Math.max(Math.abs(h.x-g.startPointerPos.x),Math.abs(h.y-g.startPointerPos.y))<f||(r.startDrag({evt:E}),!r.isDragging()))return}r._setDragPosition(E,g),P.push(r)}}),P.forEach(g=>{g.fire("dragmove",{type:"dragmove",target:g,evt:E},!0)})},_endDragBefore(E){const P=[];i.DD._dragElements.forEach(g=>{const{node:l}=g,r=l.getStage();if(E&&r.setPointersPositions(E),!r._changedPointerPositions.find(f=>f.id===g.pointerId))return;(g.dragStatus==="dragging"||g.dragStatus==="stopped")&&(i.DD.justDragged=!0,S.Konva._mouseListenClick=!1,S.Konva._touchListenClick=!1,S.Konva._pointerListenClick=!1,g.dragStatus="stopped");const h=g.node.getLayer()||g.node instanceof S.Konva.Stage&&g.node;h&&P.indexOf(h)===-1&&P.push(h)}),P.forEach(g=>{g.draw()})},_endDragAfter(E){i.DD._dragElements.forEach((P,g)=>{P.dragStatus==="stopped"&&P.node.fire("dragend",{type:"dragend",target:P.node,evt:E},!0),P.dragStatus!=="dragging"&&i.DD._dragElements.delete(g)})}},S.Konva.isBrowser&&(window.addEventListener("mouseup",i.DD._endDragBefore,!0),window.addEventListener("touchend",i.DD._endDragBefore,!0),window.addEventListener("touchcancel",i.DD._endDragBefore,!0),window.addEventListener("mousemove",i.DD._drag),window.addEventListener("touchmove",i.DD._drag),window.addEventListener("mouseup",i.DD._endDragAfter,!1),window.addEventListener("touchend",i.DD._endDragAfter,!1),window.addEventListener("touchcancel",i.DD._endDragAfter,!1))}(We)),We}var xi;function ot(){if(xi)return Kt;xi=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.Node=void 0;const i=st(),S=Q(),O=De(),E=Z(),P=ci(),g=J(),l="absoluteOpacity",r="allEventListeners",c="absoluteTransform",h="absoluteScale",f="canvas",y="Change",m="children",o="konva",s="listening",a="mouseenter",d="mouseleave",v="set",e="Shape",t=" ",u="stage",_="transform",w="Stage",L="visible",T=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(t);let x=1,C=class ii{constructor(n){this._id=x++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(n),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(n){(n===_||n===c)&&this._cache.get(n)?this._cache.get(n).dirty=!0:n?this._cache.delete(n):this._cache.clear()}_getCache(n,b){let p=this._cache.get(n);return(p===void 0||(n===_||n===c)&&p.dirty===!0)&&(p=b.call(this),this._cache.set(n,p)),p}_calculate(n,b,p){if(!this._attachedDepsListeners.get(n)){const R=b.map(k=>k+"Change.konva").join(t);this.on(R,()=>{this._clearCache(n)}),this._attachedDepsListeners.set(n,!0)}return this._getCache(n,p)}_getCanvasCache(){return this._cache.get(f)}_clearSelfAndDescendantCache(n){this._clearCache(n),n===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(f)){const{scene:n,filter:b,hit:p}=this._cache.get(f);i.Util.releaseCanvas(n,b,p),this._cache.delete(f)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(n){const b=n||{};let p={};(b.x===void 0||b.y===void 0||b.width===void 0||b.height===void 0)&&(p=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let R=Math.ceil(b.width||p.width),k=Math.ceil(b.height||p.height),N=b.pixelRatio,I=b.x===void 0?Math.floor(p.x):b.x,D=b.y===void 0?Math.floor(p.y):b.y,U=b.offset||0,z=b.drawBorder||!1,B=b.hitCanvasPixelRatio||1;if(!R||!k){i.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const H=Math.abs(Math.round(p.x)-I)>.5?1:0,W=Math.abs(Math.round(p.y)-D)>.5?1:0;R+=U*2+H,k+=U*2+W,I-=U,D-=U;const K=new O.SceneCanvas({pixelRatio:N,width:R,height:k}),F=new O.SceneCanvas({pixelRatio:N,width:0,height:0,willReadFrequently:!0}),G=new O.HitCanvas({pixelRatio:B,width:R,height:k}),V=K.getContext(),q=G.getContext();return G.isCache=!0,K.isCache=!0,this._cache.delete(f),this._filterUpToDate=!1,b.imageSmoothingEnabled===!1&&(K.getContext()._context.imageSmoothingEnabled=!1,F.getContext()._context.imageSmoothingEnabled=!1),V.save(),q.save(),V.translate(-I,-D),q.translate(-I,-D),this._isUnderCache=!0,this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(h),this.drawScene(K,this),this.drawHit(G,this),this._isUnderCache=!1,V.restore(),q.restore(),z&&(V.save(),V.beginPath(),V.rect(0,0,R,k),V.closePath(),V.setAttr("strokeStyle","red"),V.setAttr("lineWidth",5),V.stroke(),V.restore()),this._cache.set(f,{scene:K,filter:F,hit:G,x:I,y:D}),this._requestDraw(),this}isCached(){return this._cache.has(f)}getClientRect(n){throw new Error('abstract "getClientRect" method call')}_transformedRect(n,b){const p=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}];let R=1/0,k=1/0,N=-1/0,I=-1/0;const D=this.getAbsoluteTransform(b);return p.forEach(function(U){const z=D.point(U);R===void 0&&(R=N=z.x,k=I=z.y),R=Math.min(R,z.x),k=Math.min(k,z.y),N=Math.max(N,z.x),I=Math.max(I,z.y)}),{x:R,y:k,width:N-R,height:I-k}}_drawCachedSceneCanvas(n){n.save(),n._applyOpacity(this),n._applyGlobalCompositeOperation(this);const b=this._getCanvasCache();n.translate(b.x,b.y);const p=this._getCachedSceneCanvas(),R=p.pixelRatio;n.drawImage(p._canvas,0,0,p.width/R,p.height/R),n.restore()}_drawCachedHitCanvas(n){const b=this._getCanvasCache(),p=b.hit;n.save(),n.translate(b.x,b.y),n.drawImage(p._canvas,0,0,p.width/p.pixelRatio,p.height/p.pixelRatio),n.restore()}_getCachedSceneCanvas(){let n=this.filters(),b=this._getCanvasCache(),p=b.scene,R=b.filter,k=R.getContext(),N,I,D,U;if(n){if(!this._filterUpToDate){const z=p.pixelRatio;R.setSize(p.width/p.pixelRatio,p.height/p.pixelRatio);try{for(N=n.length,k.clear(),k.drawImage(p._canvas,0,0,p.getWidth()/z,p.getHeight()/z),I=k.getImageData(0,0,R.getWidth(),R.getHeight()),D=0;D<N;D++){if(U=n[D],typeof U!="function"){i.Util.error("Filter should be type of function, but got "+typeof U+" instead. Please check correct filters");continue}U.call(this,I),k.putImageData(I,0,0)}}catch(B){i.Util.error("Unable to apply filter. "+B.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return R}return p}on(n,b){if(this._cache&&this._cache.delete(r),arguments.length===3)return this._delegate.apply(this,arguments);let p=n.split(t),R=p.length,k,N,I,D,U;for(k=0;k<R;k++)N=p[k],I=N.split("."),D=I[0],U=I[1]||"",this.eventListeners[D]||(this.eventListeners[D]=[]),this.eventListeners[D].push({name:U,handler:b});return this}off(n,b){let p=(n||"").split(t),R=p.length,k,N,I,D,U,z;if(this._cache&&this._cache.delete(r),!n)for(N in this.eventListeners)this._off(N);for(k=0;k<R;k++)if(I=p[k],D=I.split("."),U=D[0],z=D[1],U)this.eventListeners[U]&&this._off(U,z,b);else for(N in this.eventListeners)this._off(N,z,b);return this}dispatchEvent(n){const b={target:this,type:n.type,evt:n};return this.fire(n.type,b),this}addEventListener(n,b){return this.on(n,function(p){b.call(this,p.evt)}),this}removeEventListener(n){return this.off(n),this}_delegate(n,b,p){const R=this;this.on(n,function(k){const N=k.target.findAncestors(b,!0,R);for(let I=0;I<N.length;I++)k=i.Util.cloneObject(k),k.currentTarget=N[I],p.call(N[I],k)})}remove(){return this.isDragging()&&this.stopDrag(),P.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(h),this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(L),this._clearSelfAndDescendantCache(s)}_remove(){this._clearCaches();const n=this.getParent();n&&n.children&&(n.children.splice(this.index,1),n._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(n){const b="get"+i.Util._capitalize(n);return i.Util._isFunction(this[b])?this[b]():this.attrs[n]}getAncestors(){let n=this.getParent(),b=[];for(;n;)b.push(n),n=n.getParent();return b}getAttrs(){return this.attrs||{}}setAttrs(n){return this._batchTransformChanges(()=>{let b,p;if(!n)return this;for(b in n)b!==m&&(p=v+i.Util._capitalize(b),i.Util._isFunction(this[p])?this[p](n[b]):this._setAttr(b,n[b]))}),this}isListening(){return this._getCache(s,this._isListening)}_isListening(n){if(!this.listening())return!1;const p=this.getParent();return p&&p!==n&&this!==n?p._isListening(n):!0}isVisible(){return this._getCache(L,this._isVisible)}_isVisible(n){if(!this.visible())return!1;const p=this.getParent();return p&&p!==n&&this!==n?p._isVisible(n):!0}shouldDrawHit(n,b=!1){if(n)return this._isVisible(n)&&this._isListening(n);const p=this.getLayer();let R=!1;P.DD._dragElements.forEach(N=>{N.dragStatus==="dragging"&&(N.node.nodeType==="Stage"||N.node.getLayer()===p)&&(R=!0)});const k=!b&&!E.Konva.hitOnDragEnabled&&(R||E.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!k}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let n=this.getDepth(),b=this,p=0,R,k,N,I;function D(z){for(R=[],k=z.length,N=0;N<k;N++)I=z[N],p++,I.nodeType!==e&&(R=R.concat(I.getChildren().slice())),I._id===b._id&&(N=k);R.length>0&&R[0].getDepth()<=n&&D(R)}const U=this.getStage();return b.nodeType!==w&&U&&D(U.getChildren()),p}getDepth(){let n=0,b=this.parent;for(;b;)n++,b=b.parent;return n}_batchTransformChanges(n){this._batchingTransformChange=!0,n(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(_),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(n){return this._batchTransformChanges(()=>{this.x(n.x),this.y(n.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const n=this.getStage();if(!n)return null;const b=n.getPointerPosition();if(!b)return null;const p=this.getAbsoluteTransform().copy();return p.invert(),p.point(b)}getAbsolutePosition(n){let b=!1,p=this.parent;for(;p;){if(p.isCached()){b=!0;break}p=p.parent}b&&!n&&(n=!0);const R=this.getAbsoluteTransform(n).getMatrix(),k=new i.Transform,N=this.offset();return k.m=R.slice(),k.translate(N.x,N.y),k.getTranslation()}setAbsolutePosition(n){const{x:b,y:p,...R}=this._clearTransform();this.attrs.x=b,this.attrs.y=p,this._clearCache(_);const k=this._getAbsoluteTransform().copy();return k.invert(),k.translate(n.x,n.y),n={x:this.attrs.x+k.getTranslation().x,y:this.attrs.y+k.getTranslation().y},this._setTransform(R),this.setPosition({x:n.x,y:n.y}),this._clearCache(_),this._clearSelfAndDescendantCache(c),this}_setTransform(n){let b;for(b in n)this.attrs[b]=n[b]}_clearTransform(){const n={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,n}move(n){let b=n.x,p=n.y,R=this.x(),k=this.y();return b!==void 0&&(R+=b),p!==void 0&&(k+=p),this.setPosition({x:R,y:k}),this}_eachAncestorReverse(n,b){let p=[],R=this.getParent(),k,N;if(!(b&&b._id===this._id)){for(p.unshift(this);R&&(!b||R._id!==b._id);)p.unshift(R),R=R.parent;for(k=p.length,N=0;N<k;N++)n(p[N])}}rotate(n){return this.rotation(this.rotation()+n),this}moveToTop(){if(!this.parent)return i.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const n=this.index,b=this.parent.getChildren().length;return n<b-1?(this.parent.children.splice(n,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return i.Util.warn("Node has no parent. moveUp function is ignored."),!1;const n=this.index,b=this.parent.getChildren().length;return n<b-1?(this.parent.children.splice(n,1),this.parent.children.splice(n+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return i.Util.warn("Node has no parent. moveDown function is ignored."),!1;const n=this.index;return n>0?(this.parent.children.splice(n,1),this.parent.children.splice(n-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return i.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const n=this.index;return n>0?(this.parent.children.splice(n,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(n){if(!this.parent)return i.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(n<0||n>=this.parent.children.length)&&i.Util.warn("Unexpected value "+n+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(n,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(l,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let n=this.opacity();const b=this.getParent();return b&&!b._isUnderCache&&(n*=b.getAbsoluteOpacity()),n}moveTo(n){return this.getParent()!==n&&(this._remove(),n.add(this)),this}toObject(){let n=this.getAttrs(),b,p,R,k,N;const I={attrs:{},className:this.getClassName()};for(b in n)p=n[b],N=i.Util.isObject(p)&&!i.Util._isPlainObject(p)&&!i.Util._isArray(p),!N&&(R=typeof this[b]=="function"&&this[b],delete n[b],k=R?R.call(this):null,n[b]=p,k!==p&&(I.attrs[b]=p));return i.Util._prepareToStringify(I)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(n,b,p){const R=[];b&&this._isMatch(n)&&R.push(this);let k=this.parent;for(;k;){if(k===p)return R;k._isMatch(n)&&R.push(k),k=k.parent}return R}isAncestorOf(n){return!1}findAncestor(n,b,p){return this.findAncestors(n,b,p)[0]}_isMatch(n){if(!n)return!1;if(typeof n=="function")return n(this);let b=n.replace(/ /g,"").split(","),p=b.length,R,k;for(R=0;R<p;R++)if(k=b[R],i.Util.isValidSelector(k)||(i.Util.warn('Selector "'+k+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),i.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),i.Util.warn("Konva is awesome, right?")),k.charAt(0)==="#"){if(this.id()===k.slice(1))return!0}else if(k.charAt(0)==="."){if(this.hasName(k.slice(1)))return!0}else if(this.className===k||this.nodeType===k)return!0;return!1}getLayer(){const n=this.getParent();return n?n.getLayer():null}getStage(){return this._getCache(u,this._getStage)}_getStage(){const n=this.getParent();return n?n.getStage():null}fire(n,b={},p){return b.target=b.target||this,p?this._fireAndBubble(n,b):this._fire(n,b),this}getAbsoluteTransform(n){return n?this._getAbsoluteTransform(n):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(n){let b;if(n)return b=new i.Transform,this._eachAncestorReverse(function(p){const R=p.transformsEnabled();R==="all"?b.multiply(p.getTransform()):R==="position"&&b.translate(p.x()-p.offsetX(),p.y()-p.offsetY())},n),b;{b=this._cache.get(c)||new i.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(b):b.reset();const p=this.transformsEnabled();if(p==="all")b.multiply(this.getTransform());else if(p==="position"){const R=this.attrs.x||0,k=this.attrs.y||0,N=this.attrs.offsetX||0,I=this.attrs.offsetY||0;b.translate(R-N,k-I)}return b.dirty=!1,b}}getAbsoluteScale(n){let b=this;for(;b;)b._isUnderCache&&(n=b),b=b.getParent();const R=this.getAbsoluteTransform(n).decompose();return{x:R.scaleX,y:R.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(_,this._getTransform)}_getTransform(){var n,b;const p=this._cache.get(_)||new i.Transform;p.reset();const R=this.x(),k=this.y(),N=E.Konva.getAngle(this.rotation()),I=(n=this.attrs.scaleX)!==null&&n!==void 0?n:1,D=(b=this.attrs.scaleY)!==null&&b!==void 0?b:1,U=this.attrs.skewX||0,z=this.attrs.skewY||0,B=this.attrs.offsetX||0,H=this.attrs.offsetY||0;return(R!==0||k!==0)&&p.translate(R,k),N!==0&&p.rotate(N),(U!==0||z!==0)&&p.skew(U,z),(I!==1||D!==1)&&p.scale(I,D),(B!==0||H!==0)&&p.translate(-1*B,-1*H),p.dirty=!1,p}clone(n){let b=i.Util.cloneObject(this.attrs),p,R,k,N,I;for(p in n)b[p]=n[p];const D=new this.constructor(b);for(p in this.eventListeners)for(R=this.eventListeners[p],k=R.length,N=0;N<k;N++)I=R[N],I.name.indexOf(o)<0&&(D.eventListeners[p]||(D.eventListeners[p]=[]),D.eventListeners[p].push(I));return D}_toKonvaCanvas(n){n=n||{};const b=this.getClientRect(),p=this.getStage(),R=n.x!==void 0?n.x:Math.floor(b.x),k=n.y!==void 0?n.y:Math.floor(b.y),N=n.pixelRatio||1,I=new O.SceneCanvas({width:n.width||Math.ceil(b.width)||(p?p.width():0),height:n.height||Math.ceil(b.height)||(p?p.height():0),pixelRatio:N}),D=I.getContext(),U=new O.SceneCanvas({width:I.width/I.pixelRatio+Math.abs(R),height:I.height/I.pixelRatio+Math.abs(k),pixelRatio:I.pixelRatio});return n.imageSmoothingEnabled===!1&&(D._context.imageSmoothingEnabled=!1),D.save(),(R||k)&&D.translate(-1*R,-1*k),this.drawScene(I,void 0,U),D.restore(),I}toCanvas(n){return this._toKonvaCanvas(n)._canvas}toDataURL(n){n=n||{};const b=n.mimeType||null,p=n.quality||null,R=this._toKonvaCanvas(n).toDataURL(b,p);return n.callback&&n.callback(R),R}toImage(n){return new Promise((b,p)=>{try{const R=n==null?void 0:n.callback;R&&delete n.callback,i.Util._urlToImage(this.toDataURL(n),function(k){b(k),R==null||R(k)})}catch(R){p(R)}})}toBlob(n){return new Promise((b,p)=>{try{const R=n==null?void 0:n.callback;R&&delete n.callback,this.toCanvas(n).toBlob(k=>{b(k),R==null||R(k)},n==null?void 0:n.mimeType,n==null?void 0:n.quality)}catch(R){p(R)}})}setSize(n){return this.width(n.width),this.height(n.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():E.Konva.dragDistance}_off(n,b,p){let R=this.eventListeners[n],k,N,I;for(k=0;k<R.length;k++)if(N=R[k].name,I=R[k].handler,(N!=="konva"||b==="konva")&&(!b||N===b)&&(!p||p===I)){if(R.splice(k,1),R.length===0){delete this.eventListeners[n];break}k--}}_fireChangeEvent(n,b,p){this._fire(n+y,{oldVal:b,newVal:p})}addName(n){if(!this.hasName(n)){const b=this.name(),p=b?b+" "+n:n;this.name(p)}return this}hasName(n){if(!n)return!1;const b=this.name();return b?(b||"").split(/\s/g).indexOf(n)!==-1:!1}removeName(n){const b=(this.name()||"").split(/\s/g),p=b.indexOf(n);return p!==-1&&(b.splice(p,1),this.name(b.join(" "))),this}setAttr(n,b){const p=this[v+i.Util._capitalize(n)];return i.Util._isFunction(p)?p.call(this,b):this._setAttr(n,b),this}_requestDraw(){if(E.Konva.autoDrawEnabled){const n=this.getLayer()||this.getStage();n==null||n.batchDraw()}}_setAttr(n,b){const p=this.attrs[n];p===b&&!i.Util.isObject(b)||(b==null?delete this.attrs[n]:this.attrs[n]=b,this._shouldFireChangeEvents&&this._fireChangeEvent(n,p,b),this._requestDraw())}_setComponentAttr(n,b,p){let R;p!==void 0&&(R=this.attrs[n],R||(this.attrs[n]=this.getAttr(n)),this.attrs[n][b]=p,this._fireChangeEvent(n,R,p))}_fireAndBubble(n,b,p){if(b&&this.nodeType===e&&(b.target=this),!((n===a||n===d)&&(p&&(this===p||this.isAncestorOf&&this.isAncestorOf(p))||this.nodeType==="Stage"&&!p))){this._fire(n,b);const k=(n===a||n===d)&&p&&p.isAncestorOf&&p.isAncestorOf(this)&&!p.isAncestorOf(this.parent);(b&&!b.cancelBubble||!b)&&this.parent&&this.parent.isListening()&&!k&&(p&&p.parent?this._fireAndBubble.call(this.parent,n,b,p):this._fireAndBubble.call(this.parent,n,b))}}_getProtoListeners(n){var b,p,R;const k=(b=this._cache.get(r))!==null&&b!==void 0?b:{};let N=k==null?void 0:k[n];if(N===void 0){N=[];let I=Object.getPrototypeOf(this);for(;I;){const D=(R=(p=I.eventListeners)===null||p===void 0?void 0:p[n])!==null&&R!==void 0?R:[];N.push(...D),I=Object.getPrototypeOf(I)}k[n]=N,this._cache.set(r,k)}return N}_fire(n,b){b=b||{},b.currentTarget=this,b.type=n;const p=this._getProtoListeners(n);if(p)for(var R=0;R<p.length;R++)p[R].handler.call(this,b);const k=this.eventListeners[n];if(k)for(var R=0;R<k.length;R++)k[R].handler.call(this,b)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(n){const b=n?n.pointerId:void 0,p=this.getStage(),R=this.getAbsolutePosition();if(!p)return;const k=p._getPointerById(b)||p._changedPointerPositions[0]||R;P.DD._dragElements.set(this._id,{node:this,startPointerPos:k,offset:{x:k.x-R.x,y:k.y-R.y},dragStatus:"ready",pointerId:b})}startDrag(n,b=!0){P.DD._dragElements.has(this._id)||this._createDragElement(n);const p=P.DD._dragElements.get(this._id);p.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:n&&n.evt},b)}_setDragPosition(n,b){const p=this.getStage()._getPointerById(b.pointerId);if(!p)return;let R={x:p.x-b.offset.x,y:p.y-b.offset.y};const k=this.dragBoundFunc();if(k!==void 0){const N=k.call(this,R,n);N?R=N:i.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==R.x||this._lastPos.y!==R.y)&&(this.setAbsolutePosition(R),this._requestDraw()),this._lastPos=R}stopDrag(n){const b=P.DD._dragElements.get(this._id);b&&(b.dragStatus="stopped"),P.DD._endDragBefore(n),P.DD._endDragAfter(n)}setDraggable(n){this._setAttr("draggable",n),this._dragChange()}isDragging(){const n=P.DD._dragElements.get(this._id);return n?n.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(n){if(!(!(n.evt.button!==void 0)||E.Konva.dragButtons.indexOf(n.evt.button)>=0)||this.isDragging())return;let R=!1;P.DD._dragElements.forEach(k=>{this.isAncestorOf(k.node)&&(R=!0)}),R||this._createDragElement(n)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const b=P.DD._dragElements.get(this._id),p=b&&b.dragStatus==="dragging",R=b&&b.dragStatus==="ready";p?this.stopDrag():R&&P.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(n={x:0,y:0}){const b=this.getStage();if(!b)return!1;const p={x:-n.x,y:-n.y,width:b.width()+2*n.x,height:b.height()+2*n.y};return i.Util.haveIntersection(p,this.getClientRect())}static create(n,b){return i.Util._isString(n)&&(n=JSON.parse(n)),this._createNode(n,b)}static _createNode(n,b){let p=ii.prototype.getClassName.call(n),R=n.children,k,N,I;b&&(n.attrs.container=b),E.Konva[p]||(i.Util.warn('Can not find a node with class name "'+p+'". Fallback to "Shape".'),p="Shape");const D=E.Konva[p];if(k=new D(n.attrs),R)for(N=R.length,I=0;I<N;I++)k.add(ii._createNode(R[I]));return k}};Kt.Node=C,C.prototype.nodeType="Node",C.prototype._attrsAffectingSize=[],C.prototype.eventListeners={},C.prototype.on.call(C.prototype,T,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(_),this._clearSelfAndDescendantCache(c)}),C.prototype.on.call(C.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(L)}),C.prototype.on.call(C.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(s)}),C.prototype.on.call(C.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(l)});const A=S.Factory.addGetterSetter;return A(C,"zIndex"),A(C,"absolutePosition"),A(C,"position"),A(C,"x",0,(0,g.getNumberValidator)()),A(C,"y",0,(0,g.getNumberValidator)()),A(C,"globalCompositeOperation","source-over",(0,g.getStringValidator)()),A(C,"opacity",1,(0,g.getNumberValidator)()),A(C,"name","",(0,g.getStringValidator)()),A(C,"id","",(0,g.getStringValidator)()),A(C,"rotation",0,(0,g.getNumberValidator)()),S.Factory.addComponentsGetterSetter(C,"scale",["x","y"]),A(C,"scaleX",1,(0,g.getNumberValidator)()),A(C,"scaleY",1,(0,g.getNumberValidator)()),S.Factory.addComponentsGetterSetter(C,"skew",["x","y"]),A(C,"skewX",0,(0,g.getNumberValidator)()),A(C,"skewY",0,(0,g.getNumberValidator)()),S.Factory.addComponentsGetterSetter(C,"offset",["x","y"]),A(C,"offsetX",0,(0,g.getNumberValidator)()),A(C,"offsetY",0,(0,g.getNumberValidator)()),A(C,"dragDistance",void 0,(0,g.getNumberValidator)()),A(C,"width",0,(0,g.getNumberValidator)()),A(C,"height",0,(0,g.getNumberValidator)()),A(C,"listening",!0,(0,g.getBooleanValidator)()),A(C,"preventDefault",!0,(0,g.getBooleanValidator)()),A(C,"filters",void 0,function(M){return this._filterUpToDate=!1,M}),A(C,"visible",!0,(0,g.getBooleanValidator)()),A(C,"transformsEnabled","all",(0,g.getStringValidator)()),A(C,"size"),A(C,"dragBoundFunc"),A(C,"draggable",!1,(0,g.getBooleanValidator)()),S.Factory.backCompat(C,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Kt}var jt={},Ti;function Ie(){if(Ti)return jt;Ti=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.Container=void 0;const i=Q(),S=ot(),O=J();let E=class extends S.Node{constructor(){super(...arguments),this.children=[]}getChildren(g){if(!g)return this.children||[];const l=this.children||[],r=[];return l.forEach(function(c){g(c)&&r.push(c)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(g=>{g.parent=null,g.index=0,g.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(g=>{g.parent=null,g.index=0,g.destroy()}),this.children=[],this._requestDraw(),this}add(...g){if(g.length===0)return this;if(g.length>1){for(let r=0;r<g.length;r++)this.add(g[r]);return this}const l=g[0];return l.getParent()?(l.moveTo(this),this):(this._validateAdd(l),l.index=this.getChildren().length,l.parent=this,l._clearCaches(),this.getChildren().push(l),this._fire("add",{child:l}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(g){return this._generalFind(g,!1)}findOne(g){const l=this._generalFind(g,!0);return l.length>0?l[0]:void 0}_generalFind(g,l){const r=[];return this._descendants(c=>{const h=c._isMatch(g);return h&&r.push(c),!!(h&&l)}),r}_descendants(g){let l=!1;const r=this.getChildren();for(const c of r){if(l=g(c),l)return!0;if(c.hasChildren()&&(l=c._descendants(g),l))return!0}return!1}toObject(){const g=S.Node.prototype.toObject.call(this);return g.children=[],this.getChildren().forEach(l=>{g.children.push(l.toObject())}),g}isAncestorOf(g){let l=g.getParent();for(;l;){if(l._id===this._id)return!0;l=l.getParent()}return!1}clone(g){const l=S.Node.prototype.clone.call(this,g);return this.getChildren().forEach(function(r){l.add(r.clone())}),l}getAllIntersections(g){const l=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(g)&&l.push(r)}),l}_clearSelfAndDescendantCache(g){var l;super._clearSelfAndDescendantCache(g),!this.isCached()&&((l=this.children)===null||l===void 0||l.forEach(function(r){r._clearSelfAndDescendantCache(g)}))}_setChildrenIndices(){var g;(g=this.children)===null||g===void 0||g.forEach(function(l,r){l.index=r}),this._requestDraw()}drawScene(g,l,r){const c=this.getLayer(),h=g||c&&c.getCanvas(),f=h&&h.getContext(),y=this._getCanvasCache(),m=y&&y.scene,o=h&&h.isCache;if(!this.isVisible()&&!o)return this;if(m){f.save();const s=this.getAbsoluteTransform(l).getMatrix();f.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._drawCachedSceneCanvas(f),f.restore()}else this._drawChildren("drawScene",h,l,r);return this}drawHit(g,l){if(!this.shouldDrawHit(l))return this;const r=this.getLayer(),c=g||r&&r.hitCanvas,h=c&&c.getContext(),f=this._getCanvasCache();if(f&&f.hit){h.save();const m=this.getAbsoluteTransform(l).getMatrix();h.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._drawCachedHitCanvas(h),h.restore()}else this._drawChildren("drawHit",c,l);return this}_drawChildren(g,l,r,c){var h;const f=l&&l.getContext(),y=this.clipWidth(),m=this.clipHeight(),o=this.clipFunc(),s=typeof y=="number"&&typeof m=="number"||o,a=r===this;if(s){f.save();const v=this.getAbsoluteTransform(r);let e=v.getMatrix();f.transform(e[0],e[1],e[2],e[3],e[4],e[5]),f.beginPath();let t;if(o)t=o.call(this,f,this);else{const u=this.clipX(),_=this.clipY();f.rect(u||0,_||0,y,m)}f.clip.apply(f,t),e=v.copy().invert().getMatrix(),f.transform(e[0],e[1],e[2],e[3],e[4],e[5])}const d=!a&&this.globalCompositeOperation()!=="source-over"&&g==="drawScene";d&&(f.save(),f._applyGlobalCompositeOperation(this)),(h=this.children)===null||h===void 0||h.forEach(function(v){v[g](l,r,c)}),d&&f.restore(),s&&f.restore()}getClientRect(g={}){var l;const r=g.skipTransform,c=g.relativeTo;let h,f,y,m,o={x:1/0,y:1/0,width:0,height:0};const s=this;(l=this.children)===null||l===void 0||l.forEach(function(v){if(!v.visible())return;const e=v.getClientRect({relativeTo:s,skipShadow:g.skipShadow,skipStroke:g.skipStroke});e.width===0&&e.height===0||(h===void 0?(h=e.x,f=e.y,y=e.x+e.width,m=e.y+e.height):(h=Math.min(h,e.x),f=Math.min(f,e.y),y=Math.max(y,e.x+e.width),m=Math.max(m,e.y+e.height)))});const a=this.find("Shape");let d=!1;for(let v=0;v<a.length;v++)if(a[v]._isVisible(this)){d=!0;break}return d&&h!==void 0?o={x:h,y:f,width:y-h,height:m-f}:o={x:0,y:0,width:0,height:0},r?o:this._transformedRect(o,c)}};return jt.Container=E,i.Factory.addComponentsGetterSetter(E,"clip",["x","y","width","height"]),i.Factory.addGetterSetter(E,"clipX",void 0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(E,"clipY",void 0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(E,"clipWidth",void 0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(E,"clipHeight",void 0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(E,"clipFunc"),jt}var Ke={},kt={},Pi;function In(){if(Pi)return kt;Pi=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.getCapturedShape=E,kt.createEvent=P,kt.hasPointerCapture=g,kt.setPointerCapture=l,kt.releaseCapture=r;const i=Z(),S=new Map,O=i.Konva._global.PointerEvent!==void 0;function E(c){return S.get(c)}function P(c){return{evt:c,pointerId:c.pointerId}}function g(c,h){return S.get(c)===h}function l(c,h){r(c),h.getStage()&&(S.set(c,h),O&&h._fire("gotpointercapture",P(new PointerEvent("gotpointercapture"))))}function r(c,h){const f=S.get(c);if(!f)return;const y=f.getStage();y&&y.content,S.delete(c),O&&f._fire("lostpointercapture",P(new PointerEvent("lostpointercapture")))}return kt}var Ei;function mr(){return Ei||(Ei=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Stage=i.stages=void 0;const S=st(),O=Q(),E=Ie(),P=Z(),g=De(),l=ci(),r=Z(),c=In(),h="Stage",f="string",y="px",m="mouseout",o="mouseleave",s="mouseover",a="mouseenter",d="mousemove",v="mousedown",e="mouseup",t="pointermove",u="pointerdown",_="pointerup",w="pointercancel",L="lostpointercapture",T="pointerout",x="pointerleave",C="pointerover",A="pointerenter",M="contextmenu",n="touchstart",b="touchend",p="touchmove",R="touchcancel",k="wheel",N=5,I=[[a,"_pointerenter"],[v,"_pointerdown"],[d,"_pointermove"],[e,"_pointerup"],[o,"_pointerleave"],[n,"_pointerdown"],[p,"_pointermove"],[b,"_pointerup"],[R,"_pointercancel"],[s,"_pointerover"],[k,"_wheel"],[M,"_contextmenu"],[u,"_pointerdown"],[t,"_pointermove"],[_,"_pointerup"],[w,"_pointercancel"],[L,"_lostpointercapture"]],D={mouse:{[T]:m,[x]:o,[C]:s,[A]:a,[t]:d,[u]:v,[_]:e,[w]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[T]:"touchout",[x]:"touchleave",[C]:"touchover",[A]:"touchenter",[t]:p,[u]:n,[_]:b,[w]:R,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[T]:T,[x]:x,[C]:C,[A]:A,[t]:t,[u]:u,[_]:_,[w]:w,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},U=K=>K.indexOf("pointer")>=0?"pointer":K.indexOf("touch")>=0?"touch":"mouse",z=K=>{const F=U(K);if(F==="pointer")return P.Konva.pointerEventsEnabled&&D.pointer;if(F==="touch")return D.touch;if(F==="mouse")return D.mouse};function B(K={}){return(K.clipFunc||K.clipWidth||K.clipHeight)&&S.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),K}const H="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";i.stages=[];class W extends E.Container{constructor(F){super(B(F)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),i.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{B(this.attrs)}),this._checkVisibility()}_validateAdd(F){const G=F.getType()==="Layer",V=F.getType()==="FastLayer";G||V||S.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const F=this.visible()?"":"none";this.content.style.display=F}setContainer(F){if(typeof F===f){if(F.charAt(0)==="."){const V=F.slice(1);F=document.getElementsByClassName(V)[0]}else{var G;F.charAt(0)!=="#"?G=F:G=F.slice(1),F=document.getElementById(G)}if(!F)throw"Can not find container in document with id "+G}return this._setAttr("container",F),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),F.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const F=this.children,G=F.length;for(let V=0;V<G;V++)F[V].clear();return this}clone(F){return F||(F={}),F.container=typeof document<"u"&&document.createElement("div"),E.Container.prototype.clone.call(this,F)}destroy(){super.destroy();const F=this.content;F&&S.Util._isInDocument(F)&&this.container().removeChild(F);const G=i.stages.indexOf(this);return G>-1&&i.stages.splice(G,1),S.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const F=this._pointerPositions[0]||this._changedPointerPositions[0];return F?{x:F.x,y:F.y}:(S.Util.warn(H),null)}_getPointerById(F){return this._pointerPositions.find(G=>G.id===F)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(F){F=F||{},F.x=F.x||0,F.y=F.y||0,F.width=F.width||this.width(),F.height=F.height||this.height();const G=new g.SceneCanvas({width:F.width,height:F.height,pixelRatio:F.pixelRatio||1}),V=G.getContext()._context,q=this.children;return(F.x||F.y)&&V.translate(-1*F.x,-1*F.y),q.forEach(function(j){if(!j.isVisible())return;const X=j._toKonvaCanvas(F);V.drawImage(X._canvas,F.x,F.y,X.getWidth()/X.getPixelRatio(),X.getHeight()/X.getPixelRatio())}),G}getIntersection(F){if(!F)return null;const G=this.children,V=G.length,q=V-1;for(let j=q;j>=0;j--){const X=G[j].getIntersection(F);if(X)return X}return null}_resizeDOM(){const F=this.width(),G=this.height();this.content&&(this.content.style.width=F+y,this.content.style.height=G+y),this.bufferCanvas.setSize(F,G),this.bufferHitCanvas.setSize(F,G),this.children.forEach(V=>{V.setSize({width:F,height:G}),V.draw()})}add(F,...G){if(arguments.length>1){for(let q=0;q<arguments.length;q++)this.add(arguments[q]);return this}super.add(F);const V=this.children.length;return V>N&&S.Util.warn("The stage has "+V+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),F.setSize({width:this.width(),height:this.height()}),F.draw(),P.Konva.isBrowser&&this.content.appendChild(F.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(F){return c.hasPointerCapture(F,this)}setPointerCapture(F){c.setPointerCapture(F,this)}releaseCapture(F){c.releaseCapture(F,this)}getLayers(){return this.children}_bindContentEvents(){P.Konva.isBrowser&&I.forEach(([F,G])=>{this.content.addEventListener(F,V=>{this[G](V)},{passive:!1})})}_pointerenter(F){this.setPointersPositions(F);const G=z(F.type);G&&this._fire(G.pointerenter,{evt:F,target:this,currentTarget:this})}_pointerover(F){this.setPointersPositions(F);const G=z(F.type);G&&this._fire(G.pointerover,{evt:F,target:this,currentTarget:this})}_getTargetShape(F){let G=this[F+"targetShape"];return G&&!G.getStage()&&(G=null),G}_pointerleave(F){const G=z(F.type),V=U(F.type);if(!G)return;this.setPointersPositions(F);const q=this._getTargetShape(V),j=!(P.Konva.isDragging()||P.Konva.isTransforming())||P.Konva.hitOnDragEnabled;q&&j?(q._fireAndBubble(G.pointerout,{evt:F}),q._fireAndBubble(G.pointerleave,{evt:F}),this._fire(G.pointerleave,{evt:F,target:this,currentTarget:this}),this[V+"targetShape"]=null):j&&(this._fire(G.pointerleave,{evt:F,target:this,currentTarget:this}),this._fire(G.pointerout,{evt:F,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(F){const G=z(F.type),V=U(F.type);if(!G)return;this.setPointersPositions(F);let q=!1;this._changedPointerPositions.forEach(j=>{const X=this.getIntersection(j);if(l.DD.justDragged=!1,P.Konva["_"+V+"ListenClick"]=!0,!X||!X.isListening()){this[V+"ClickStartShape"]=void 0;return}P.Konva.capturePointerEventsEnabled&&X.setPointerCapture(j.id),this[V+"ClickStartShape"]=X,X._fireAndBubble(G.pointerdown,{evt:F,pointerId:j.id}),q=!0;const tt=F.type.indexOf("touch")>=0;X.preventDefault()&&F.cancelable&&tt&&F.preventDefault()}),q||this._fire(G.pointerdown,{evt:F,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(F){const G=z(F.type),V=U(F.type);if(!G||(P.Konva.isDragging()&&l.DD.node.preventDefault()&&F.cancelable&&F.preventDefault(),this.setPointersPositions(F),!(!(P.Konva.isDragging()||P.Konva.isTransforming())||P.Konva.hitOnDragEnabled)))return;const j={};let X=!1;const tt=this._getTargetShape(V);this._changedPointerPositions.forEach(et=>{const Y=c.getCapturedShape(et.id)||this.getIntersection(et),lt=et.id,nt={evt:F,pointerId:lt},at=tt!==Y;if(at&&tt&&(tt._fireAndBubble(G.pointerout,{...nt},Y),tt._fireAndBubble(G.pointerleave,{...nt},Y)),Y){if(j[Y._id])return;j[Y._id]=!0}Y&&Y.isListening()?(X=!0,at&&(Y._fireAndBubble(G.pointerover,{...nt},tt),Y._fireAndBubble(G.pointerenter,{...nt},tt),this[V+"targetShape"]=Y),Y._fireAndBubble(G.pointermove,{...nt})):tt&&(this._fire(G.pointerover,{evt:F,target:this,currentTarget:this,pointerId:lt}),this[V+"targetShape"]=null)}),X||this._fire(G.pointermove,{evt:F,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(F){const G=z(F.type),V=U(F.type);if(!G)return;this.setPointersPositions(F);const q=this[V+"ClickStartShape"],j=this[V+"ClickEndShape"],X={};let tt=!1;this._changedPointerPositions.forEach(et=>{const Y=c.getCapturedShape(et.id)||this.getIntersection(et);if(Y){if(Y.releaseCapture(et.id),X[Y._id])return;X[Y._id]=!0}const lt=et.id,nt={evt:F,pointerId:lt};let at=!1;P.Konva["_"+V+"InDblClickWindow"]?(at=!0,clearTimeout(this[V+"DblTimeout"])):l.DD.justDragged||(P.Konva["_"+V+"InDblClickWindow"]=!0,clearTimeout(this[V+"DblTimeout"])),this[V+"DblTimeout"]=setTimeout(function(){P.Konva["_"+V+"InDblClickWindow"]=!1},P.Konva.dblClickWindow),Y&&Y.isListening()?(tt=!0,this[V+"ClickEndShape"]=Y,Y._fireAndBubble(G.pointerup,{...nt}),P.Konva["_"+V+"ListenClick"]&&q&&q===Y&&(Y._fireAndBubble(G.pointerclick,{...nt}),at&&j&&j===Y&&Y._fireAndBubble(G.pointerdblclick,{...nt}))):(this[V+"ClickEndShape"]=null,P.Konva["_"+V+"ListenClick"]&&this._fire(G.pointerclick,{evt:F,target:this,currentTarget:this,pointerId:lt}),at&&this._fire(G.pointerdblclick,{evt:F,target:this,currentTarget:this,pointerId:lt}))}),tt||this._fire(G.pointerup,{evt:F,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),P.Konva["_"+V+"ListenClick"]=!1,F.cancelable&&V!=="touch"&&V!=="pointer"&&F.preventDefault()}_contextmenu(F){this.setPointersPositions(F);const G=this.getIntersection(this.getPointerPosition());G&&G.isListening()?G._fireAndBubble(M,{evt:F}):this._fire(M,{evt:F,target:this,currentTarget:this})}_wheel(F){this.setPointersPositions(F);const G=this.getIntersection(this.getPointerPosition());G&&G.isListening()?G._fireAndBubble(k,{evt:F}):this._fire(k,{evt:F,target:this,currentTarget:this})}_pointercancel(F){this.setPointersPositions(F);const G=c.getCapturedShape(F.pointerId)||this.getIntersection(this.getPointerPosition());G&&G._fireAndBubble(_,c.createEvent(F)),c.releaseCapture(F.pointerId)}_lostpointercapture(F){c.releaseCapture(F.pointerId)}setPointersPositions(F){const G=this._getContentPosition();let V=null,q=null;F=F||window.event,F.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(F.touches,j=>{this._pointerPositions.push({id:j.identifier,x:(j.clientX-G.left)/G.scaleX,y:(j.clientY-G.top)/G.scaleY})}),Array.prototype.forEach.call(F.changedTouches||F.touches,j=>{this._changedPointerPositions.push({id:j.identifier,x:(j.clientX-G.left)/G.scaleX,y:(j.clientY-G.top)/G.scaleY})})):(V=(F.clientX-G.left)/G.scaleX,q=(F.clientY-G.top)/G.scaleY,this.pointerPos={x:V,y:q},this._pointerPositions=[{x:V,y:q,id:S.Util._getFirstPointerId(F)}],this._changedPointerPositions=[{x:V,y:q,id:S.Util._getFirstPointerId(F)}])}_setPointerPosition(F){S.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(F)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const F=this.content.getBoundingClientRect();return{top:F.top,left:F.left,scaleX:F.width/this.content.clientWidth||1,scaleY:F.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new g.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new g.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!P.Konva.isBrowser)return;const F=this.container();if(!F)throw"Stage has no container. A container is required.";F.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),F.appendChild(this.content),this._resizeDOM()}cache(){return S.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(F){F.batchDraw()}),this}}i.Stage=W,W.prototype.nodeType=h,(0,r._registerNode)(W),O.Factory.addGetterSetter(W,"container"),P.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{i.stages.forEach(K=>{K.batchDraw()})})}(Ke)),Ke}var Xt={},je={},Ai;function ht(){return Ai||(Ai=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Shape=i.shapes=void 0;const S=Z(),O=st(),E=Q(),P=ot(),g=J(),l=Z(),r=In(),c="hasShadow",h="shadowRGBA",f="patternImage",y="linearGradient",m="radialGradient";let o;function s(){return o||(o=O.Util.createCanvasElement().getContext("2d"),o)}i.shapes={};function a(x){const C=this.attrs.fillRule;C?x.fill(C):x.fill()}function d(x){x.stroke()}function v(x){const C=this.attrs.fillRule;C?x.fill(C):x.fill()}function e(x){x.stroke()}function t(){this._clearCache(c)}function u(){this._clearCache(h)}function _(){this._clearCache(f)}function w(){this._clearCache(y)}function L(){this._clearCache(m)}class T extends P.Node{constructor(C){super(C);let A;for(;A=O.Util.getRandomColor(),!(A&&!(A in i.shapes)););this.colorKey=A,i.shapes[A]=this}getContext(){return O.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return O.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(f,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const A=s().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(A&&A.setTransform){const M=new O.Transform;M.translate(this.fillPatternX(),this.fillPatternY()),M.rotate(S.Konva.getAngle(this.fillPatternRotation())),M.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),M.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const n=M.getMatrix(),b=typeof DOMMatrix>"u"?{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}:new DOMMatrix(n);A.setTransform(b)}return A}}_getLinearGradient(){return this._getCache(y,this.__getLinearGradient)}__getLinearGradient(){const C=this.fillLinearGradientColorStops();if(C){const A=s(),M=this.fillLinearGradientStartPoint(),n=this.fillLinearGradientEndPoint(),b=A.createLinearGradient(M.x,M.y,n.x,n.y);for(let p=0;p<C.length;p+=2)b.addColorStop(C[p],C[p+1]);return b}}_getRadialGradient(){return this._getCache(m,this.__getRadialGradient)}__getRadialGradient(){const C=this.fillRadialGradientColorStops();if(C){const A=s(),M=this.fillRadialGradientStartPoint(),n=this.fillRadialGradientEndPoint(),b=A.createRadialGradient(M.x,M.y,this.fillRadialGradientStartRadius(),n.x,n.y,this.fillRadialGradientEndRadius());for(let p=0;p<C.length;p+=2)b.addColorStop(C[p],C[p+1]);return b}}getShadowRGBA(){return this._getCache(h,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const C=O.Util.colorToRGBA(this.shadowColor());if(C)return"rgba("+C.r+","+C.g+","+C.b+","+C.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const C=this.hitStrokeWidth();return C==="auto"?this.hasStroke():this.strokeEnabled()&&!!C}intersects(C){const A=this.getStage();if(!A)return!1;const M=A.bufferHitCanvas;return M.getContext().clear(),this.drawHit(M,void 0,!0),M.context.getImageData(Math.round(C.x),Math.round(C.y),1,1).data[3]>0}destroy(){return P.Node.prototype.destroy.call(this),delete i.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(C){var A;if(!((A=this.attrs.perfectDrawEnabled)!==null&&A!==void 0?A:!0))return!1;const n=C||this.hasFill(),b=this.hasStroke(),p=this.getAbsoluteOpacity()!==1;if(n&&b&&p)return!0;const R=this.hasShadow(),k=this.shadowForStrokeEnabled();return!!(n&&b&&R&&k)}setStrokeHitEnabled(C){O.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),C?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const C=this.size();return{x:this._centroid?-C.width/2:0,y:this._centroid?-C.height/2:0,width:C.width,height:C.height}}getClientRect(C={}){let A=!1,M=this.getParent();for(;M;){if(M.isCached()){A=!0;break}M=M.getParent()}const n=C.skipTransform,b=C.relativeTo||A&&this.getStage()||void 0,p=this.getSelfRect(),k=!C.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,N=p.width+k,I=p.height+k,D=!C.skipShadow&&this.hasShadow(),U=D?this.shadowOffsetX():0,z=D?this.shadowOffsetY():0,B=N+Math.abs(U),H=I+Math.abs(z),W=D&&this.shadowBlur()||0,K=B+W*2,F=H+W*2,G={width:K,height:F,x:-(k/2+W)+Math.min(U,0)+p.x,y:-(k/2+W)+Math.min(z,0)+p.y};return n?G:this._transformedRect(G,b)}drawScene(C,A,M){const n=this.getLayer();let b=C||n.getCanvas(),p=b.getContext(),R=this._getCanvasCache(),k=this.getSceneFunc(),N=this.hasShadow(),I,D;const U=b.isCache,z=A===this;if(!this.isVisible()&&!z)return this;if(R){p.save();const H=this.getAbsoluteTransform(A).getMatrix();return p.transform(H[0],H[1],H[2],H[3],H[4],H[5]),this._drawCachedSceneCanvas(p),p.restore(),this}if(!k)return this;if(p.save(),this._useBufferCanvas()&&!U){I=this.getStage();const H=M||I.bufferCanvas;D=H.getContext(),D.clear(),D.save(),D._applyLineJoin(this);var B=this.getAbsoluteTransform(A).getMatrix();D.transform(B[0],B[1],B[2],B[3],B[4],B[5]),k.call(this,D,this),D.restore();const W=H.pixelRatio;N&&p._applyShadow(this),p._applyOpacity(this),p._applyGlobalCompositeOperation(this),p.drawImage(H._canvas,0,0,H.width/W,H.height/W)}else{if(p._applyLineJoin(this),!z){var B=this.getAbsoluteTransform(A).getMatrix();p.transform(B[0],B[1],B[2],B[3],B[4],B[5]),p._applyOpacity(this),p._applyGlobalCompositeOperation(this)}N&&p._applyShadow(this),k.call(this,p,this)}return p.restore(),this}drawHit(C,A,M=!1){if(!this.shouldDrawHit(A,M))return this;const n=this.getLayer(),b=C||n.hitCanvas,p=b&&b.getContext(),R=this.hitFunc()||this.sceneFunc(),k=this._getCanvasCache(),N=k&&k.hit;if(this.colorKey||O.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),N){p.save();const D=this.getAbsoluteTransform(A).getMatrix();return p.transform(D[0],D[1],D[2],D[3],D[4],D[5]),this._drawCachedHitCanvas(p),p.restore(),this}if(!R)return this;if(p.save(),p._applyLineJoin(this),!(this===A)){const D=this.getAbsoluteTransform(A).getMatrix();p.transform(D[0],D[1],D[2],D[3],D[4],D[5])}return R.call(this,p,this),p.restore(),this}drawHitFromCache(C=0){const A=this._getCanvasCache(),M=this._getCachedSceneCanvas(),n=A.hit,b=n.getContext(),p=n.getWidth(),R=n.getHeight();b.clear(),b.drawImage(M._canvas,0,0,p,R);try{const k=b.getImageData(0,0,p,R),N=k.data,I=N.length,D=O.Util._hexToRgb(this.colorKey);for(let U=0;U<I;U+=4)N[U+3]>C?(N[U]=D.r,N[U+1]=D.g,N[U+2]=D.b,N[U+3]=255):N[U+3]=0;b.putImageData(k,0,0)}catch(k){O.Util.error("Unable to draw hit graph from cached scene canvas. "+k.message)}return this}hasPointerCapture(C){return r.hasPointerCapture(C,this)}setPointerCapture(C){r.setPointerCapture(C,this)}releaseCapture(C){r.releaseCapture(C,this)}}i.Shape=T,T.prototype._fillFunc=a,T.prototype._strokeFunc=d,T.prototype._fillFuncHit=v,T.prototype._strokeFuncHit=e,T.prototype._centroid=!1,T.prototype.nodeType="Shape",(0,l._registerNode)(T),T.prototype.eventListeners={},T.prototype.on.call(T.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",t),T.prototype.on.call(T.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",u),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",_),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",w),T.prototype.on.call(T.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",L),E.Factory.addGetterSetter(T,"stroke",void 0,(0,g.getStringOrGradientValidator)()),E.Factory.addGetterSetter(T,"strokeWidth",2,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"fillAfterStrokeEnabled",!1),E.Factory.addGetterSetter(T,"hitStrokeWidth","auto",(0,g.getNumberOrAutoValidator)()),E.Factory.addGetterSetter(T,"strokeHitEnabled",!0,(0,g.getBooleanValidator)()),E.Factory.addGetterSetter(T,"perfectDrawEnabled",!0,(0,g.getBooleanValidator)()),E.Factory.addGetterSetter(T,"shadowForStrokeEnabled",!0,(0,g.getBooleanValidator)()),E.Factory.addGetterSetter(T,"lineJoin"),E.Factory.addGetterSetter(T,"lineCap"),E.Factory.addGetterSetter(T,"sceneFunc"),E.Factory.addGetterSetter(T,"hitFunc"),E.Factory.addGetterSetter(T,"dash"),E.Factory.addGetterSetter(T,"dashOffset",0,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"shadowColor",void 0,(0,g.getStringValidator)()),E.Factory.addGetterSetter(T,"shadowBlur",0,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"shadowOpacity",1,(0,g.getNumberValidator)()),E.Factory.addComponentsGetterSetter(T,"shadowOffset",["x","y"]),E.Factory.addGetterSetter(T,"shadowOffsetX",0,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"shadowOffsetY",0,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"fillPatternImage"),E.Factory.addGetterSetter(T,"fill",void 0,(0,g.getStringOrGradientValidator)()),E.Factory.addGetterSetter(T,"fillPatternX",0,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"fillPatternY",0,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"fillLinearGradientColorStops"),E.Factory.addGetterSetter(T,"strokeLinearGradientColorStops"),E.Factory.addGetterSetter(T,"fillRadialGradientStartRadius",0),E.Factory.addGetterSetter(T,"fillRadialGradientEndRadius",0),E.Factory.addGetterSetter(T,"fillRadialGradientColorStops"),E.Factory.addGetterSetter(T,"fillPatternRepeat","repeat"),E.Factory.addGetterSetter(T,"fillEnabled",!0),E.Factory.addGetterSetter(T,"strokeEnabled",!0),E.Factory.addGetterSetter(T,"shadowEnabled",!0),E.Factory.addGetterSetter(T,"dashEnabled",!0),E.Factory.addGetterSetter(T,"strokeScaleEnabled",!0),E.Factory.addGetterSetter(T,"fillPriority","color"),E.Factory.addComponentsGetterSetter(T,"fillPatternOffset",["x","y"]),E.Factory.addGetterSetter(T,"fillPatternOffsetX",0,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"fillPatternOffsetY",0,(0,g.getNumberValidator)()),E.Factory.addComponentsGetterSetter(T,"fillPatternScale",["x","y"]),E.Factory.addGetterSetter(T,"fillPatternScaleX",1,(0,g.getNumberValidator)()),E.Factory.addGetterSetter(T,"fillPatternScaleY",1,(0,g.getNumberValidator)()),E.Factory.addComponentsGetterSetter(T,"fillLinearGradientStartPoint",["x","y"]),E.Factory.addComponentsGetterSetter(T,"strokeLinearGradientStartPoint",["x","y"]),E.Factory.addGetterSetter(T,"fillLinearGradientStartPointX",0),E.Factory.addGetterSetter(T,"strokeLinearGradientStartPointX",0),E.Factory.addGetterSetter(T,"fillLinearGradientStartPointY",0),E.Factory.addGetterSetter(T,"strokeLinearGradientStartPointY",0),E.Factory.addComponentsGetterSetter(T,"fillLinearGradientEndPoint",["x","y"]),E.Factory.addComponentsGetterSetter(T,"strokeLinearGradientEndPoint",["x","y"]),E.Factory.addGetterSetter(T,"fillLinearGradientEndPointX",0),E.Factory.addGetterSetter(T,"strokeLinearGradientEndPointX",0),E.Factory.addGetterSetter(T,"fillLinearGradientEndPointY",0),E.Factory.addGetterSetter(T,"strokeLinearGradientEndPointY",0),E.Factory.addComponentsGetterSetter(T,"fillRadialGradientStartPoint",["x","y"]),E.Factory.addGetterSetter(T,"fillRadialGradientStartPointX",0),E.Factory.addGetterSetter(T,"fillRadialGradientStartPointY",0),E.Factory.addComponentsGetterSetter(T,"fillRadialGradientEndPoint",["x","y"]),E.Factory.addGetterSetter(T,"fillRadialGradientEndPointX",0),E.Factory.addGetterSetter(T,"fillRadialGradientEndPointY",0),E.Factory.addGetterSetter(T,"fillPatternRotation",0),E.Factory.addGetterSetter(T,"fillRule",void 0,(0,g.getStringValidator)()),E.Factory.backCompat(T,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(je)),je}var Ri;function Bn(){if(Ri)return Xt;Ri=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.Layer=void 0;const i=st(),S=Ie(),O=ot(),E=Q(),P=De(),g=J(),l=ht(),r=Z(),c="#",h="beforeDraw",f="draw",y=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],m=y.length;let o=class extends S.Container{constructor(a){super(a),this.canvas=new P.SceneCanvas,this.hitCanvas=new P.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this}setZIndex(a){super.setZIndex(a);const d=this.getStage();return d&&d.content&&(d.content.removeChild(this.getNativeCanvasElement()),a<d.children.length-1?d.content.insertBefore(this.getNativeCanvasElement(),d.children[a+1].getCanvas()._canvas):d.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){O.Node.prototype.moveToTop.call(this);const a=this.getStage();return a&&a.content&&(a.content.removeChild(this.getNativeCanvasElement()),a.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!O.Node.prototype.moveUp.call(this))return!1;const d=this.getStage();return!d||!d.content?!1:(d.content.removeChild(this.getNativeCanvasElement()),this.index<d.children.length-1?d.content.insertBefore(this.getNativeCanvasElement(),d.children[this.index+1].getCanvas()._canvas):d.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(O.Node.prototype.moveDown.call(this)){const a=this.getStage();if(a){const d=a.children;a.content&&(a.content.removeChild(this.getNativeCanvasElement()),a.content.insertBefore(this.getNativeCanvasElement(),d[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(O.Node.prototype.moveToBottom.call(this)){const a=this.getStage();if(a){const d=a.children;a.content&&(a.content.removeChild(this.getNativeCanvasElement()),a.content.insertBefore(this.getNativeCanvasElement(),d[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const a=this.getNativeCanvasElement();return O.Node.prototype.remove.call(this),a&&a.parentNode&&i.Util._isInDocument(a)&&a.parentNode.removeChild(a),this}getStage(){return this.parent}setSize({width:a,height:d}){return this.canvas.setSize(a,d),this.hitCanvas.setSize(a,d),this._setSmoothEnabled(),this}_validateAdd(a){const d=a.getType();d!=="Group"&&d!=="Shape"&&i.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(a){return a=a||{},a.width=a.width||this.getWidth(),a.height=a.height||this.getHeight(),a.x=a.x!==void 0?a.x:this.x(),a.y=a.y!==void 0?a.y:this.y(),O.Node.prototype._toKonvaCanvas.call(this,a)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){i.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){i.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,i.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(a){if(!this.isListening()||!this.isVisible())return null;let d=1,v=!1;for(;;){for(let e=0;e<m;e++){const t=y[e],u=this._getIntersection({x:a.x+t.x*d,y:a.y+t.y*d}),_=u.shape;if(_)return _;if(v=!!u.antialiased,!u.antialiased)break}if(v)d+=1;else return null}}_getIntersection(a){const d=this.hitCanvas.pixelRatio,v=this.hitCanvas.context.getImageData(Math.round(a.x*d),Math.round(a.y*d),1,1).data,e=v[3];if(e===255){const t=i.Util._rgbToHex(v[0],v[1],v[2]),u=l.shapes[c+t];return u?{shape:u}:{antialiased:!0}}else if(e>0)return{antialiased:!0};return{}}drawScene(a,d){const v=this.getLayer(),e=a||v&&v.getCanvas();return this._fire(h,{node:this}),this.clearBeforeDraw()&&e.getContext().clear(),S.Container.prototype.drawScene.call(this,e,d),this._fire(f,{node:this}),this}drawHit(a,d){const v=this.getLayer(),e=a||v&&v.hitCanvas;return v&&v.clearBeforeDraw()&&v.getHitCanvas().getContext().clear(),S.Container.prototype.drawHit.call(this,e,d),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(a){i.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(a)}getHitGraphEnabled(a){return i.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const a=this.parent;!!this.hitCanvas._canvas.parentNode?a.content.removeChild(this.hitCanvas._canvas):a.content.appendChild(this.hitCanvas._canvas)}destroy(){return i.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return Xt.Layer=o,o.prototype.nodeType="Layer",(0,r._registerNode)(o),E.Factory.addGetterSetter(o,"imageSmoothingEnabled",!0),E.Factory.addGetterSetter(o,"clearBeforeDraw",!0),E.Factory.addGetterSetter(o,"hitGraphEnabled",!0,(0,g.getBooleanValidator)()),Xt}var Yt={},Oi;function yr(){if(Oi)return Yt;Oi=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.FastLayer=void 0;const i=st(),S=Bn(),O=Z();let E=class extends S.Layer{constructor(g){super(g),this.listening(!1),i.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return Yt.FastLayer=E,E.prototype.nodeType="FastLayer",(0,O._registerNode)(E),Yt}var $t={},ki;function di(){if(ki)return $t;ki=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.Group=void 0;const i=st(),S=Ie(),O=Z();let E=class extends S.Container{_validateAdd(g){const l=g.getType();l!=="Group"&&l!=="Shape"&&i.Util.throw("You may only add groups and shapes to groups.")}};return $t.Group=E,E.prototype.nodeType="Group",(0,O._registerNode)(E),$t}var Zt={},Fi;function ui(){if(Fi)return Zt;Fi=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.Animation=void 0;const i=Z(),S=st(),O=function(){return i.glob.performance&&i.glob.performance.now?function(){return i.glob.performance.now()}:function(){return new Date().getTime()}}();let E=class qt{constructor(g,l){this.id=qt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:O(),frameRate:0},this.func=g,this.setLayers(l)}setLayers(g){let l=[];return g&&(l=Array.isArray(g)?g:[g]),this.layers=l,this}getLayers(){return this.layers}addLayer(g){const l=this.layers,r=l.length;for(let c=0;c<r;c++)if(l[c]._id===g._id)return!1;return this.layers.push(g),!0}isRunning(){const l=qt.animations,r=l.length;for(let c=0;c<r;c++)if(l[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=O(),qt._addAnimation(this),this}stop(){return qt._removeAnimation(this),this}_updateFrameObject(g){this.frame.timeDiff=g-this.frame.lastTime,this.frame.lastTime=g,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(g){this.animations.push(g),this._handleAnimation()}static _removeAnimation(g){const l=g.id,r=this.animations,c=r.length;for(let h=0;h<c;h++)if(r[h].id===l){this.animations.splice(h,1);break}}static _runFrames(){const g={},l=this.animations;for(let r=0;r<l.length;r++){const c=l[r],h=c.layers,f=c.func;c._updateFrameObject(O());const y=h.length;let m;if(f?m=f.call(c,c.frame)!==!1:m=!0,!!m)for(let o=0;o<y;o++){const s=h[o];s._id!==void 0&&(g[s._id]=s)}}for(const r in g)g.hasOwnProperty(r)&&g[r].batchDraw()}static _animationLoop(){const g=qt;g.animations.length?(g._runFrames(),S.Util.requestAnimFrame(g._animationLoop)):g.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,S.Util.requestAnimFrame(this._animationLoop))}};return Zt.Animation=E,E.animations=[],E.animIdCounter=0,E.animRunning=!1,Zt}var Xe={},Li;function br(){return Li||(Li=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Easings=i.Tween=void 0;const S=st(),O=ui(),E=ot(),P=Z(),g={node:1,duration:1,easing:1,onFinish:1,yoyo:1},l=1,r=2,c=3,h=["fill","stroke","shadowColor"];let f=0;class y{constructor(s,a,d,v,e,t,u){this.prop=s,this.propFunc=a,this.begin=v,this._pos=v,this.duration=t,this._change=0,this.prevPos=0,this.yoyo=u,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=d,this._change=e-this.begin,this.pause()}fire(s){const a=this[s];a&&a()}setTime(s){s>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():s<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=s,this.update())}getTime(){return this._time}setPosition(s){this.prevPos=this._pos,this.propFunc(s),this._pos=s}getPosition(s){return s===void 0&&(s=this._time),this.func(s,this.begin,this._change,this.duration)}play(){this.state=r,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(s){this.pause(),this._time=s,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const s=this.getTimer()-this._startTime;this.state===r?this.setTime(s):this.state===c&&this.setTime(this.duration-s)}pause(){this.state=l,this.fire("onPause")}getTimer(){return new Date().getTime()}}class m{constructor(s){const a=this,d=s.node,v=d._id,e=s.easing||i.Easings.Linear,t=!!s.yoyo;let u,_;typeof s.duration>"u"?u=.3:s.duration===0?u=.001:u=s.duration,this.node=d,this._id=f++;const w=d.getLayer()||(d instanceof P.Konva.Stage?d.getLayers():null);w||S.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new O.Animation(function(){a.tween.onEnterFrame()},w),this.tween=new y(_,function(L){a._tweenFunc(L)},e,0,1,u*1e3,t),this._addListeners(),m.attrs[v]||(m.attrs[v]={}),m.attrs[v][this._id]||(m.attrs[v][this._id]={}),m.tweens[v]||(m.tweens[v]={});for(_ in s)g[_]===void 0&&this._addAttr(_,s[_]);this.reset(),this.onFinish=s.onFinish,this.onReset=s.onReset,this.onUpdate=s.onUpdate}_addAttr(s,a){const d=this.node,v=d._id;let e,t,u,_,w;const L=m.tweens[v][s];L&&delete m.attrs[v][L][s];let T=d.getAttr(s);if(S.Util._isArray(a))if(e=[],t=Math.max(a.length,T.length),s==="points"&&a.length!==T.length&&(a.length>T.length?(_=T,T=S.Util._prepareArrayForTween(T,a,d.closed())):(u=a,a=S.Util._prepareArrayForTween(a,T,d.closed()))),s.indexOf("fill")===0)for(let x=0;x<t;x++)if(x%2===0)e.push(a[x]-T[x]);else{const C=S.Util.colorToRGBA(T[x]);w=S.Util.colorToRGBA(a[x]),T[x]=C,e.push({r:w.r-C.r,g:w.g-C.g,b:w.b-C.b,a:w.a-C.a})}else for(let x=0;x<t;x++)e.push(a[x]-T[x]);else h.indexOf(s)!==-1?(T=S.Util.colorToRGBA(T),w=S.Util.colorToRGBA(a),e={r:w.r-T.r,g:w.g-T.g,b:w.b-T.b,a:w.a-T.a}):e=a-T;m.attrs[v][this._id][s]={start:T,diff:e,end:a,trueEnd:u,trueStart:_},m.tweens[v][s]=this._id}_tweenFunc(s){const a=this.node,d=m.attrs[a._id][this._id];let v,e,t,u,_,w,L,T;for(v in d){if(e=d[v],t=e.start,u=e.diff,T=e.end,S.Util._isArray(t))if(_=[],L=Math.max(t.length,T.length),v.indexOf("fill")===0)for(w=0;w<L;w++)w%2===0?_.push((t[w]||0)+u[w]*s):_.push("rgba("+Math.round(t[w].r+u[w].r*s)+","+Math.round(t[w].g+u[w].g*s)+","+Math.round(t[w].b+u[w].b*s)+","+(t[w].a+u[w].a*s)+")");else for(w=0;w<L;w++)_.push((t[w]||0)+u[w]*s);else h.indexOf(v)!==-1?_="rgba("+Math.round(t.r+u.r*s)+","+Math.round(t.g+u.g*s)+","+Math.round(t.b+u.b*s)+","+(t.a+u.a*s)+")":_=t+u*s;a.setAttr(v,_)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const s=this.node,a=m.attrs[s._id][this._id];a.points&&a.points.trueEnd&&s.setAttr("points",a.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const s=this.node,a=m.attrs[s._id][this._id];a.points&&a.points.trueStart&&s.points(a.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(s){return this.tween.seek(s*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const s=this.node._id,a=this._id,d=m.tweens[s];this.pause();for(const v in d)delete m.tweens[s][v];delete m.attrs[s][a]}}i.Tween=m,m.attrs={},m.tweens={},E.Node.prototype.to=function(o){const s=o.onFinish;o.node=this,o.onFinish=function(){this.destroy(),s&&s()},new m(o).play()},i.Easings={BackEaseIn(o,s,a,d){return a*(o/=d)*o*((1.70158+1)*o-1.70158)+s},BackEaseOut(o,s,a,d){return a*((o=o/d-1)*o*((1.70158+1)*o+1.70158)+1)+s},BackEaseInOut(o,s,a,d){let v=1.70158;return(o/=d/2)<1?a/2*(o*o*(((v*=1.525)+1)*o-v))+s:a/2*((o-=2)*o*(((v*=1.525)+1)*o+v)+2)+s},ElasticEaseIn(o,s,a,d,v,e){let t=0;return o===0?s:(o/=d)===1?s+a:(e||(e=d*.3),!v||v<Math.abs(a)?(v=a,t=e/4):t=e/(2*Math.PI)*Math.asin(a/v),-(v*Math.pow(2,10*(o-=1))*Math.sin((o*d-t)*(2*Math.PI)/e))+s)},ElasticEaseOut(o,s,a,d,v,e){let t=0;return o===0?s:(o/=d)===1?s+a:(e||(e=d*.3),!v||v<Math.abs(a)?(v=a,t=e/4):t=e/(2*Math.PI)*Math.asin(a/v),v*Math.pow(2,-10*o)*Math.sin((o*d-t)*(2*Math.PI)/e)+a+s)},ElasticEaseInOut(o,s,a,d,v,e){let t=0;return o===0?s:(o/=d/2)===2?s+a:(e||(e=d*(.3*1.5)),!v||v<Math.abs(a)?(v=a,t=e/4):t=e/(2*Math.PI)*Math.asin(a/v),o<1?-.5*(v*Math.pow(2,10*(o-=1))*Math.sin((o*d-t)*(2*Math.PI)/e))+s:v*Math.pow(2,-10*(o-=1))*Math.sin((o*d-t)*(2*Math.PI)/e)*.5+a+s)},BounceEaseOut(o,s,a,d){return(o/=d)<1/2.75?a*(7.5625*o*o)+s:o<2/2.75?a*(7.5625*(o-=1.5/2.75)*o+.75)+s:o<2.5/2.75?a*(7.5625*(o-=2.25/2.75)*o+.9375)+s:a*(7.5625*(o-=2.625/2.75)*o+.984375)+s},BounceEaseIn(o,s,a,d){return a-i.Easings.BounceEaseOut(d-o,0,a,d)+s},BounceEaseInOut(o,s,a,d){return o<d/2?i.Easings.BounceEaseIn(o*2,0,a,d)*.5+s:i.Easings.BounceEaseOut(o*2-d,0,a,d)*.5+a*.5+s},EaseIn(o,s,a,d){return a*(o/=d)*o+s},EaseOut(o,s,a,d){return-a*(o/=d)*(o-2)+s},EaseInOut(o,s,a,d){return(o/=d/2)<1?a/2*o*o+s:-a/2*(--o*(o-2)-1)+s},StrongEaseIn(o,s,a,d){return a*(o/=d)*o*o*o*o+s},StrongEaseOut(o,s,a,d){return a*((o=o/d-1)*o*o*o*o+1)+s},StrongEaseInOut(o,s,a,d){return(o/=d/2)<1?a/2*o*o*o*o*o+s:a/2*((o-=2)*o*o*o*o+2)+s},Linear(o,s,a,d){return a*o/d+s}}}(Xe)),Xe}var Mi;function vr(){return Mi||(Mi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Konva=void 0;const S=Z(),O=st(),E=ot(),P=Ie(),g=mr(),l=Bn(),r=yr(),c=di(),h=ci(),f=ht(),y=ui(),m=br(),o=Dn(),s=De();i.Konva=O.Util._assign(S.Konva,{Util:O.Util,Transform:O.Transform,Node:E.Node,Container:P.Container,Stage:g.Stage,stages:g.stages,Layer:l.Layer,FastLayer:r.FastLayer,Group:c.Group,DD:h.DD,Shape:f.Shape,shapes:f.shapes,Animation:y.Animation,Tween:m.Tween,Easings:m.Easings,Context:o.Context,Canvas:s.Canvas}),i.default=i.Konva}(Ve)),Ve}var Qt={},Ni;function Sr(){if(Ni)return Qt;Ni=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.Arc=void 0;const i=Q(),S=ht(),O=Z(),E=J(),P=Z();let g=class extends S.Shape{_sceneFunc(r){const c=O.Konva.getAngle(this.angle()),h=this.clockwise();r.beginPath(),r.arc(0,0,this.outerRadius(),0,c,h),r.arc(0,0,this.innerRadius(),c,0,!h),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(r){this.outerRadius(r/2)}setHeight(r){this.outerRadius(r/2)}getSelfRect(){const r=this.innerRadius(),c=this.outerRadius(),h=this.clockwise(),f=O.Konva.getAngle(h?360-this.angle():this.angle()),y=Math.cos(Math.min(f,Math.PI)),m=1,o=Math.sin(Math.min(Math.max(Math.PI,f),3*Math.PI/2)),s=Math.sin(Math.min(f,Math.PI/2)),a=y*(y>0?r:c),d=m*c,v=o*(o>0?r:c),e=s*(s>0?c:r);return{x:a,y:h?-1*e:v,width:d-a,height:e-v}}};return Qt.Arc=g,g.prototype._centroid=!0,g.prototype.className="Arc",g.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,P._registerNode)(g),i.Factory.addGetterSetter(g,"innerRadius",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(g,"outerRadius",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(g,"angle",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(g,"clockwise",!1,(0,E.getBooleanValidator)()),Qt}var Jt={},te={},Gi;function Un(){if(Gi)return te;Gi=1,Object.defineProperty(te,"__esModule",{value:!0}),te.Line=void 0;const i=Q(),S=Z(),O=ht(),E=J();function P(r,c,h,f,y,m,o){const s=Math.sqrt(Math.pow(h-r,2)+Math.pow(f-c,2)),a=Math.sqrt(Math.pow(y-h,2)+Math.pow(m-f,2)),d=o*s/(s+a),v=o*a/(s+a),e=h-d*(y-r),t=f-d*(m-c),u=h+v*(y-r),_=f+v*(m-c);return[e,t,u,_]}function g(r,c){const h=r.length,f=[];for(let y=2;y<h-2;y+=2){const m=P(r[y-2],r[y-1],r[y],r[y+1],r[y+2],r[y+3],c);isNaN(m[0])||(f.push(m[0]),f.push(m[1]),f.push(r[y]),f.push(r[y+1]),f.push(m[2]),f.push(m[3]))}return f}let l=class extends O.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){let h=this.points(),f=h.length,y=this.tension(),m=this.closed(),o=this.bezier(),s,a,d;if(f){if(c.beginPath(),c.moveTo(h[0],h[1]),y!==0&&f>4){for(s=this.getTensionPoints(),a=s.length,d=m?0:4,m||c.quadraticCurveTo(s[0],s[1],s[2],s[3]);d<a-2;)c.bezierCurveTo(s[d++],s[d++],s[d++],s[d++],s[d++],s[d++]);m||c.quadraticCurveTo(s[a-2],s[a-1],h[f-2],h[f-1])}else if(o)for(d=2;d<f;)c.bezierCurveTo(h[d++],h[d++],h[d++],h[d++],h[d++],h[d++]);else for(d=2;d<f;d+=2)c.lineTo(h[d],h[d+1]);m?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():g(this.points(),this.tension())}_getTensionPointsClosed(){const c=this.points(),h=c.length,f=this.tension(),y=P(c[h-2],c[h-1],c[0],c[1],c[2],c[3],f),m=P(c[h-4],c[h-3],c[h-2],c[h-1],c[0],c[1],f),o=g(c,f);return[y[2],y[3]].concat(o).concat([m[0],m[1],c[h-2],c[h-1],m[2],m[3],y[0],y[1],c[0],c[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();let h=c[0],f=c[0],y=c[1],m=c[1],o,s;for(let a=0;a<c.length/2;a++)o=c[a*2],s=c[a*2+1],h=Math.min(h,o),f=Math.max(f,o),y=Math.min(y,s),m=Math.max(m,s);return{x:h,y,width:f-h,height:m-y}}};return te.Line=l,l.prototype.className="Line",l.prototype._attrsAffectingSize=["points","bezier","tension"],(0,S._registerNode)(l),i.Factory.addGetterSetter(l,"closed",!1),i.Factory.addGetterSetter(l,"bezier",!1),i.Factory.addGetterSetter(l,"tension",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(l,"points",[],(0,E.getNumberArrayValidator)()),te}var ee={},Ye={},Di;function Cr(){return Di||(Di=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.t2length=i.getQuadraticArcLength=i.getCubicArcLength=i.binomialCoefficients=i.cValues=i.tValues=void 0,i.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],i.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],i.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const S=(l,r,c)=>{let h,f;const m=c/2;h=0;for(let o=0;o<20;o++)f=m*i.tValues[20][o]+m,h+=i.cValues[20][o]*E(l,r,f);return m*h};i.getCubicArcLength=S;const O=(l,r,c)=>{c===void 0&&(c=1);const h=l[0]-2*l[1]+l[2],f=r[0]-2*r[1]+r[2],y=2*l[1]-2*l[0],m=2*r[1]-2*r[0],o=4*(h*h+f*f),s=4*(h*y+f*m),a=y*y+m*m;if(o===0)return c*Math.sqrt(Math.pow(l[2]-l[0],2)+Math.pow(r[2]-r[0],2));const d=s/(2*o),v=a/o,e=c+d,t=v-d*d,u=e*e+t>0?Math.sqrt(e*e+t):0,_=d*d+t>0?Math.sqrt(d*d+t):0,w=d+Math.sqrt(d*d+t)!==0?t*Math.log(Math.abs((e+u)/(d+_))):0;return Math.sqrt(o)/2*(e*u-d*_+w)};i.getQuadraticArcLength=O;function E(l,r,c){const h=P(1,c,l),f=P(1,c,r),y=h*h+f*f;return Math.sqrt(y)}const P=(l,r,c)=>{const h=c.length-1;let f,y;if(h===0)return 0;if(l===0){y=0;for(let m=0;m<=h;m++)y+=i.binomialCoefficients[h][m]*Math.pow(1-r,h-m)*Math.pow(r,m)*c[m];return y}else{f=new Array(h);for(let m=0;m<h;m++)f[m]=h*(c[m+1]-c[m]);return P(l-1,r,f)}},g=(l,r,c)=>{let h=1,f=l/r,y=(l-c(f))/r,m=0;for(;h>.001;){const o=c(f+y),s=Math.abs(l-o)/r;if(s<h)h=s,f+=y;else{const a=c(f-y),d=Math.abs(l-a)/r;d<h?(h=d,f-=y):y/=2}if(m++,m>500)break}return f};i.t2length=g}(Ye)),Ye}var Ii;function fi(){if(Ii)return ee;Ii=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.Path=void 0;const i=Q(),S=ht(),O=Z(),E=Cr();let P=class ut extends S.Shape{constructor(l){super(l),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=ut.parsePathData(this.data()),this.pathLength=ut.getPathLength(this.dataArray)}_sceneFunc(l){const r=this.dataArray;l.beginPath();let c=!1;for(let u=0;u<r.length;u++){const _=r[u].command,w=r[u].points;switch(_){case"L":l.lineTo(w[0],w[1]);break;case"M":l.moveTo(w[0],w[1]);break;case"C":l.bezierCurveTo(w[0],w[1],w[2],w[3],w[4],w[5]);break;case"Q":l.quadraticCurveTo(w[0],w[1],w[2],w[3]);break;case"A":var h=w[0],f=w[1],y=w[2],m=w[3],o=w[4],s=w[5],a=w[6],d=w[7],v=y>m?y:m,e=y>m?1:y/m,t=y>m?m/y:1;l.translate(h,f),l.rotate(a),l.scale(e,t),l.arc(0,0,v,o,o+s,1-d),l.scale(1/e,1/t),l.rotate(-a),l.translate(-h,-f);break;case"z":c=!0,l.closePath();break}}!c&&!this.hasFill()?l.strokeShape(this):l.fillStrokeShape(this)}getSelfRect(){let l=[];this.dataArray.forEach(function(o){if(o.command==="A"){const s=o.points[4],a=o.points[5],d=o.points[4]+a;let v=Math.PI/180;if(Math.abs(s-d)<v&&(v=Math.abs(s-d)),a<0)for(let e=s-v;e>d;e-=v){const t=ut.getPointOnEllipticalArc(o.points[0],o.points[1],o.points[2],o.points[3],e,0);l.push(t.x,t.y)}else for(let e=s+v;e<d;e+=v){const t=ut.getPointOnEllipticalArc(o.points[0],o.points[1],o.points[2],o.points[3],e,0);l.push(t.x,t.y)}}else if(o.command==="C")for(let s=0;s<=1;s+=.01){const a=ut.getPointOnCubicBezier(s,o.start.x,o.start.y,o.points[0],o.points[1],o.points[2],o.points[3],o.points[4],o.points[5]);l.push(a.x,a.y)}else l=l.concat(o.points)});let r=l[0],c=l[0],h=l[1],f=l[1],y,m;for(let o=0;o<l.length/2;o++)y=l[o*2],m=l[o*2+1],isNaN(y)||(r=Math.min(r,y),c=Math.max(c,y)),isNaN(m)||(h=Math.min(h,m),f=Math.max(f,m));return{x:r,y:h,width:c-r,height:f-h}}getLength(){return this.pathLength}getPointAtLength(l){return ut.getPointAtLengthOfDataArray(l,this.dataArray)}static getLineLength(l,r,c,h){return Math.sqrt((c-l)*(c-l)+(h-r)*(h-r))}static getPathLength(l){let r=0;for(let c=0;c<l.length;++c)r+=l[c].pathLength;return r}static getPointAtLengthOfDataArray(l,r){let c,h=0,f=r.length;if(!f)return null;for(;h<f&&l>r[h].pathLength;)l-=r[h].pathLength,++h;if(h===f)return c=r[h-1].points.slice(-2),{x:c[0],y:c[1]};if(l<.01)return c=r[h].points.slice(0,2),{x:c[0],y:c[1]};const y=r[h],m=y.points;switch(y.command){case"L":return ut.getPointOnLine(l,y.start.x,y.start.y,m[0],m[1]);case"C":return ut.getPointOnCubicBezier((0,E.t2length)(l,ut.getPathLength(r),u=>(0,E.getCubicArcLength)([y.start.x,m[0],m[2],m[4]],[y.start.y,m[1],m[3],m[5]],u)),y.start.x,y.start.y,m[0],m[1],m[2],m[3],m[4],m[5]);case"Q":return ut.getPointOnQuadraticBezier((0,E.t2length)(l,ut.getPathLength(r),u=>(0,E.getQuadraticArcLength)([y.start.x,m[0],m[2]],[y.start.y,m[1],m[3]],u)),y.start.x,y.start.y,m[0],m[1],m[2],m[3]);case"A":var o=m[0],s=m[1],a=m[2],d=m[3],v=m[4],e=m[5],t=m[6];return v+=e*l/y.pathLength,ut.getPointOnEllipticalArc(o,s,a,d,v,t)}return null}static getPointOnLine(l,r,c,h,f,y,m){y=y!=null?y:r,m=m!=null?m:c;const o=this.getLineLength(r,c,h,f);if(o<1e-10)return{x:r,y:c};if(h===r)return{x:y,y:m+(f>c?l:-l)};const s=(f-c)/(h-r),a=Math.sqrt(l*l/(1+s*s))*(h<r?-1:1),d=s*a;if(Math.abs(m-c-s*(y-r))<1e-10)return{x:y+a,y:m+d};const v=((y-r)*(h-r)+(m-c)*(f-c))/(o*o),e=r+v*(h-r),t=c+v*(f-c),u=this.getLineLength(y,m,e,t),_=Math.sqrt(l*l-u*u),w=Math.sqrt(_*_/(1+s*s))*(h<r?-1:1),L=s*w;return{x:e+w,y:t+L}}static getPointOnCubicBezier(l,r,c,h,f,y,m,o,s){function a(_){return _*_*_}function d(_){return 3*_*_*(1-_)}function v(_){return 3*_*(1-_)*(1-_)}function e(_){return(1-_)*(1-_)*(1-_)}const t=o*a(l)+y*d(l)+h*v(l)+r*e(l),u=s*a(l)+m*d(l)+f*v(l)+c*e(l);return{x:t,y:u}}static getPointOnQuadraticBezier(l,r,c,h,f,y,m){function o(e){return e*e}function s(e){return 2*e*(1-e)}function a(e){return(1-e)*(1-e)}const d=y*o(l)+h*s(l)+r*a(l),v=m*o(l)+f*s(l)+c*a(l);return{x:d,y:v}}static getPointOnEllipticalArc(l,r,c,h,f,y){const m=Math.cos(y),o=Math.sin(y),s={x:c*Math.cos(f),y:h*Math.sin(f)};return{x:l+(s.x*m-s.y*o),y:r+(s.x*o+s.y*m)}}static parsePathData(l){if(!l)return[];let r=l;const c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];r=r.replace(new RegExp(" ","g"),",");for(var h=0;h<c.length;h++)r=r.replace(new RegExp(c[h],"g"),"|"+c[h]);const f=r.split("|"),y=[],m=[];let o=0,s=0;const a=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let d;for(h=1;h<f.length;h++){let n=f[h],b=n.charAt(0);for(n=n.slice(1),m.length=0;d=a.exec(n);)m.push(d[0]);const p=[];for(let R=0,k=m.length;R<k;R++){if(m[R]==="00"){p.push(0,0);continue}const N=parseFloat(m[R]);isNaN(N)?p.push(0):p.push(N)}for(;p.length>0&&!isNaN(p[0]);){let R="",k=[];const N=o,I=s;var v,e,t,u,_,w,L,T,x,C;switch(b){case"l":o+=p.shift(),s+=p.shift(),R="L",k.push(o,s);break;case"L":o=p.shift(),s=p.shift(),k.push(o,s);break;case"m":var A=p.shift(),M=p.shift();if(o+=A,s+=M,R="M",y.length>2&&y[y.length-1].command==="z"){for(let D=y.length-2;D>=0;D--)if(y[D].command==="M"){o=y[D].points[0]+A,s=y[D].points[1]+M;break}}k.push(o,s),b="l";break;case"M":o=p.shift(),s=p.shift(),R="M",k.push(o,s),b="L";break;case"h":o+=p.shift(),R="L",k.push(o,s);break;case"H":o=p.shift(),R="L",k.push(o,s);break;case"v":s+=p.shift(),R="L",k.push(o,s);break;case"V":s=p.shift(),R="L",k.push(o,s);break;case"C":k.push(p.shift(),p.shift(),p.shift(),p.shift()),o=p.shift(),s=p.shift(),k.push(o,s);break;case"c":k.push(o+p.shift(),s+p.shift(),o+p.shift(),s+p.shift()),o+=p.shift(),s+=p.shift(),R="C",k.push(o,s);break;case"S":e=o,t=s,v=y[y.length-1],v.command==="C"&&(e=o+(o-v.points[2]),t=s+(s-v.points[3])),k.push(e,t,p.shift(),p.shift()),o=p.shift(),s=p.shift(),R="C",k.push(o,s);break;case"s":e=o,t=s,v=y[y.length-1],v.command==="C"&&(e=o+(o-v.points[2]),t=s+(s-v.points[3])),k.push(e,t,o+p.shift(),s+p.shift()),o+=p.shift(),s+=p.shift(),R="C",k.push(o,s);break;case"Q":k.push(p.shift(),p.shift()),o=p.shift(),s=p.shift(),k.push(o,s);break;case"q":k.push(o+p.shift(),s+p.shift()),o+=p.shift(),s+=p.shift(),R="Q",k.push(o,s);break;case"T":e=o,t=s,v=y[y.length-1],v.command==="Q"&&(e=o+(o-v.points[0]),t=s+(s-v.points[1])),o=p.shift(),s=p.shift(),R="Q",k.push(e,t,o,s);break;case"t":e=o,t=s,v=y[y.length-1],v.command==="Q"&&(e=o+(o-v.points[0]),t=s+(s-v.points[1])),o+=p.shift(),s+=p.shift(),R="Q",k.push(e,t,o,s);break;case"A":u=p.shift(),_=p.shift(),w=p.shift(),L=p.shift(),T=p.shift(),x=o,C=s,o=p.shift(),s=p.shift(),R="A",k=this.convertEndpointToCenterParameterization(x,C,o,s,L,T,u,_,w);break;case"a":u=p.shift(),_=p.shift(),w=p.shift(),L=p.shift(),T=p.shift(),x=o,C=s,o+=p.shift(),s+=p.shift(),R="A",k=this.convertEndpointToCenterParameterization(x,C,o,s,L,T,u,_,w);break}y.push({command:R||b,points:k,start:{x:N,y:I},pathLength:this.calcLength(N,I,R||b,k)})}(b==="z"||b==="Z")&&y.push({command:"z",points:[],start:void 0,pathLength:0})}return y}static calcLength(l,r,c,h){let f,y,m,o;const s=ut;switch(c){case"L":return s.getLineLength(l,r,h[0],h[1]);case"C":return(0,E.getCubicArcLength)([l,h[0],h[2],h[4]],[r,h[1],h[3],h[5]],1);case"Q":return(0,E.getQuadraticArcLength)([l,h[0],h[2]],[r,h[1],h[3]],1);case"A":f=0;var a=h[4],d=h[5],v=h[4]+d,e=Math.PI/180;if(Math.abs(a-v)<e&&(e=Math.abs(a-v)),y=s.getPointOnEllipticalArc(h[0],h[1],h[2],h[3],a,0),d<0)for(o=a-e;o>v;o-=e)m=s.getPointOnEllipticalArc(h[0],h[1],h[2],h[3],o,0),f+=s.getLineLength(y.x,y.y,m.x,m.y),y=m;else for(o=a+e;o<v;o+=e)m=s.getPointOnEllipticalArc(h[0],h[1],h[2],h[3],o,0),f+=s.getLineLength(y.x,y.y,m.x,m.y),y=m;return m=s.getPointOnEllipticalArc(h[0],h[1],h[2],h[3],v,0),f+=s.getLineLength(y.x,y.y,m.x,m.y),f}return 0}static convertEndpointToCenterParameterization(l,r,c,h,f,y,m,o,s){const a=s*(Math.PI/180),d=Math.cos(a)*(l-c)/2+Math.sin(a)*(r-h)/2,v=-1*Math.sin(a)*(l-c)/2+Math.cos(a)*(r-h)/2,e=d*d/(m*m)+v*v/(o*o);e>1&&(m*=Math.sqrt(e),o*=Math.sqrt(e));let t=Math.sqrt((m*m*(o*o)-m*m*(v*v)-o*o*(d*d))/(m*m*(v*v)+o*o*(d*d)));f===y&&(t*=-1),isNaN(t)&&(t=0);const u=t*m*v/o,_=t*-o*d/m,w=(l+c)/2+Math.cos(a)*u-Math.sin(a)*_,L=(r+h)/2+Math.sin(a)*u+Math.cos(a)*_,T=function(p){return Math.sqrt(p[0]*p[0]+p[1]*p[1])},x=function(p,R){return(p[0]*R[0]+p[1]*R[1])/(T(p)*T(R))},C=function(p,R){return(p[0]*R[1]<p[1]*R[0]?-1:1)*Math.acos(x(p,R))},A=C([1,0],[(d-u)/m,(v-_)/o]),M=[(d-u)/m,(v-_)/o],n=[(-1*d-u)/m,(-1*v-_)/o];let b=C(M,n);return x(M,n)<=-1&&(b=Math.PI),x(M,n)>=1&&(b=0),y===0&&b>0&&(b=b-2*Math.PI),y===1&&b<0&&(b=b+2*Math.PI),[w,L,m,o,A,b,a,y]}};return ee.Path=P,P.prototype.className="Path",P.prototype._attrsAffectingSize=["data"],(0,O._registerNode)(P),i.Factory.addGetterSetter(P,"data"),ee}var Bi;function wr(){if(Bi)return Jt;Bi=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.Arrow=void 0;const i=Q(),S=Un(),O=J(),E=Z(),P=fi();let g=class extends S.Line{_sceneFunc(r){super._sceneFunc(r);const c=Math.PI*2,h=this.points();let f=h;const y=this.tension()!==0&&h.length>4;y&&(f=this.getTensionPoints());const m=this.pointerLength(),o=h.length;let s,a;if(y){const e=[f[f.length-4],f[f.length-3],f[f.length-2],f[f.length-1],h[o-2],h[o-1]],t=P.Path.calcLength(f[f.length-4],f[f.length-3],"C",e),u=P.Path.getPointOnQuadraticBezier(Math.min(1,1-m/t),e[0],e[1],e[2],e[3],e[4],e[5]);s=h[o-2]-u.x,a=h[o-1]-u.y}else s=h[o-2]-h[o-4],a=h[o-1]-h[o-3];const d=(Math.atan2(a,s)+c)%c,v=this.pointerWidth();this.pointerAtEnding()&&(r.save(),r.beginPath(),r.translate(h[o-2],h[o-1]),r.rotate(d),r.moveTo(0,0),r.lineTo(-m,v/2),r.lineTo(-m,-v/2),r.closePath(),r.restore(),this.__fillStroke(r)),this.pointerAtBeginning()&&(r.save(),r.beginPath(),r.translate(h[0],h[1]),y?(s=(f[0]+f[2])/2-h[0],a=(f[1]+f[3])/2-h[1]):(s=h[2]-h[0],a=h[3]-h[1]),r.rotate((Math.atan2(-a,-s)+c)%c),r.moveTo(0,0),r.lineTo(-m,v/2),r.lineTo(-m,-v/2),r.closePath(),r.restore(),this.__fillStroke(r))}__fillStroke(r){const c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,r.setLineDash([])),r.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const r=super.getSelfRect(),c=this.pointerWidth()/2;return{x:r.x,y:r.y-c,width:r.width,height:r.height+c*2}}};return Jt.Arrow=g,g.prototype.className="Arrow",(0,E._registerNode)(g),i.Factory.addGetterSetter(g,"pointerLength",10,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(g,"pointerWidth",10,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(g,"pointerAtBeginning",!1),i.Factory.addGetterSetter(g,"pointerAtEnding",!0),Jt}var ie={},Ui;function xr(){if(Ui)return ie;Ui=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.Circle=void 0;const i=Q(),S=ht(),O=J(),E=Z();let P=class extends S.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius()!==l/2&&this.radius(l/2)}setHeight(l){this.radius()!==l/2&&this.radius(l/2)}};return ie.Circle=P,P.prototype._centroid=!0,P.prototype.className="Circle",P.prototype._attrsAffectingSize=["radius"],(0,E._registerNode)(P),i.Factory.addGetterSetter(P,"radius",0,(0,O.getNumberValidator)()),ie}var ne={},Vi;function Tr(){if(Vi)return ne;Vi=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.Ellipse=void 0;const i=Q(),S=ht(),O=J(),E=Z();let P=class extends S.Shape{_sceneFunc(l){const r=this.radiusX(),c=this.radiusY();l.beginPath(),l.save(),r!==c&&l.scale(1,c/r),l.arc(0,0,r,0,Math.PI*2,!1),l.restore(),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(l){this.radiusX(l/2)}setHeight(l){this.radiusY(l/2)}};return ne.Ellipse=P,P.prototype.className="Ellipse",P.prototype._centroid=!0,P.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,E._registerNode)(P),i.Factory.addComponentsGetterSetter(P,"radius",["x","y"]),i.Factory.addGetterSetter(P,"radiusX",0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(P,"radiusY",0,(0,O.getNumberValidator)()),ne}var re={},Hi;function Pr(){if(Hi)return re;Hi=1,Object.defineProperty(re,"__esModule",{value:!0}),re.Image=void 0;const i=st(),S=Q(),O=ht(),E=Z(),P=J();let g=class Vn extends O.Shape{constructor(r){super(r),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",c=>{this._removeImageLoad(c.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const r=this.image();r&&r.complete||r&&r.readyState===4||r&&r.addEventListener&&r.addEventListener("load",this._loadListener)}_removeImageLoad(r){r&&r.removeEventListener&&r.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const r=!!this.cornerRadius(),c=this.hasShadow();return r&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(r){const c=this.getWidth(),h=this.getHeight(),f=this.cornerRadius(),y=this.attrs.image;let m;if(y){const o=this.attrs.cropWidth,s=this.attrs.cropHeight;o&&s?m=[y,this.cropX(),this.cropY(),o,s,0,0,c,h]:m=[y,0,0,c,h]}(this.hasFill()||this.hasStroke()||f)&&(r.beginPath(),f?i.Util.drawRoundedRectPath(r,c,h,f):r.rect(0,0,c,h),r.closePath(),r.fillStrokeShape(this)),y&&(f&&r.clip(),r.drawImage.apply(r,m))}_hitFunc(r){const c=this.width(),h=this.height(),f=this.cornerRadius();r.beginPath(),f?i.Util.drawRoundedRectPath(r,c,h,f):r.rect(0,0,c,h),r.closePath(),r.fillStrokeShape(this)}getWidth(){var r,c;return(r=this.attrs.width)!==null&&r!==void 0?r:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var r,c;return(r=this.attrs.height)!==null&&r!==void 0?r:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(r,c,h=null){const f=i.Util.createImageElement();f.onload=function(){const y=new Vn({image:f});c(y)},f.onerror=h,f.crossOrigin="Anonymous",f.src=r}};return re.Image=g,g.prototype.className="Image",(0,E._registerNode)(g),S.Factory.addGetterSetter(g,"cornerRadius",0,(0,P.getNumberOrArrayOfNumbersValidator)(4)),S.Factory.addGetterSetter(g,"image"),S.Factory.addComponentsGetterSetter(g,"crop",["x","y","width","height"]),S.Factory.addGetterSetter(g,"cropX",0,(0,P.getNumberValidator)()),S.Factory.addGetterSetter(g,"cropY",0,(0,P.getNumberValidator)()),S.Factory.addGetterSetter(g,"cropWidth",0,(0,P.getNumberValidator)()),S.Factory.addGetterSetter(g,"cropHeight",0,(0,P.getNumberValidator)()),re}var Lt={},qi;function Er(){if(qi)return Lt;qi=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.Tag=Lt.Label=void 0;const i=Q(),S=ht(),O=di(),E=J(),P=Z(),g=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],l="Change.konva",r="none",c="up",h="right",f="down",y="left",m=g.length;let o=class extends O.Group{constructor(d){super(d),this.on("add.konva",function(v){this._addListeners(v.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(d){let v=this,e;const t=function(){v._sync()};for(e=0;e<m;e++)d.on(g[e]+l,t)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let d=this.getText(),v=this.getTag(),e,t,u,_,w,L,T;if(d&&v){switch(e=d.width(),t=d.height(),u=v.pointerDirection(),_=v.pointerWidth(),T=v.pointerHeight(),w=0,L=0,u){case c:w=e/2,L=-1*T;break;case h:w=e+_,L=t/2;break;case f:w=e/2,L=t+T;break;case y:w=-1*_,L=t/2;break}v.setAttrs({x:-1*w,y:-1*L,width:e,height:t}),d.setAttrs({x:-1*w,y:-1*L})}}};Lt.Label=o,o.prototype.className="Label",(0,P._registerNode)(o);class s extends S.Shape{_sceneFunc(d){const v=this.width(),e=this.height(),t=this.pointerDirection(),u=this.pointerWidth(),_=this.pointerHeight(),w=this.cornerRadius();let L=0,T=0,x=0,C=0;typeof w=="number"?L=T=x=C=Math.min(w,v/2,e/2):(L=Math.min(w[0]||0,v/2,e/2),T=Math.min(w[1]||0,v/2,e/2),C=Math.min(w[2]||0,v/2,e/2),x=Math.min(w[3]||0,v/2,e/2)),d.beginPath(),d.moveTo(L,0),t===c&&(d.lineTo((v-u)/2,0),d.lineTo(v/2,-1*_),d.lineTo((v+u)/2,0)),d.lineTo(v-T,0),d.arc(v-T,T,T,Math.PI*3/2,0,!1),t===h&&(d.lineTo(v,(e-_)/2),d.lineTo(v+u,e/2),d.lineTo(v,(e+_)/2)),d.lineTo(v,e-C),d.arc(v-C,e-C,C,0,Math.PI/2,!1),t===f&&(d.lineTo((v+u)/2,e),d.lineTo(v/2,e+_),d.lineTo((v-u)/2,e)),d.lineTo(x,e),d.arc(x,e-x,x,Math.PI/2,Math.PI,!1),t===y&&(d.lineTo(0,(e+_)/2),d.lineTo(-1*u,e/2),d.lineTo(0,(e-_)/2)),d.lineTo(0,L),d.arc(L,L,L,Math.PI,Math.PI*3/2,!1),d.closePath(),d.fillStrokeShape(this)}getSelfRect(){let d=0,v=0,e=this.pointerWidth(),t=this.pointerHeight(),u=this.pointerDirection(),_=this.width(),w=this.height();return u===c?(v-=t,w+=t):u===f?w+=t:u===y?(d-=e*1.5,_+=e):u===h&&(_+=e*1.5),{x:d,y:v,width:_,height:w}}}return Lt.Tag=s,s.prototype.className="Tag",(0,P._registerNode)(s),i.Factory.addGetterSetter(s,"pointerDirection",r),i.Factory.addGetterSetter(s,"pointerWidth",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(s,"pointerHeight",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(s,"cornerRadius",0,(0,E.getNumberOrArrayOfNumbersValidator)(4)),Lt}var se={},zi;function Hn(){if(zi)return se;zi=1,Object.defineProperty(se,"__esModule",{value:!0}),se.Rect=void 0;const i=Q(),S=ht(),O=Z(),E=st(),P=J();let g=class extends S.Shape{_sceneFunc(r){const c=this.cornerRadius(),h=this.width(),f=this.height();r.beginPath(),c?E.Util.drawRoundedRectPath(r,h,f,c):r.rect(0,0,h,f),r.closePath(),r.fillStrokeShape(this)}};return se.Rect=g,g.prototype.className="Rect",(0,O._registerNode)(g),i.Factory.addGetterSetter(g,"cornerRadius",0,(0,P.getNumberOrArrayOfNumbersValidator)(4)),se}var ae={},Wi;function Ar(){if(Wi)return ae;Wi=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.RegularPolygon=void 0;const i=Q(),S=ht(),O=J(),E=Z();let P=class extends S.Shape{_sceneFunc(l){const r=this._getPoints();l.beginPath(),l.moveTo(r[0].x,r[0].y);for(let c=1;c<r.length;c++)l.lineTo(r[c].x,r[c].y);l.closePath(),l.fillStrokeShape(this)}_getPoints(){const l=this.attrs.sides,r=this.attrs.radius||0,c=[];for(let h=0;h<l;h++)c.push({x:r*Math.sin(h*2*Math.PI/l),y:-1*r*Math.cos(h*2*Math.PI/l)});return c}getSelfRect(){const l=this._getPoints();let r=l[0].x,c=l[0].y,h=l[0].x,f=l[0].y;return l.forEach(y=>{r=Math.min(r,y.x),c=Math.max(c,y.x),h=Math.min(h,y.y),f=Math.max(f,y.y)}),{x:r,y:h,width:c-r,height:f-h}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}};return ae.RegularPolygon=P,P.prototype.className="RegularPolygon",P.prototype._centroid=!0,P.prototype._attrsAffectingSize=["radius"],(0,E._registerNode)(P),i.Factory.addGetterSetter(P,"radius",0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(P,"sides",0,(0,O.getNumberValidator)()),ae}var oe={},Ki;function Rr(){if(Ki)return oe;Ki=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.Ring=void 0;const i=Q(),S=ht(),O=J(),E=Z(),P=Math.PI*2;let g=class extends S.Shape{_sceneFunc(r){r.beginPath(),r.arc(0,0,this.innerRadius(),0,P,!1),r.moveTo(this.outerRadius(),0),r.arc(0,0,this.outerRadius(),P,0,!0),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(r){this.outerRadius(r/2)}setHeight(r){this.outerRadius(r/2)}};return oe.Ring=g,g.prototype.className="Ring",g.prototype._centroid=!0,g.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,E._registerNode)(g),i.Factory.addGetterSetter(g,"innerRadius",0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(g,"outerRadius",0,(0,O.getNumberValidator)()),oe}var he={},ji;function Or(){if(ji)return he;ji=1,Object.defineProperty(he,"__esModule",{value:!0}),he.Sprite=void 0;const i=Q(),S=ht(),O=ui(),E=J(),P=Z();let g=class extends S.Shape{constructor(r){super(r),this._updated=!0,this.anim=new O.Animation(()=>{const c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(r){const c=this.animation(),h=this.frameIndex(),f=h*4,y=this.animations()[c],m=this.frameOffsets(),o=y[f+0],s=y[f+1],a=y[f+2],d=y[f+3],v=this.image();if((this.hasFill()||this.hasStroke())&&(r.beginPath(),r.rect(0,0,a,d),r.closePath(),r.fillStrokeShape(this)),v)if(m){const e=m[c],t=h*2;r.drawImage(v,o,s,a,d,e[t+0],e[t+1],a,d)}else r.drawImage(v,o,s,a,d,0,0,a,d)}_hitFunc(r){const c=this.animation(),h=this.frameIndex(),f=h*4,y=this.animations()[c],m=this.frameOffsets(),o=y[f+2],s=y[f+3];if(r.beginPath(),m){const a=m[c],d=h*2;r.rect(a[d+0],a[d+1],o,s)}else r.rect(0,0,o,s);r.closePath(),r.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const r=this;this.interval=setInterval(function(){r._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const r=this.getLayer();this.anim.setLayers(r),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const r=this.frameIndex(),c=this.animation(),h=this.animations(),f=h[c],y=f.length/4;r<y-1?this.frameIndex(r+1):this.frameIndex(0)}};return he.Sprite=g,g.prototype.className="Sprite",(0,P._registerNode)(g),i.Factory.addGetterSetter(g,"animation"),i.Factory.addGetterSetter(g,"animations"),i.Factory.addGetterSetter(g,"frameOffsets"),i.Factory.addGetterSetter(g,"image"),i.Factory.addGetterSetter(g,"frameIndex",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(g,"frameRate",17,(0,E.getNumberValidator)()),i.Factory.backCompat(g,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),he}var le={},Xi;function kr(){if(Xi)return le;Xi=1,Object.defineProperty(le,"__esModule",{value:!0}),le.Star=void 0;const i=Q(),S=ht(),O=J(),E=Z();let P=class extends S.Shape{_sceneFunc(l){const r=this.innerRadius(),c=this.outerRadius(),h=this.numPoints();l.beginPath(),l.moveTo(0,0-c);for(let f=1;f<h*2;f++){const y=f%2===0?c:r,m=y*Math.sin(f*Math.PI/h),o=-1*y*Math.cos(f*Math.PI/h);l.lineTo(m,o)}l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}};return le.Star=P,P.prototype.className="Star",P.prototype._centroid=!0,P.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,E._registerNode)(P),i.Factory.addGetterSetter(P,"numPoints",5,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(P,"innerRadius",0,(0,O.getNumberValidator)()),i.Factory.addGetterSetter(P,"outerRadius",0,(0,O.getNumberValidator)()),le}var Ht={},Yi;function qn(){if(Yi)return Ht;Yi=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.Text=void 0,Ht.stringToArray=l;const i=st(),S=Q(),O=ht(),E=Z(),P=J(),g=Z();function l(z){return[...z].reduce((B,H,W,K)=>{if(new RegExp("\\p{Emoji}","u").test(H)){const F=K[W+1];F&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(F)?(B.push(H+F),K[W+1]=""):B.push(H)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(H+(K[W+1]||""))?B.push(H+K[W+1]):W>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(H)?B[B.length-1]+=H:H&&B.push(H);return B},[])}const r="auto",c="center",h="inherit",f="justify",y="Change.konva",m="2d",o="-",s="left",a="text",d="Text",v="top",e="bottom",t="middle",u="normal",_="px ",w=" ",L="right",T="rtl",x="word",C="char",A="none",M="…",n=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],b=n.length;function p(z){return z.split(",").map(B=>{B=B.trim();const H=B.indexOf(" ")>=0,W=B.indexOf('"')>=0||B.indexOf("'")>=0;return H&&!W&&(B='"'.concat(B,'"')),B}).join(", ")}let R;function k(){return R||(R=i.Util.createCanvasElement().getContext(m),R)}function N(z){z.fillText(this._partialText,this._partialTextX,this._partialTextY)}function I(z){z.setAttr("miterLimit",2),z.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function D(z){return z=z||{},!z.fillLinearGradientColorStops&&!z.fillRadialGradientColorStops&&!z.fillPatternImage&&(z.fill=z.fill||"black"),z}let U=class extends O.Shape{constructor(B){super(D(B)),this._partialTextX=0,this._partialTextY=0;for(let H=0;H<b;H++)this.on(n[H]+y,this._setTextData);this._setTextData()}_sceneFunc(B){const H=this.textArr,W=H.length;if(!this.text())return;let K=this.padding(),F=this.fontSize(),G=this.lineHeight()*F,V=this.verticalAlign(),q=this.direction(),j=0,X=this.align(),tt=this.getWidth(),et=this.letterSpacing(),Y=this.fill(),lt=this.textDecoration(),nt=lt.indexOf("underline")!==-1,at=lt.indexOf("line-through")!==-1,Vt;q=q===h?B.direction:q;let ft=G/2,zt=t;if(E.Konva._fixTextRendering){const Rt=this.measureSize("M");zt="alphabetic",ft=(Rt.fontBoundingBoxAscent-Rt.fontBoundingBoxDescent)/2+G/2}var rt=0,gt=0;for(q===T&&B.setAttr("direction",q),B.setAttr("font",this._getContextFont()),B.setAttr("textBaseline",zt),B.setAttr("textAlign",s),V===t?j=(this.getHeight()-W*G-K*2)/2:V===e&&(j=this.getHeight()-W*G-K*2),B.translate(K,j+K),Vt=0;Vt<W;Vt++){var rt=0,gt=0,vt=H[Vt],wt=vt.text,ct=vt.width,At=vt.lastInParagraph,xt,Ft;if(B.save(),X===L?rt+=tt-ct-K*2:X===c&&(rt+=(tt-ct-K*2)/2),nt){B.save(),B.beginPath();const _t=E.Konva._fixTextRendering?Math.round(F/4):Math.round(F/2),mt=rt,yt=ft+gt+_t;B.moveTo(mt,yt),xt=wt.split(" ").length-1,Ft=X===f&&!At?tt-K*2:ct,B.lineTo(mt+Math.round(Ft),yt),B.lineWidth=F/15;const Ue=this._getLinearGradient();B.strokeStyle=Ue||Y,B.stroke(),B.restore()}if(at){B.save(),B.beginPath();const _t=E.Konva._fixTextRendering?-Math.round(F/4):0;B.moveTo(rt,ft+gt+_t),xt=wt.split(" ").length-1,Ft=X===f&&!At?tt-K*2:ct,B.lineTo(rt+Math.round(Ft),ft+gt+_t),B.lineWidth=F/15;const mt=this._getLinearGradient();B.strokeStyle=mt||Y,B.stroke(),B.restore()}if(q!==T&&(et!==0||X===f)){xt=wt.split(" ").length-1;const _t=l(wt);for(let mt=0;mt<_t.length;mt++){const yt=_t[mt];yt===" "&&!At&&X===f&&(rt+=(tt-K*2-ct)/xt),this._partialTextX=rt,this._partialTextY=ft+gt,this._partialText=yt,B.fillStrokeShape(this),rt+=this.measureSize(yt).width+et}}else et!==0&&B.setAttr("letterSpacing","".concat(et,"px")),this._partialTextX=rt,this._partialTextY=ft+gt,this._partialText=wt,B.fillStrokeShape(this);B.restore(),W>1&&(ft+=G)}}_hitFunc(B){const H=this.getWidth(),W=this.getHeight();B.beginPath(),B.rect(0,0,H,W),B.closePath(),B.fillStrokeShape(this)}setText(B){const H=i.Util._isString(B)?B:B==null?"":B+"";return this._setAttr(a,H),this}getWidth(){return this.attrs.width===r||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===r||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return i.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(B){var H,W,K,F,G,V,q,j,X,tt,et;let Y=k(),lt=this.fontSize(),nt;Y.save(),Y.font=this._getContextFont(),nt=Y.measureText(B),Y.restore();const at=lt/100;return{actualBoundingBoxAscent:(H=nt.actualBoundingBoxAscent)!==null&&H!==void 0?H:71.58203125*at,actualBoundingBoxDescent:(W=nt.actualBoundingBoxDescent)!==null&&W!==void 0?W:0,actualBoundingBoxLeft:(K=nt.actualBoundingBoxLeft)!==null&&K!==void 0?K:-7.421875*at,actualBoundingBoxRight:(F=nt.actualBoundingBoxRight)!==null&&F!==void 0?F:75.732421875*at,alphabeticBaseline:(G=nt.alphabeticBaseline)!==null&&G!==void 0?G:0,emHeightAscent:(V=nt.emHeightAscent)!==null&&V!==void 0?V:100*at,emHeightDescent:(q=nt.emHeightDescent)!==null&&q!==void 0?q:-20*at,fontBoundingBoxAscent:(j=nt.fontBoundingBoxAscent)!==null&&j!==void 0?j:91*at,fontBoundingBoxDescent:(X=nt.fontBoundingBoxDescent)!==null&&X!==void 0?X:21*at,hangingBaseline:(tt=nt.hangingBaseline)!==null&&tt!==void 0?tt:72.80000305175781*at,ideographicBaseline:(et=nt.ideographicBaseline)!==null&&et!==void 0?et:-21*at,width:nt.width,height:lt}}_getContextFont(){return this.fontStyle()+w+this.fontVariant()+w+(this.fontSize()+_)+p(this.fontFamily())}_addTextLine(B){this.align()===f&&(B=B.trim());const W=this._getTextWidth(B);return this.textArr.push({text:B,width:W,lastInParagraph:!1})}_getTextWidth(B){const H=this.letterSpacing(),W=B.length;return k().measureText(B).width+H*W}_setTextData(){let B=this.text().split("\n"),H=+this.fontSize(),W=0,K=this.lineHeight()*H,F=this.attrs.width,G=this.attrs.height,V=F!==r&&F!==void 0,q=G!==r&&G!==void 0,j=this.padding(),X=F-j*2,tt=G-j*2,et=0,Y=this.wrap(),lt=Y!==A,nt=Y!==C&&lt,at=this.ellipsis();this.textArr=[],k().font=this._getContextFont();const Vt=at?this._getTextWidth(M):0;for(let ft=0,zt=B.length;ft<zt;++ft){let rt=B[ft],gt=this._getTextWidth(rt);if(V&&gt>X)for(;rt.length>0;){let vt=0,wt=l(rt).length,ct="",At=0;for(;vt<wt;){const xt=vt+wt>>>1,Ft=l(rt),Rt=Ft.slice(0,xt+1).join(""),Ot=this._getTextWidth(Rt);(at&&q&&et+K>tt?Ot+Vt:Ot)<=X?(vt=xt+1,ct=Rt,At=Ot):wt=xt}if(ct){if(nt){const Rt=l(rt),Ot=l(ct),_t=Rt[Ot.length],mt=_t===w||_t===o;let yt;if(mt&&At<=X)yt=Ot.length;else{const Ue=Ot.lastIndexOf(w),Zn=Ot.lastIndexOf(o);yt=Math.max(Ue,Zn)+1}yt>0&&(vt=yt,ct=Rt.slice(0,vt).join(""),At=this._getTextWidth(ct))}if(ct=ct.trimRight(),this._addTextLine(ct),W=Math.max(W,At),et+=K,this._shouldHandleEllipsis(et)){this._tryToAddEllipsisToLastLine();break}if(rt=l(rt).slice(vt).join("").trimLeft(),rt.length>0&&(gt=this._getTextWidth(rt),gt<=X)){this._addTextLine(rt),et+=K,W=Math.max(W,gt);break}}else break}else this._addTextLine(rt),et+=K,W=Math.max(W,gt),this._shouldHandleEllipsis(et)&&ft<zt-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),q&&et+K>tt)break}this.textHeight=H,this.textWidth=W}_shouldHandleEllipsis(B){const H=+this.fontSize(),W=this.lineHeight()*H,K=this.attrs.height,F=K!==r&&K!==void 0,G=this.padding(),V=K-G*2;return!(this.wrap()!==A)||F&&B+W>V}_tryToAddEllipsisToLastLine(){const B=this.attrs.width,H=B!==r&&B!==void 0,W=this.padding(),K=B-W*2,F=this.ellipsis(),G=this.textArr[this.textArr.length-1];!G||!F||(H&&(this._getTextWidth(G.text+M)<K||(G.text=G.text.slice(0,G.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(G.text+M))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const B=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,H=this.hasShadow();return B&&H?!0:super._useBufferCanvas()}};return Ht.Text=U,U.prototype._fillFunc=N,U.prototype._strokeFunc=I,U.prototype.className=d,U.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,g._registerNode)(U),S.Factory.overWriteSetter(U,"width",(0,P.getNumberOrAutoValidator)()),S.Factory.overWriteSetter(U,"height",(0,P.getNumberOrAutoValidator)()),S.Factory.addGetterSetter(U,"direction",h),S.Factory.addGetterSetter(U,"fontFamily","Arial"),S.Factory.addGetterSetter(U,"fontSize",12,(0,P.getNumberValidator)()),S.Factory.addGetterSetter(U,"fontStyle",u),S.Factory.addGetterSetter(U,"fontVariant",u),S.Factory.addGetterSetter(U,"padding",0,(0,P.getNumberValidator)()),S.Factory.addGetterSetter(U,"align",s),S.Factory.addGetterSetter(U,"verticalAlign",v),S.Factory.addGetterSetter(U,"lineHeight",1,(0,P.getNumberValidator)()),S.Factory.addGetterSetter(U,"wrap",x),S.Factory.addGetterSetter(U,"ellipsis",!1,(0,P.getBooleanValidator)()),S.Factory.addGetterSetter(U,"letterSpacing",0,(0,P.getNumberValidator)()),S.Factory.addGetterSetter(U,"text","",(0,P.getStringValidator)()),S.Factory.addGetterSetter(U,"textDecoration",""),Ht}var ce={},$i;function Fr(){if($i)return ce;$i=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.TextPath=void 0;const i=st(),S=Q(),O=ht(),E=fi(),P=qn(),g=J(),l=Z(),r="",c="normal";function h(m){m.fillText(this.partialText,0,0)}function f(m){m.strokeText(this.partialText,0,0)}let y=class extends O.Shape{constructor(o){super(o),this.dummyCanvas=i.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return E.Path.getPathLength(this.dataArray)}_getPointAtLength(o){if(!this.attrs.data)return null;const s=this.pathLength;return o-1>s?null:E.Path.getPointAtLengthOfDataArray(o,this.dataArray)}_readDataAttribute(){this.dataArray=E.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(o){o.setAttr("font",this._getContextFont()),o.setAttr("textBaseline",this.textBaseline()),o.setAttr("textAlign","left"),o.save();const s=this.textDecoration(),a=this.fill(),d=this.fontSize(),v=this.glyphInfo;s==="underline"&&o.beginPath();for(let e=0;e<v.length;e++){o.save();const t=v[e].p0;o.translate(t.x,t.y),o.rotate(v[e].rotation),this.partialText=v[e].text,o.fillStrokeShape(this),s==="underline"&&(e===0&&o.moveTo(0,d/2+1),o.lineTo(d,d/2+1)),o.restore()}s==="underline"&&(o.strokeStyle=a,o.lineWidth=d/20,o.stroke()),o.restore()}_hitFunc(o){o.beginPath();const s=this.glyphInfo;if(s.length>=1){const a=s[0].p0;o.moveTo(a.x,a.y)}for(let a=0;a<s.length;a++){const d=s[a].p1;o.lineTo(d.x,d.y)}o.setAttr("lineWidth",this.fontSize()),o.setAttr("strokeStyle",this.colorKey),o.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return i.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(o){return P.Text.prototype.setText.call(this,o)}_getContextFont(){return P.Text.prototype._getContextFont.call(this)}_getTextSize(o){const a=this.dummyCanvas.getContext("2d");a.save(),a.font=this._getContextFont();const d=a.measureText(o);return a.restore(),{width:d.width,height:parseInt("".concat(this.fontSize()),10)}}_setTextData(){const{width:o,height:s}=this._getTextSize(this.attrs.text);if(this.textWidth=o,this.textHeight=s,this.glyphInfo=[],!this.attrs.data)return null;const a=this.letterSpacing(),d=this.align(),v=this.kerningFunc(),e=Math.max(this.textWidth+((this.attrs.text||"").length-1)*a,0);let t=0;d==="center"&&(t=Math.max(0,this.pathLength/2-e/2)),d==="right"&&(t=Math.max(0,this.pathLength-e));const u=(0,P.stringToArray)(this.text());let _=t;for(let w=0;w<u.length;w++){const L=this._getPointAtLength(_);if(!L)return;let T=this._getTextSize(u[w]).width+a;if(u[w]===" "&&d==="justify"){const b=this.text().split(" ").length-1;T+=(this.pathLength-e)/b}const x=this._getPointAtLength(_+T);if(!x)return;const C=E.Path.getLineLength(L.x,L.y,x.x,x.y);let A=0;if(v)try{A=v(u[w-1],u[w])*this.fontSize()}catch(b){A=0}L.x+=A,x.x+=A,this.textWidth+=A;const M=E.Path.getPointOnLine(A+C/2,L.x,L.y,x.x,x.y),n=Math.atan2(x.y-L.y,x.x-L.x);this.glyphInfo.push({transposeX:M.x,transposeY:M.y,text:u[w],rotation:n,p0:L,p1:x}),_+=T}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const o=[];this.glyphInfo.forEach(function(_){o.push(_.p0.x),o.push(_.p0.y),o.push(_.p1.x),o.push(_.p1.y)});let s=o[0]||0,a=o[0]||0,d=o[1]||0,v=o[1]||0,e,t;for(let _=0;_<o.length/2;_++)e=o[_*2],t=o[_*2+1],s=Math.min(s,e),a=Math.max(a,e),d=Math.min(d,t),v=Math.max(v,t);const u=this.fontSize();return{x:s-u/2,y:d-u/2,width:a-s+u,height:v-d+u}}destroy(){return i.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return ce.TextPath=y,y.prototype._fillFunc=h,y.prototype._strokeFunc=f,y.prototype._fillFuncHit=h,y.prototype._strokeFuncHit=f,y.prototype.className="TextPath",y.prototype._attrsAffectingSize=["text","fontSize","data"],(0,l._registerNode)(y),S.Factory.addGetterSetter(y,"data"),S.Factory.addGetterSetter(y,"fontFamily","Arial"),S.Factory.addGetterSetter(y,"fontSize",12,(0,g.getNumberValidator)()),S.Factory.addGetterSetter(y,"fontStyle",c),S.Factory.addGetterSetter(y,"align","left"),S.Factory.addGetterSetter(y,"letterSpacing",0,(0,g.getNumberValidator)()),S.Factory.addGetterSetter(y,"textBaseline","middle"),S.Factory.addGetterSetter(y,"fontVariant",c),S.Factory.addGetterSetter(y,"text",r),S.Factory.addGetterSetter(y,"textDecoration",""),S.Factory.addGetterSetter(y,"kerningFunc",void 0),ce}var de={},Zi;function Lr(){if(Zi)return de;Zi=1,Object.defineProperty(de,"__esModule",{value:!0}),de.Transformer=void 0;const i=st(),S=Q(),O=ot(),E=ht(),P=Hn(),g=di(),l=Z(),r=J(),c=Z(),h="tr-konva",f=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(T=>T+".".concat(h)).join(" "),y="nodesRect",m=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],o={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},s="ontouchstart"in l.Konva._global;function a(T,x,C){if(T==="rotater")return C;x+=i.Util.degToRad(o[T]||0);const A=(i.Util.radToDeg(x)%360+360)%360;return i.Util._inRange(A,315+22.5,360)||i.Util._inRange(A,0,22.5)?"ns-resize":i.Util._inRange(A,45-22.5,45+22.5)?"nesw-resize":i.Util._inRange(A,90-22.5,90+22.5)?"ew-resize":i.Util._inRange(A,135-22.5,135+22.5)?"nwse-resize":i.Util._inRange(A,180-22.5,180+22.5)?"ns-resize":i.Util._inRange(A,225-22.5,225+22.5)?"nesw-resize":i.Util._inRange(A,270-22.5,270+22.5)?"ew-resize":i.Util._inRange(A,315-22.5,315+22.5)?"nwse-resize":(i.Util.error("Transformer has unknown angle for cursor detection: "+A),"pointer")}const d=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function v(T){return{x:T.x+T.width/2*Math.cos(T.rotation)+T.height/2*Math.sin(-T.rotation),y:T.y+T.height/2*Math.cos(T.rotation)+T.width/2*Math.sin(T.rotation)}}function e(T,x,C){const A=C.x+(T.x-C.x)*Math.cos(x)-(T.y-C.y)*Math.sin(x),M=C.y+(T.x-C.x)*Math.sin(x)+(T.y-C.y)*Math.cos(x);return{...T,rotation:T.rotation+x,x:A,y:M}}function t(T,x){const C=v(T);return e(T,x,C)}function u(T,x,C){let A=x;for(let M=0;M<T.length;M++){const n=l.Konva.getAngle(T[M]),b=Math.abs(n-x)%(Math.PI*2);Math.min(b,Math.PI*2-b)<C&&(A=n)}return A}let _=0,w=class extends g.Group{constructor(x){super(x),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(f,this.update),this.getNode()&&this.update()}attachTo(x){return this.setNode(x),this}setNode(x){return i.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([x])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return h+this._id}setNodes(x=[]){this._nodes&&this._nodes.length&&this.detach();const C=x.filter(M=>M.isAncestorOf(this)?(i.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=x=C,x.length===1&&this.useSingleNodeRotation()?this.rotation(x[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(M=>{const n=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(M._attrsAffectingSize.length){const b=M._attrsAffectingSize.map(p=>p+"Change."+this._getEventNamespace()).join(" ");M.on(b,n)}M.on(m.map(b=>b+".".concat(this._getEventNamespace())).join(" "),n),M.on("absoluteTransformChange.".concat(this._getEventNamespace()),n),this._proxyDrag(M)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(x){let C;x.on("dragstart.".concat(this._getEventNamespace()),A=>{C=x.getAbsolutePosition(),!this.isDragging()&&x!==this.findOne(".back")&&this.startDrag(A,!1)}),x.on("dragmove.".concat(this._getEventNamespace()),A=>{if(!C)return;const M=x.getAbsolutePosition(),n=M.x-C.x,b=M.y-C.y;this.nodes().forEach(p=>{if(p===x||p.isDragging())return;const R=p.getAbsolutePosition();p.setAbsolutePosition({x:R.x+n,y:R.y+b}),p.startDrag(A)}),C=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(x=>{x.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(y),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(y,this.__getNodeRect)}__getNodeShape(x,C=this.rotation(),A){const M=x.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),n=x.getAbsoluteScale(A),b=x.getAbsolutePosition(A),p=M.x*n.x-x.offsetX()*n.x,R=M.y*n.y-x.offsetY()*n.y,k=(l.Konva.getAngle(x.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),N={x:b.x+p*Math.cos(k)+R*Math.sin(-k),y:b.y+R*Math.cos(k)+p*Math.sin(k),width:M.width*n.x,height:M.height*n.y,rotation:k};return e(N,-l.Konva.getAngle(C),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const C=[];this.nodes().map(k=>{const N=k.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),I=[{x:N.x,y:N.y},{x:N.x+N.width,y:N.y},{x:N.x+N.width,y:N.y+N.height},{x:N.x,y:N.y+N.height}],D=k.getAbsoluteTransform();I.forEach(function(U){const z=D.point(U);C.push(z)})});const A=new i.Transform;A.rotate(-l.Konva.getAngle(this.rotation()));let M=1/0,n=1/0,b=-1/0,p=-1/0;C.forEach(function(k){const N=A.point(k);M===void 0&&(M=b=N.x,n=p=N.y),M=Math.min(M,N.x),n=Math.min(n,N.y),b=Math.max(b,N.x),p=Math.max(p,N.y)}),A.invert();const R=A.point({x:M,y:n});return{x:R.x,y:R.y,width:b-M,height:p-n,rotation:l.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),d.forEach(x=>{this._createAnchor(x)}),this._createAnchor("rotater")}_createAnchor(x){const C=new P.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:x+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:s?10:"auto"}),A=this;C.on("mousedown touchstart",function(M){A._handleMouseDown(M)}),C.on("dragstart",M=>{C.stopDrag(),M.cancelBubble=!0}),C.on("dragend",M=>{M.cancelBubble=!0}),C.on("mouseenter",()=>{const M=l.Konva.getAngle(this.rotation()),n=this.rotateAnchorCursor(),b=a(x,M,n);C.getStage().content&&(C.getStage().content.style.cursor=b),this._cursorChange=!0}),C.on("mouseout",()=>{C.getStage().content&&(C.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(C)}_createBack(){const x=new E.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(C,A){const M=A.getParent(),n=M.padding();C.beginPath(),C.rect(-n,-n,A.width()+n*2,A.height()+n*2),C.moveTo(A.width()/2,-n),M.rotateEnabled()&&M.rotateLineVisible()&&C.lineTo(A.width()/2,-M.rotateAnchorOffset()*i.Util._sign(A.height())-n),C.fillStrokeShape(A)},hitFunc:(C,A)=>{if(!this.shouldOverdrawWholeArea())return;const M=this.padding();C.beginPath(),C.rect(-M,-M,A.width()+M*2,A.height()+M*2),C.fillStrokeShape(A)}});this.add(x),this._proxyDrag(x),x.on("dragstart",C=>{C.cancelBubble=!0}),x.on("dragmove",C=>{C.cancelBubble=!0}),x.on("dragend",C=>{C.cancelBubble=!0}),this.on("dragmove",C=>{this.update()})}_handleMouseDown(x){if(this._transforming)return;this._movingAnchorName=x.target.name().split(" ")[0];const C=this._getNodeRect(),A=C.width,M=C.height,n=Math.sqrt(Math.pow(A,2)+Math.pow(M,2));this.sin=Math.abs(M/n),this.cos=Math.abs(A/n),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const b=x.target.getAbsolutePosition(),p=x.target.getStage().getPointerPosition();this._anchorDragOffset={x:p.x-b.x,y:p.y-b.y},_++,this._fire("transformstart",{evt:x.evt,target:this.getNode()}),this._nodes.forEach(R=>{R._fire("transformstart",{evt:x.evt,target:R})})}_handleMouseMove(x){let C,A,M;const n=this.findOne("."+this._movingAnchorName),b=n.getStage();b.setPointersPositions(x);const p=b.getPointerPosition();let R={x:p.x-this._anchorDragOffset.x,y:p.y-this._anchorDragOffset.y};const k=n.getAbsolutePosition();this.anchorDragBoundFunc()&&(R=this.anchorDragBoundFunc()(k,R,x)),n.setAbsolutePosition(R);const N=n.getAbsolutePosition();if(k.x===N.x&&k.y===N.y)return;if(this._movingAnchorName==="rotater"){const V=this._getNodeRect();C=n.x()-V.width/2,A=-n.y()+V.height/2;let q=Math.atan2(-A,C)+Math.PI/2;V.height<0&&(q-=Math.PI);const X=l.Konva.getAngle(this.rotation())+q,tt=l.Konva.getAngle(this.rotationSnapTolerance()),Y=u(this.rotationSnaps(),X,tt)-V.rotation,lt=t(V,Y);this._fitNodesInto(lt,x);return}const I=this.shiftBehavior();let D;I==="inverted"?D=this.keepRatio()&&!x.shiftKey:I==="none"?D=this.keepRatio():D=this.keepRatio()||x.shiftKey;var W=this.centeredScaling()||x.altKey;if(this._movingAnchorName==="top-left"){if(D){var U=W?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};M=Math.sqrt(Math.pow(U.x-n.x(),2)+Math.pow(U.y-n.y(),2));var z=this.findOne(".top-left").x()>U.x?-1:1,B=this.findOne(".top-left").y()>U.y?-1:1;C=M*this.cos*z,A=M*this.sin*B,this.findOne(".top-left").x(U.x-C),this.findOne(".top-left").y(U.y-A)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(n.y());else if(this._movingAnchorName==="top-right"){if(D){var U=W?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};M=Math.sqrt(Math.pow(n.x()-U.x,2)+Math.pow(U.y-n.y(),2));var z=this.findOne(".top-right").x()<U.x?-1:1,B=this.findOne(".top-right").y()>U.y?-1:1;C=M*this.cos*z,A=M*this.sin*B,this.findOne(".top-right").x(U.x+C),this.findOne(".top-right").y(U.y-A)}var H=n.position();this.findOne(".top-left").y(H.y),this.findOne(".bottom-right").x(H.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(n.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(n.x());else if(this._movingAnchorName==="bottom-left"){if(D){var U=W?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};M=Math.sqrt(Math.pow(U.x-n.x(),2)+Math.pow(n.y()-U.y,2));var z=U.x<n.x()?-1:1,B=n.y()<U.y?-1:1;C=M*this.cos*z,A=M*this.sin*B,n.x(U.x-C),n.y(U.y+A)}H=n.position(),this.findOne(".top-left").x(H.x),this.findOne(".bottom-right").y(H.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(n.y());else if(this._movingAnchorName==="bottom-right"){if(D){var U=W?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};M=Math.sqrt(Math.pow(n.x()-U.x,2)+Math.pow(n.y()-U.y,2));var z=this.findOne(".bottom-right").x()<U.x?-1:1,B=this.findOne(".bottom-right").y()<U.y?-1:1;C=M*this.cos*z,A=M*this.sin*B,this.findOne(".bottom-right").x(U.x+C),this.findOne(".bottom-right").y(U.y+A)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var W=this.centeredScaling()||x.altKey;if(W){const V=this.findOne(".top-left"),q=this.findOne(".bottom-right"),j=V.x(),X=V.y(),tt=this.getWidth()-q.x(),et=this.getHeight()-q.y();q.move({x:-j,y:-X}),V.move({x:tt,y:et})}const K=this.findOne(".top-left").getAbsolutePosition();C=K.x,A=K.y;const F=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),G=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:C,y:A,width:F,height:G,rotation:l.Konva.getAngle(this.rotation())},x)}_handleMouseUp(x){this._removeEvents(x)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(x){var C;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const A=this.getNode();_--,this._fire("transformend",{evt:x,target:A}),(C=this.getLayer())===null||C===void 0||C.batchDraw(),A&&this._nodes.forEach(M=>{var n;M._fire("transformend",{evt:x,target:M}),(n=M.getLayer())===null||n===void 0||n.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(x,C){const A=this._getNodeRect(),M=1;if(i.Util._inRange(x.width,-this.padding()*2-M,M)){this.update();return}if(i.Util._inRange(x.height,-this.padding()*2-M,M)){this.update();return}const n=new i.Transform;if(n.rotate(l.Konva.getAngle(this.rotation())),this._movingAnchorName&&x.width<0&&this._movingAnchorName.indexOf("left")>=0){const D=n.point({x:-this.padding()*2,y:0});x.x+=D.x,x.y+=D.y,x.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=D.x,this._anchorDragOffset.y-=D.y}else if(this._movingAnchorName&&x.width<0&&this._movingAnchorName.indexOf("right")>=0){const D=n.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=D.x,this._anchorDragOffset.y-=D.y,x.width+=this.padding()*2}if(this._movingAnchorName&&x.height<0&&this._movingAnchorName.indexOf("top")>=0){const D=n.point({x:0,y:-this.padding()*2});x.x+=D.x,x.y+=D.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=D.x,this._anchorDragOffset.y-=D.y,x.height+=this.padding()*2}else if(this._movingAnchorName&&x.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const D=n.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=D.x,this._anchorDragOffset.y-=D.y,x.height+=this.padding()*2}if(this.boundBoxFunc()){const D=this.boundBoxFunc()(A,x);D?x=D:i.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const b=1e7,p=new i.Transform;p.translate(A.x,A.y),p.rotate(A.rotation),p.scale(A.width/b,A.height/b);const R=new i.Transform,k=x.width/b,N=x.height/b;this.flipEnabled()===!1?(R.translate(x.x,x.y),R.rotate(x.rotation),R.translate(x.width<0?x.width:0,x.height<0?x.height:0),R.scale(Math.abs(k),Math.abs(N))):(R.translate(x.x,x.y),R.rotate(x.rotation),R.scale(k,N));const I=R.multiply(p.invert());this._nodes.forEach(D=>{var U;const z=D.getParent().getAbsoluteTransform(),B=D.getTransform().copy();B.translate(D.offsetX(),D.offsetY());const H=new i.Transform;H.multiply(z.copy().invert()).multiply(I).multiply(z).multiply(B);const W=H.decompose();D.setAttrs(W),(U=D.getLayer())===null||U===void 0||U.batchDraw()}),this.rotation(i.Util._getRotation(x.rotation)),this._nodes.forEach(D=>{this._fire("transform",{evt:C,target:D}),D._fire("transform",{evt:C,target:D})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(x,C){this.findOne(x).setAttrs(C)}update(){var x;const C=this._getNodeRect();this.rotation(i.Util._getRotation(C.rotation));const A=C.width,M=C.height,n=this.enabledAnchors(),b=this.resizeEnabled(),p=this.padding(),R=this.anchorSize(),k=this.find("._anchor");k.forEach(I=>{I.setAttrs({width:R,height:R,offsetX:R/2,offsetY:R/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:R/2+p,offsetY:R/2+p,visible:b&&n.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:A/2,y:0,offsetY:R/2+p,visible:b&&n.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:A,y:0,offsetX:R/2-p,offsetY:R/2+p,visible:b&&n.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:M/2,offsetX:R/2+p,visible:b&&n.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:A,y:M/2,offsetX:R/2-p,visible:b&&n.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:M,offsetX:R/2+p,offsetY:R/2-p,visible:b&&n.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:A/2,y:M,offsetY:R/2-p,visible:b&&n.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:A,y:M,offsetX:R/2-p,offsetY:R/2-p,visible:b&&n.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:A/2,y:-this.rotateAnchorOffset()*i.Util._sign(M)-p,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:A,height:M,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const N=this.anchorStyleFunc();N&&k.forEach(I=>{N(I)}),(x=this.getLayer())===null||x===void 0||x.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const x=this.findOne("."+this._movingAnchorName);x&&x.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),g.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return O.Node.prototype.toObject.call(this)}clone(x){return O.Node.prototype.clone.call(this,x)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};de.Transformer=w,w.isTransforming=()=>_>0;function L(T){return T instanceof Array||i.Util.warn("enabledAnchors value should be an array"),T instanceof Array&&T.forEach(function(x){d.indexOf(x)===-1&&i.Util.warn("Unknown anchor name: "+x+". Available names are: "+d.join(", "))}),T||[]}return w.prototype.className="Transformer",(0,c._registerNode)(w),S.Factory.addGetterSetter(w,"enabledAnchors",d,L),S.Factory.addGetterSetter(w,"flipEnabled",!0,(0,r.getBooleanValidator)()),S.Factory.addGetterSetter(w,"resizeEnabled",!0),S.Factory.addGetterSetter(w,"anchorSize",10,(0,r.getNumberValidator)()),S.Factory.addGetterSetter(w,"rotateEnabled",!0),S.Factory.addGetterSetter(w,"rotateLineVisible",!0),S.Factory.addGetterSetter(w,"rotationSnaps",[]),S.Factory.addGetterSetter(w,"rotateAnchorOffset",50,(0,r.getNumberValidator)()),S.Factory.addGetterSetter(w,"rotateAnchorCursor","crosshair"),S.Factory.addGetterSetter(w,"rotationSnapTolerance",5,(0,r.getNumberValidator)()),S.Factory.addGetterSetter(w,"borderEnabled",!0),S.Factory.addGetterSetter(w,"anchorStroke","rgb(0, 161, 255)"),S.Factory.addGetterSetter(w,"anchorStrokeWidth",1,(0,r.getNumberValidator)()),S.Factory.addGetterSetter(w,"anchorFill","white"),S.Factory.addGetterSetter(w,"anchorCornerRadius",0,(0,r.getNumberValidator)()),S.Factory.addGetterSetter(w,"borderStroke","rgb(0, 161, 255)"),S.Factory.addGetterSetter(w,"borderStrokeWidth",1,(0,r.getNumberValidator)()),S.Factory.addGetterSetter(w,"borderDash"),S.Factory.addGetterSetter(w,"keepRatio",!0),S.Factory.addGetterSetter(w,"shiftBehavior","default"),S.Factory.addGetterSetter(w,"centeredScaling",!1),S.Factory.addGetterSetter(w,"ignoreStroke",!1),S.Factory.addGetterSetter(w,"padding",0,(0,r.getNumberValidator)()),S.Factory.addGetterSetter(w,"nodes"),S.Factory.addGetterSetter(w,"node"),S.Factory.addGetterSetter(w,"boundBoxFunc"),S.Factory.addGetterSetter(w,"anchorDragBoundFunc"),S.Factory.addGetterSetter(w,"anchorStyleFunc"),S.Factory.addGetterSetter(w,"shouldOverdrawWholeArea",!1),S.Factory.addGetterSetter(w,"useSingleNodeRotation",!0),S.Factory.backCompat(w,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),de}var ue={},Qi;function Mr(){if(Qi)return ue;Qi=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.Wedge=void 0;const i=Q(),S=ht(),O=Z(),E=J(),P=Z();let g=class extends S.Shape{_sceneFunc(r){r.beginPath(),r.arc(0,0,this.radius(),0,O.Konva.getAngle(this.angle()),this.clockwise()),r.lineTo(0,0),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(r){this.radius(r/2)}setHeight(r){this.radius(r/2)}};return ue.Wedge=g,g.prototype.className="Wedge",g.prototype._centroid=!0,g.prototype._attrsAffectingSize=["radius"],(0,P._registerNode)(g),i.Factory.addGetterSetter(g,"radius",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(g,"angle",0,(0,E.getNumberValidator)()),i.Factory.addGetterSetter(g,"clockwise",!1),i.Factory.backCompat(g,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),ue}var fe={},Ji;function Nr(){if(Ji)return fe;Ji=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.Blur=void 0;const i=Q(),S=ot(),O=J();function E(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const P=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],g=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function l(c,h){const f=c.data,y=c.width,m=c.height;let o,s,a,d,v,e,t,u,_,w,L,T,x,C,A,M,n,b,p,R,k,N,I,D;const U=h+h+1,z=y-1,B=m-1,H=h+1,W=H*(H+1)/2,K=new E,F=P[h],G=g[h];let V=null,q=K,j=null,X=null;for(a=1;a<U;a++)q=q.next=new E,a===H&&(V=q);for(q.next=K,t=e=0,s=0;s<m;s++){for(M=n=b=p=u=_=w=L=0,T=H*(R=f[e]),x=H*(k=f[e+1]),C=H*(N=f[e+2]),A=H*(I=f[e+3]),u+=W*R,_+=W*k,w+=W*N,L+=W*I,q=K,a=0;a<H;a++)q.r=R,q.g=k,q.b=N,q.a=I,q=q.next;for(a=1;a<H;a++)d=e+((z<a?z:a)<<2),u+=(q.r=R=f[d])*(D=H-a),_+=(q.g=k=f[d+1])*D,w+=(q.b=N=f[d+2])*D,L+=(q.a=I=f[d+3])*D,M+=R,n+=k,b+=N,p+=I,q=q.next;for(j=K,X=V,o=0;o<y;o++)f[e+3]=I=L*F>>G,I!==0?(I=255/I,f[e]=(u*F>>G)*I,f[e+1]=(_*F>>G)*I,f[e+2]=(w*F>>G)*I):f[e]=f[e+1]=f[e+2]=0,u-=T,_-=x,w-=C,L-=A,T-=j.r,x-=j.g,C-=j.b,A-=j.a,d=t+((d=o+h+1)<z?d:z)<<2,M+=j.r=f[d],n+=j.g=f[d+1],b+=j.b=f[d+2],p+=j.a=f[d+3],u+=M,_+=n,w+=b,L+=p,j=j.next,T+=R=X.r,x+=k=X.g,C+=N=X.b,A+=I=X.a,M-=R,n-=k,b-=N,p-=I,X=X.next,e+=4;t+=y}for(o=0;o<y;o++){for(n=b=p=M=_=w=L=u=0,e=o<<2,T=H*(R=f[e]),x=H*(k=f[e+1]),C=H*(N=f[e+2]),A=H*(I=f[e+3]),u+=W*R,_+=W*k,w+=W*N,L+=W*I,q=K,a=0;a<H;a++)q.r=R,q.g=k,q.b=N,q.a=I,q=q.next;for(v=y,a=1;a<=h;a++)e=v+o<<2,u+=(q.r=R=f[e])*(D=H-a),_+=(q.g=k=f[e+1])*D,w+=(q.b=N=f[e+2])*D,L+=(q.a=I=f[e+3])*D,M+=R,n+=k,b+=N,p+=I,q=q.next,a<B&&(v+=y);for(e=o,j=K,X=V,s=0;s<m;s++)d=e<<2,f[d+3]=I=L*F>>G,I>0?(I=255/I,f[d]=(u*F>>G)*I,f[d+1]=(_*F>>G)*I,f[d+2]=(w*F>>G)*I):f[d]=f[d+1]=f[d+2]=0,u-=T,_-=x,w-=C,L-=A,T-=j.r,x-=j.g,C-=j.b,A-=j.a,d=o+((d=s+H)<B?d:B)*y<<2,u+=M+=j.r=f[d],_+=n+=j.g=f[d+1],w+=b+=j.b=f[d+2],L+=p+=j.a=f[d+3],j=j.next,T+=R=X.r,x+=k=X.g,C+=N=X.b,A+=I=X.a,M-=R,n-=k,b-=N,p-=I,X=X.next,e+=y}}const r=function(h){const f=Math.round(this.blurRadius());f>0&&l(h,f)};return fe.Blur=r,i.Factory.addGetterSetter(S.Node,"blurRadius",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),fe}var ge={},tn;function Gr(){if(tn)return ge;tn=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.Brighten=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=this.brightness()*255,l=P.data,r=l.length;for(let c=0;c<r;c+=4)l[c]+=g,l[c+1]+=g,l[c+2]+=g};return ge.Brighten=E,i.Factory.addGetterSetter(S.Node,"brightness",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),ge}var pe={},en;function Dr(){if(en)return pe;en=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.Contrast=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=Math.pow((this.contrast()+100)/100,2),l=P.data,r=l.length;let c=150,h=150,f=150;for(let y=0;y<r;y+=4)c=l[y],h=l[y+1],f=l[y+2],c/=255,c-=.5,c*=g,c+=.5,c*=255,h/=255,h-=.5,h*=g,h+=.5,h*=255,f/=255,f-=.5,f*=g,f+=.5,f*=255,c=c<0?0:c>255?255:c,h=h<0?0:h>255?255:h,f=f<0?0:f>255?255:f,l[y]=c,l[y+1]=h,l[y+2]=f};return pe.Contrast=E,i.Factory.addGetterSetter(S.Node,"contrast",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),pe}var _e={},nn;function Ir(){if(nn)return _e;nn=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.Emboss=void 0;const i=Q(),S=ot(),O=st(),E=J(),P=function(g){const l=this.embossStrength()*10,r=this.embossWhiteLevel()*255,c=this.embossDirection(),h=this.embossBlend(),f=g.data,y=g.width,m=g.height,o=y*4;let s=0,a=0,d=m;switch(c){case"top-left":s=-1,a=-1;break;case"top":s=-1,a=0;break;case"top-right":s=-1,a=1;break;case"right":s=0,a=1;break;case"bottom-right":s=1,a=1;break;case"bottom":s=1,a=0;break;case"bottom-left":s=1,a=-1;break;case"left":s=0,a=-1;break;default:O.Util.error("Unknown emboss direction: "+c)}do{const v=(d-1)*o;let e=s;d+e<1&&(e=0),d+e>m&&(e=0);const t=(d-1+e)*y*4;let u=y;do{const _=v+(u-1)*4;let w=a;u+w<1&&(w=0),u+w>y&&(w=0);const L=t+(u-1+w)*4,T=f[_]-f[L],x=f[_+1]-f[L+1],C=f[_+2]-f[L+2];let A=T;const M=A>0?A:-A,n=x>0?x:-x,b=C>0?C:-C;if(n>M&&(A=x),b>M&&(A=C),A*=l,h){const p=f[_]+A,R=f[_+1]+A,k=f[_+2]+A;f[_]=p>255?255:p<0?0:p,f[_+1]=R>255?255:R<0?0:R,f[_+2]=k>255?255:k<0?0:k}else{let p=r-A;p<0?p=0:p>255&&(p=255),f[_]=f[_+1]=f[_+2]=p}}while(--u)}while(--d)};return _e.Emboss=P,i.Factory.addGetterSetter(S.Node,"embossStrength",.5,(0,E.getNumberValidator)(),i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"embossWhiteLevel",.5,(0,E.getNumberValidator)(),i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"embossDirection","top-left",void 0,i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"embossBlend",!1,void 0,i.Factory.afterSetFilter),_e}var me={},rn;function Br(){if(rn)return me;rn=1,Object.defineProperty(me,"__esModule",{value:!0}),me.Enhance=void 0;const i=Q(),S=ot(),O=J();function E(g,l,r,c,h){const f=r-l,y=h-c;if(f===0)return c+y/2;if(y===0)return c;let m=(g-l)/f;return m=y*m+c,m}const P=function(g){const l=g.data,r=l.length;let c=l[0],h=c,f,y=l[1],m=y,o,s=l[2],a=s,d;const v=this.enhance();if(v===0)return;for(let A=0;A<r;A+=4)f=l[A+0],f<c?c=f:f>h&&(h=f),o=l[A+1],o<y?y=o:o>m&&(m=o),d=l[A+2],d<s?s=d:d>a&&(a=d);h===c&&(h=255,c=0),m===y&&(m=255,y=0),a===s&&(a=255,s=0);let e,t,u,_,w,L,T,x,C;v>0?(t=h+v*(255-h),u=c-v*(c-0),w=m+v*(255-m),L=y-v*(y-0),x=a+v*(255-a),C=s-v*(s-0)):(e=(h+c)*.5,t=h+v*(h-e),u=c+v*(c-e),_=(m+y)*.5,w=m+v*(m-_),L=y+v*(y-_),T=(a+s)*.5,x=a+v*(a-T),C=s+v*(s-T));for(let A=0;A<r;A+=4)l[A+0]=E(l[A+0],c,h,u,t),l[A+1]=E(l[A+1],y,m,L,w),l[A+2]=E(l[A+2],s,a,C,x)};return me.Enhance=P,i.Factory.addGetterSetter(S.Node,"enhance",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),me}var ye={},sn;function Ur(){if(sn)return ye;sn=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.Grayscale=void 0;const i=function(S){const O=S.data,E=O.length;for(let P=0;P<E;P+=4){const g=.34*O[P]+.5*O[P+1]+.16*O[P+2];O[P]=g,O[P+1]=g,O[P+2]=g}};return ye.Grayscale=i,ye}var be={},an;function Vr(){if(an)return be;an=1,Object.defineProperty(be,"__esModule",{value:!0}),be.HSL=void 0;const i=Q(),S=ot(),O=J();i.Factory.addGetterSetter(S.Node,"hue",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"saturation",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"luminance",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter);const E=function(P){const g=P.data,l=g.length,r=1,c=Math.pow(2,this.saturation()),h=Math.abs(this.hue()+360)%360,f=this.luminance()*127,y=r*c*Math.cos(h*Math.PI/180),m=r*c*Math.sin(h*Math.PI/180),o=.299*r+.701*y+.167*m,s=.587*r-.587*y+.33*m,a=.114*r-.114*y-.497*m,d=.299*r-.299*y-.328*m,v=.587*r+.413*y+.035*m,e=.114*r-.114*y+.293*m,t=.299*r-.3*y+1.25*m,u=.587*r-.586*y-1.05*m,_=.114*r+.886*y-.2*m;let w,L,T,x;for(let C=0;C<l;C+=4)w=g[C+0],L=g[C+1],T=g[C+2],x=g[C+3],g[C+0]=o*w+s*L+a*T+f,g[C+1]=d*w+v*L+e*T+f,g[C+2]=t*w+u*L+_*T+f,g[C+3]=x};return be.HSL=E,be}var ve={},on;function Hr(){if(on)return ve;on=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.HSV=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=P.data,l=g.length,r=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),h=Math.abs(this.hue()+360)%360,f=r*c*Math.cos(h*Math.PI/180),y=r*c*Math.sin(h*Math.PI/180),m=.299*r+.701*f+.167*y,o=.587*r-.587*f+.33*y,s=.114*r-.114*f-.497*y,a=.299*r-.299*f-.328*y,d=.587*r+.413*f+.035*y,v=.114*r-.114*f+.293*y,e=.299*r-.3*f+1.25*y,t=.587*r-.586*f-1.05*y,u=.114*r+.886*f-.2*y;let _,w,L,T;for(let x=0;x<l;x+=4)_=g[x+0],w=g[x+1],L=g[x+2],T=g[x+3],g[x+0]=m*_+o*w+s*L,g[x+1]=a*_+d*w+v*L,g[x+2]=e*_+t*w+u*L,g[x+3]=T};return ve.HSV=E,i.Factory.addGetterSetter(S.Node,"hue",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"saturation",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"value",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),ve}var Se={},hn;function qr(){if(hn)return Se;hn=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.Invert=void 0;const i=function(S){const O=S.data,E=O.length;for(let P=0;P<E;P+=4)O[P]=255-O[P],O[P+1]=255-O[P+1],O[P+2]=255-O[P+2]};return Se.Invert=i,Se}var Ce={},ln;function zr(){if(ln)return Ce;ln=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.Kaleidoscope=void 0;const i=Q(),S=ot(),O=st(),E=J(),P=function(r,c,h){const f=r.data,y=c.data,m=r.width,o=r.height,s=h.polarCenterX||m/2,a=h.polarCenterY||o/2;let d=Math.sqrt(s*s+a*a),v=m-s,e=o-a;const t=Math.sqrt(v*v+e*e);d=t>d?t:d;const u=o,_=m,w=360/_*Math.PI/180;for(let L=0;L<_;L+=1){const T=Math.sin(L*w),x=Math.cos(L*w);for(let C=0;C<u;C+=1){v=Math.floor(s+d*C/u*x),e=Math.floor(a+d*C/u*T);let A=(e*m+v)*4;const M=f[A+0],n=f[A+1],b=f[A+2],p=f[A+3];A=(L+C*m)*4,y[A+0]=M,y[A+1]=n,y[A+2]=b,y[A+3]=p}}},g=function(r,c,h){const f=r.data,y=c.data,m=r.width,o=r.height,s=h.polarCenterX||m/2,a=h.polarCenterY||o/2;let d=Math.sqrt(s*s+a*a),v=m-s,e=o-a;const t=Math.sqrt(v*v+e*e);d=t>d?t:d;const u=o,_=m,w=0;let L,T;for(v=0;v<m;v+=1)for(e=0;e<o;e+=1){const x=v-s,C=e-a,A=Math.sqrt(x*x+C*C)*u/d;let M=(Math.atan2(C,x)*180/Math.PI+360+w)%360;M=M*_/360,L=Math.floor(M),T=Math.floor(A);let n=(T*m+L)*4;const b=f[n+0],p=f[n+1],R=f[n+2],k=f[n+3];n=(e*m+v)*4,y[n+0]=b,y[n+1]=p,y[n+2]=R,y[n+3]=k}},l=function(r){const c=r.width,h=r.height;let f,y,m,o,s,a,d,v,e,t,u=Math.round(this.kaleidoscopePower());const _=Math.round(this.kaleidoscopeAngle()),w=Math.floor(c*(_%360)/360);if(u<1)return;const L=O.Util.createCanvasElement();L.width=c,L.height=h;const T=L.getContext("2d").getImageData(0,0,c,h);O.Util.releaseCanvas(L),P(r,T,{polarCenterX:c/2,polarCenterY:h/2});let x=c/Math.pow(2,u);for(;x<=8;)x=x*2,u-=1;x=Math.ceil(x);let C=x,A=0,M=C,n=1;for(w+x>c&&(A=C,M=0,n=-1),y=0;y<h;y+=1)for(f=A;f!==M;f+=n)m=Math.round(f+w)%c,e=(c*y+m)*4,s=T.data[e+0],a=T.data[e+1],d=T.data[e+2],v=T.data[e+3],t=(c*y+f)*4,T.data[t+0]=s,T.data[t+1]=a,T.data[t+2]=d,T.data[t+3]=v;for(y=0;y<h;y+=1)for(C=Math.floor(x),o=0;o<u;o+=1){for(f=0;f<C+1;f+=1)e=(c*y+f)*4,s=T.data[e+0],a=T.data[e+1],d=T.data[e+2],v=T.data[e+3],t=(c*y+C*2-f-1)*4,T.data[t+0]=s,T.data[t+1]=a,T.data[t+2]=d,T.data[t+3]=v;C*=2}g(T,r,{})};return Ce.Kaleidoscope=l,i.Factory.addGetterSetter(S.Node,"kaleidoscopePower",2,(0,E.getNumberValidator)(),i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"kaleidoscopeAngle",0,(0,E.getNumberValidator)(),i.Factory.afterSetFilter),Ce}var we={},cn;function Wr(){if(cn)return we;cn=1,Object.defineProperty(we,"__esModule",{value:!0}),we.Mask=void 0;const i=Q(),S=ot(),O=J();function E(m,o,s){let a=(s*m.width+o)*4;const d=[];return d.push(m.data[a++],m.data[a++],m.data[a++],m.data[a++]),d}function P(m,o){return Math.sqrt(Math.pow(m[0]-o[0],2)+Math.pow(m[1]-o[1],2)+Math.pow(m[2]-o[2],2))}function g(m){const o=[0,0,0];for(let s=0;s<m.length;s++)o[0]+=m[s][0],o[1]+=m[s][1],o[2]+=m[s][2];return o[0]/=m.length,o[1]/=m.length,o[2]/=m.length,o}function l(m,o){const s=E(m,0,0),a=E(m,m.width-1,0),d=E(m,0,m.height-1),v=E(m,m.width-1,m.height-1),e=o||10;if(P(s,a)<e&&P(a,v)<e&&P(v,d)<e&&P(d,s)<e){const t=g([a,s,v,d]),u=[];for(let _=0;_<m.width*m.height;_++){const w=P(t,[m.data[_*4],m.data[_*4+1],m.data[_*4+2]]);u[_]=w<e?0:255}return u}}function r(m,o){for(let s=0;s<m.width*m.height;s++)m.data[4*s+3]=o[s]}function c(m,o,s){const a=[1,1,1,1,0,1,1,1,1],d=Math.round(Math.sqrt(a.length)),v=Math.floor(d/2),e=[];for(let t=0;t<s;t++)for(let u=0;u<o;u++){const _=t*o+u;let w=0;for(let L=0;L<d;L++)for(let T=0;T<d;T++){const x=t+L-v,C=u+T-v;if(x>=0&&x<s&&C>=0&&C<o){const A=x*o+C,M=a[L*d+T];w+=m[A]*M}}e[_]=w===255*8?255:0}return e}function h(m,o,s){const a=[1,1,1,1,1,1,1,1,1],d=Math.round(Math.sqrt(a.length)),v=Math.floor(d/2),e=[];for(let t=0;t<s;t++)for(let u=0;u<o;u++){const _=t*o+u;let w=0;for(let L=0;L<d;L++)for(let T=0;T<d;T++){const x=t+L-v,C=u+T-v;if(x>=0&&x<s&&C>=0&&C<o){const A=x*o+C,M=a[L*d+T];w+=m[A]*M}}e[_]=w>=255*4?255:0}return e}function f(m,o,s){const a=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],d=Math.round(Math.sqrt(a.length)),v=Math.floor(d/2),e=[];for(let t=0;t<s;t++)for(let u=0;u<o;u++){const _=t*o+u;let w=0;for(let L=0;L<d;L++)for(let T=0;T<d;T++){const x=t+L-v,C=u+T-v;if(x>=0&&x<s&&C>=0&&C<o){const A=x*o+C,M=a[L*d+T];w+=m[A]*M}}e[_]=w}return e}const y=function(m){const o=this.threshold();let s=l(m,o);return s&&(s=c(s,m.width,m.height),s=h(s,m.width,m.height),s=f(s,m.width,m.height),r(m,s)),m};return we.Mask=y,i.Factory.addGetterSetter(S.Node,"threshold",0,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),we}var xe={},dn;function Kr(){if(dn)return xe;dn=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.Noise=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=this.noise()*255,l=P.data,r=l.length,c=g/2;for(let h=0;h<r;h+=4)l[h+0]+=c-2*c*Math.random(),l[h+1]+=c-2*c*Math.random(),l[h+2]+=c-2*c*Math.random()};return xe.Noise=E,i.Factory.addGetterSetter(S.Node,"noise",.2,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),xe}var Te={},un;function jr(){if(un)return Te;un=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.Pixelate=void 0;const i=Q(),S=st(),O=ot(),E=J(),P=function(g){let l=Math.ceil(this.pixelSize()),r=g.width,c=g.height,h,f,y,m,o,s,a,d=Math.ceil(r/l),v=Math.ceil(c/l),e,t,u,_,w,L,T,x=g.data;if(l<=0){S.Util.error("pixelSize value can not be <= 0");return}for(w=0;w<d;w+=1)for(L=0;L<v;L+=1){for(m=0,o=0,s=0,a=0,e=w*l,t=e+l,u=L*l,_=u+l,T=0,h=e;h<t;h+=1)if(!(h>=r))for(f=u;f<_;f+=1)f>=c||(y=(r*f+h)*4,m+=x[y+0],o+=x[y+1],s+=x[y+2],a+=x[y+3],T+=1);for(m=m/T,o=o/T,s=s/T,a=a/T,h=e;h<t;h+=1)if(!(h>=r))for(f=u;f<_;f+=1)f>=c||(y=(r*f+h)*4,x[y+0]=m,x[y+1]=o,x[y+2]=s,x[y+3]=a)}};return Te.Pixelate=P,i.Factory.addGetterSetter(O.Node,"pixelSize",8,(0,E.getNumberValidator)(),i.Factory.afterSetFilter),Te}var Pe={},fn;function Xr(){if(fn)return Pe;fn=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Posterize=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=Math.round(this.levels()*254)+1,l=P.data,r=l.length,c=255/g;for(let h=0;h<r;h+=1)l[h]=Math.floor(l[h]/c)*c};return Pe.Posterize=E,i.Factory.addGetterSetter(S.Node,"levels",.5,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),Pe}var Ee={},gn;function Yr(){if(gn)return Ee;gn=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.RGB=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=P.data,l=g.length,r=this.red(),c=this.green(),h=this.blue();for(let f=0;f<l;f+=4){const y=(.34*g[f]+.5*g[f+1]+.16*g[f+2])/255;g[f]=y*r,g[f+1]=y*c,g[f+2]=y*h,g[f+3]=g[f+3]}};return Ee.RGB=E,i.Factory.addGetterSetter(S.Node,"red",0,function(P){return this._filterUpToDate=!1,P>255?255:P<0?0:Math.round(P)}),i.Factory.addGetterSetter(S.Node,"green",0,function(P){return this._filterUpToDate=!1,P>255?255:P<0?0:Math.round(P)}),i.Factory.addGetterSetter(S.Node,"blue",0,O.RGBComponent,i.Factory.afterSetFilter),Ee}var Ae={},pn;function $r(){if(pn)return Ae;pn=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.RGBA=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=P.data,l=g.length,r=this.red(),c=this.green(),h=this.blue(),f=this.alpha();for(let y=0;y<l;y+=4){const m=1-f;g[y]=r*f+g[y]*m,g[y+1]=c*f+g[y+1]*m,g[y+2]=h*f+g[y+2]*m}};return Ae.RGBA=E,i.Factory.addGetterSetter(S.Node,"red",0,function(P){return this._filterUpToDate=!1,P>255?255:P<0?0:Math.round(P)}),i.Factory.addGetterSetter(S.Node,"green",0,function(P){return this._filterUpToDate=!1,P>255?255:P<0?0:Math.round(P)}),i.Factory.addGetterSetter(S.Node,"blue",0,O.RGBComponent,i.Factory.afterSetFilter),i.Factory.addGetterSetter(S.Node,"alpha",1,function(P){return this._filterUpToDate=!1,P>1?1:P<0?0:P}),Ae}var Re={},_n;function Zr(){if(_n)return Re;_n=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.Sepia=void 0;const i=function(S){const O=S.data,E=O.length;for(let P=0;P<E;P+=4){const g=O[P+0],l=O[P+1],r=O[P+2];O[P+0]=Math.min(255,g*.393+l*.769+r*.189),O[P+1]=Math.min(255,g*.349+l*.686+r*.168),O[P+2]=Math.min(255,g*.272+l*.534+r*.131)}};return Re.Sepia=i,Re}var Oe={},mn;function Qr(){if(mn)return Oe;mn=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.Solarize=void 0;const i=function(S){const O=S.data,E=S.width,P=S.height,g=E*4;let l=P;do{const r=(l-1)*g;let c=E;do{const h=r+(c-1)*4;let f=O[h],y=O[h+1],m=O[h+2];f>127&&(f=255-f),y>127&&(y=255-y),m>127&&(m=255-m),O[h]=f,O[h+1]=y,O[h+2]=m}while(--c)}while(--l)};return Oe.Solarize=i,Oe}var ke={},yn;function Jr(){if(yn)return ke;yn=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.Threshold=void 0;const i=Q(),S=ot(),O=J(),E=function(P){const g=this.threshold()*255,l=P.data,r=l.length;for(let c=0;c<r;c+=1)l[c]=l[c]<g?0:255};return ke.Threshold=E,i.Factory.addGetterSetter(S.Node,"threshold",.5,(0,O.getNumberValidator)(),i.Factory.afterSetFilter),ke}var bn;function ts(){if(bn)return Wt;bn=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.Konva=void 0;const i=vr(),S=Sr(),O=wr(),E=xr(),P=Tr(),g=Pr(),l=Er(),r=Un(),c=fi(),h=Hn(),f=Ar(),y=Rr(),m=Or(),o=kr(),s=qn(),a=Fr(),d=Lr(),v=Mr(),e=Nr(),t=Gr(),u=Dr(),_=Ir(),w=Br(),L=Ur(),T=Vr(),x=Hr(),C=qr(),A=zr(),M=Wr(),n=Kr(),b=jr(),p=Xr(),R=Yr(),k=$r(),N=Zr(),I=Qr(),D=Jr();return Wt.Konva=i.Konva.Util._assign(i.Konva,{Arc:S.Arc,Arrow:O.Arrow,Circle:E.Circle,Ellipse:P.Ellipse,Image:g.Image,Label:l.Label,Tag:l.Tag,Line:r.Line,Path:c.Path,Rect:h.Rect,RegularPolygon:f.RegularPolygon,Ring:y.Ring,Sprite:m.Sprite,Star:o.Star,Text:s.Text,TextPath:a.TextPath,Transformer:d.Transformer,Wedge:v.Wedge,Filters:{Blur:e.Blur,Brighten:t.Brighten,Contrast:u.Contrast,Emboss:_.Emboss,Enhance:w.Enhance,Grayscale:L.Grayscale,HSL:T.HSL,HSV:x.HSV,Invert:C.Invert,Kaleidoscope:A.Kaleidoscope,Mask:M.Mask,Noise:n.Noise,Pixelate:b.Pixelate,Posterize:p.Posterize,RGB:R.RGB,RGBA:k.RGBA,Sepia:N.Sepia,Solarize:I.Solarize,Threshold:D.Threshold}}),Wt}var es=Ne.exports,vn;function is(){if(vn)return Ne.exports;vn=1,Object.defineProperty(es,"__esModule",{value:!0});const i=ts();return Ne.exports=i.Konva,Ne.exports}var ns=is();const pt=xn(ns);var $e,Sn;function rs(){if(Sn)return $e;Sn=1;var i="Expected a function",S=NaN,O="[object Symbol]",E=/^\s+|\s+$/g,P=/^[-+]0x[0-9a-f]+$/i,g=/^0b[01]+$/i,l=/^0o[0-7]+$/i,r=parseInt,c=typeof Mt=="object"&&Mt&&Mt.Object===Object&&Mt,h=typeof self=="object"&&self&&self.Object===Object&&self,f=c||h||Function("return this")(),y=Object.prototype,m=y.toString,o=Math.max,s=Math.min,a=function(){return f.Date.now()};function d(_,w,L){var T,x,C,A,M,n,b=0,p=!1,R=!1,k=!0;if(typeof _!="function")throw new TypeError(i);w=u(w)||0,v(L)&&(p=!!L.leading,R="maxWait"in L,C=R?o(u(L.maxWait)||0,w):C,k="trailing"in L?!!L.trailing:k);function N(F){var G=T,V=x;return T=x=void 0,b=F,A=_.apply(V,G),A}function I(F){return b=F,M=setTimeout(z,w),p?N(F):A}function D(F){var G=F-n,V=F-b,q=w-G;return R?s(q,C-V):q}function U(F){var G=F-n,V=F-b;return n===void 0||G>=w||G<0||R&&V>=C}function z(){var F=a();if(U(F))return B(F);M=setTimeout(z,D(F))}function B(F){return M=void 0,k&&T?N(F):(T=x=void 0,A)}function H(){M!==void 0&&clearTimeout(M),b=0,T=n=x=M=void 0}function W(){return M===void 0?A:B(a())}function K(){var F=a(),G=U(F);if(T=arguments,x=this,n=F,G){if(M===void 0)return I(n);if(R)return M=setTimeout(z,w),N(n)}return M===void 0&&(M=setTimeout(z,w)),A}return K.cancel=H,K.flush=W,K}function v(_){var w=typeof _;return!!_&&(w=="object"||w=="function")}function e(_){return!!_&&typeof _=="object"}function t(_){return typeof _=="symbol"||e(_)&&m.call(_)==O}function u(_){if(typeof _=="number")return _;if(t(_))return S;if(v(_)){var w=typeof _.valueOf=="function"?_.valueOf():_;_=v(w)?w+"":w}if(typeof _!="string")return _===0?_:+_;_=_.replace(E,"");var L=g.test(_);return L||l.test(_)?r(_.slice(2),L?2:8):P.test(_)?S:+_}return $e=d,$e}var ss=rs();const as=xn(ss);function zn(i){const c='\n    <svg xmlns="http://www.w3.org/2000/svg"\n         width="20"\n         height="23"\n         viewBox="0 0 20 16">\n      <!-- This group shifts the drawing to the right. Vertical padding is handled by the canvas size and hotspot location. -->\n      <g transform="translate(4, 0)">\n        <path fill="'.concat(i,'"\n              d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z"/>\n      </g>\n    </svg>\n  '),h=encodeURIComponent(c),f="url('data:image/svg+xml;utf8,".concat(h,"')"),y="".concat(f," 0 22");document.documentElement.style.setProperty("--pencil-cursor-url",y)}PubSub.subscribe(it.IMAGE_UPLOAD_NEW_IMAGE,_s);PubSub.subscribe(it.TOOLBAR_ANNOTATIONS_TOGGLED,ps);PubSub.subscribe(it.TOOLBAR_FONT_SIZE_CHANGED,fs);PubSub.subscribe(it.TOOLBAR_ZOOM_CHANGED,Ps);PubSub.subscribe(it.TOOLBAR_STROKE_WIDTH_SELECTED,gs);PubSub.subscribe(it.TOOLBAR_STROKE_COLOR_CHANGED,ds);PubSub.subscribe(it.TOOLBAR_FONT_COLOR_CHANGED,us);PubSub.subscribe(it.TOOLBAR_STROKE_CLICKED,ls);PubSub.subscribe(it.TOOLBAR_FONT_CLICKED,cs);PubSub.subscribe(it.TOOLBAR_ERASER_CLICKED,hs);pt._fixTextRendering=!0;const bt=document.querySelector(".c-stage"),Ct={DRAW:"draw",ERASE:"erase",TEXT:"text"},Wn={THIN:2,MEDIUM:5,THICK:10};let Dt=Ct.DRAW,Kn=Wn.MEDIUM,gi="#FF0000",jn="#000000",Xn=20,Bt=null,Le=null;const ni=1,os=10;let ri=!1,$=null,Ut=new pt.Layer,Be=new pt.Layer,si=new pt.Layer,It=new pt.Transformer({enabledAnchors:["middle-left","middle-right"],boundBoxFunc:function(i,S){return S.width=Math.max(50,S.width),S}});Ut.add(It);function hs(){Dt=Ct.ERASE,Me()}function ls(){Dt=Ct.DRAW,Me()}function cs(){Dt=Ct.TEXT,Me(),xs()}function Me(){if(bt.classList.remove("is-erasing","is-drawing","is-texting","is-pannable"),ri){bt.classList.add("is-pannable");return}switch(Dt){case Ct.DRAW:bt.classList.add("is-drawing");break;case Ct.ERASE:bt.classList.add("is-erasing");break;case Ct.TEXT:bt.classList.add("is-texting");break}}function ds(i,S){gi=S,zn(S)}function us(i,S){jn=S,Bt instanceof pt.Text&&Bt.fill(S)}function fs(i,S){Xn=S,Bt instanceof pt.Text&&Bt.fontSize(S)}function gs(i,S){Kn=Wn[S]}function ps(i,S){Be.visible(!S),Ut.visible(!S)}function _s(i,S){$||bs(),si.destroyChildren(),Be.destroyChildren(),Ut.find("Text").forEach(E=>E.destroy()),It.nodes([]);const O=URL.createObjectURL(S);pt.Image.fromURL(O,function(E){Le=E,Yn(),si.add(E),$.scale({x:1,y:1}),$.position({x:0,y:0}),$.draggable(!1),Me(),URL.revokeObjectURL(O)})}const ms=as(ys,150);function ys(){$&&($.width(bt.clientWidth),$.height(bt.clientHeight),Yn())}function Yn(){if(!Le||!$)return;const i=Le.image(),S=$.width(),O=$.height();let E=Math.min(S/i.width,O/i.height);E=Math.min(1,E);const P=i.width*E,g=i.height*E,l=(S-P)/2,r=(O-g)/2;Le.setAttrs({x:l,y:r,width:P,height:g})}function bs(){bt.classList.remove("d-none"),$=new pt.Stage({container:".c-stage__canvas",width:bt.clientWidth,height:bt.clientHeight}),$.add(si),$.add(Be),$.add(Ut),$.on("mousedown touchstart",vs),$.on("mouseup touchend",Ss),$.on("mousemove touchmove",Cs),$.on("click",ws),$.on("wheel",Ts),window.addEventListener("resize",ms),zn(gi)}let pi=!1,Ge=null;function vs(i){if(Dt===Ct.TEXT||$.draggable())return;pi=!0;const S=$.getPointerPosition();Ge=new pt.Line({stroke:gi,strokeWidth:Dt===Ct.DRAW?Kn:20,globalCompositeOperation:Dt===Ct.DRAW?"source-over":"destination-out",lineCap:"round",lineJoin:"round",points:[S.x,S.y,S.x,S.y],strokeScaleEnabled:!1}),Be.add(Ge)}function Ss(){pi=!1}function Cs(i){if(!pi)return;i.evt.preventDefault();const S=$.getPointerPosition(),O=Ge.points().concat([S.x,S.y]);Ge.points(O)}function ws(i){if(i.target===$||i.target===Le){wn();return}i.target instanceof pt.Text||wn()}function xs(){const i=new pt.Text({text:"Double click to edit",x:$.width()/2,y:$.height()/2,fill:jn,fontSize:Xn,draggable:!0,padding:10,align:"center"}),S=i.width(),O=i.height();i.offsetX(S/2),i.offsetY(O/2),Ut.add(i),i.on("transform",function(){i.setAttrs({width:i.width()*i.scaleX(),scaleX:1,scaleY:1})}),i.on("click",E=>{Cn(i)}),Cn(i),i.on("dblclick dbltap",()=>{i.hide(),It.hide();const E=i.absolutePosition(),P=$.container().getBoundingClientRect(),g=$.scaleX(),l={x:P.left+E.x-i.offsetX()*g,y:P.top+E.y-i.offsetY()*g},r=document.createElement("textarea");bt.appendChild(r),r.className="c-stage__editable-textarea",r.value=i.text(),r.style.top="".concat(l.y,"px"),r.style.left="".concat(l.x,"px"),r.style.width="".concat(i.width()*g,"px"),r.style.height="".concat(i.height()*g,"px"),r.style.fontSize="".concat(i.fontSize()*g,"px"),r.style.padding="".concat(i.padding()*g,"px"),r.style.lineHeight=i.lineHeight(),r.style.fontFamily=i.fontFamily(),r.style.textAlign=i.align(),r.style.color=i.fill(),r.style.transform="rotateZ(".concat(i.rotation()||0,"deg) translateY(-2px)");const c=i.rotation()||0;r.style.transform="rotateZ(".concat(c,"deg)"),r.style.height="auto",r.style.height=r.scrollHeight+"px",r.focus(),r.select();function h(){r.parentNode.removeChild(r),window.removeEventListener("click",y),window.removeEventListener("touchstart",y),i.show(),It.show(),It.forceUpdate()}function f(m=0){m||(m=i.placeholder.length*i.fontSize()),r.style.width=m+"px"}r.addEventListener("keydown",function(m){m.key==="Enter"&&!m.shiftKey&&(i.text(r.value),h()),m.key==="Escape"&&h()}),r.addEventListener("keydown",function(){const m=i.getAbsoluteScale().x;f(i.width()*m),r.style.height="auto",r.style.height=r.scrollHeight+i.fontSize()+"px"});function y(m){m.target!==r&&(i.text(r.value),h())}setTimeout(()=>{window.addEventListener("click",y)})})}function Cn(i){Bt=i,It.nodes([i]),Ut.batchDraw()}function wn(){Bt&&(It.nodes([]),Bt=null,Ut.batchDraw())}function Ts(i){i.evt.preventDefault();const S=$.scaleX(),O=$.getPointerPosition(),E=1.1,g=(i.evt.deltaY>0?-1:1)>0?S*E:S/E,l=Math.max(ni,Math.min(g,os));l!==S&&$n(S,l,O)}function $n(i,S,O){let E;if(S===ni)E={x:0,y:0};else{const P={x:(O.x-$.x())/i,y:(O.y-$.y())/i};E={x:O.x-P.x*S,y:O.y-P.y*S}}$.scale({x:S,y:S}),$.position(E),ri=S>ni,$.draggable(ri),Me()}function Ps(i,S){if(!$)return;const O=$.scaleX();if(S===O)return;const E={x:$.width()/2,y:$.height()/2};$n(O,S,E)}export{Es as __vite_legacy_guard};
